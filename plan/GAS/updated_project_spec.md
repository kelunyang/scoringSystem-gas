# å°ˆæ¡ˆç®¡ç†ç³»çµ±è¦æ ¼æ›¸ï¼ˆå‡½æ•¸å¼æ¶æ§‹ç‰ˆï¼‰

## ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±æ˜¯ä¸€å¥—éšæ®µåŒ–å°ˆæ¡ˆç®¡ç†ç³»çµ±ï¼Œçµåˆäº’è©•æ©Ÿåˆ¶èˆ‡è™›æ“¬é»æ•¸ï¼Œé©ç”¨æ–¼æ•™è‚²ç’°å¢ƒã€‚ç³»çµ±æ¡ç”¨å‡½æ•¸å¼æ¶æ§‹è¨­è¨ˆï¼Œä»¥ Google Apps Script ç‚ºé–‹ç™¼å¹³å°æ­é… Google Sheets åˆ†ç‰‡æ¶æ§‹ä½œç‚ºè³‡æ–™åº«ï¼Œå‰ç«¯ä½¿ç”¨ Vue 3 + Element Plus æä¾›ç¾ä»£åŒ–ä½¿ç”¨è€…ä»‹é¢ã€‚ç³»çµ±å¯ä½œç‚ºç´”å°ˆæ¡ˆç®¡ç†å·¥å…·ä½¿ç”¨ï¼Œæˆ–å•Ÿç”¨è©•åˆ†åŠŸèƒ½å¢åŠ äº’è©•ç«¶è³½æ©Ÿåˆ¶ã€‚æ”¯æ´ç¾¤çµ„å¼æ¬Šé™ç®¡ç†å’Œå¤šç¨®ç”¨æˆ¶åŒ¯å…¥æ–¹å¼ï¼Œæä¾›å®Œæ•´çš„æ¬Šé™æ§åˆ¶å’Œæ“ä½œè¿½è¹¤åŠŸèƒ½ã€‚

## æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

- **å‡½æ•¸å¼æ¶æ§‹**ï¼šæ¡ç”¨å‡½æ•¸å°å‘è¨­è¨ˆï¼Œé¿å…è¤‡é›œçš„ç‰©ä»¶å°å‘æ¨¡å¼ï¼Œé©åˆ GAS ç’°å¢ƒ
- **Google Sheets åˆ†ç‰‡æ¶æ§‹**ï¼šä½¿ç”¨å¤šåˆ†ç‰‡ç­–ç•¥ï¼Œé¿å…å–®ä¸€è©¦ç®—è¡¨é™åˆ¶ï¼Œæä¾›å„ªç•°æ•ˆèƒ½
- **å”¯è®€æ–°å¢è¨­è¨ˆ**ï¼šå› æ‡‰ Google Sheets ç‰¹æ€§ï¼Œç³»çµ±è¨­è¨ˆç‚ºåªåšè®€å–å’Œæ–°å¢æ“ä½œï¼Œé¿å…ä¿®æ”¹ç¾æœ‰ç´€éŒ„ï¼Œç¢ºä¿è³‡æ–™å®Œæ•´æ€§å’Œæœ€ä½³æ•ˆèƒ½
- **ç¾ä»£åŒ–å‰ç«¯**ï¼šVue 3 + Element Plus æä¾›éŸ¿æ‡‰å¼ã€æ˜“ç”¨çš„ä½¿ç”¨è€…ä»‹é¢
- **çµ±ä¸€æ™‚é–“æ ¼å¼**ï¼šæ‰€æœ‰æ™‚é–“æ¬„ä½çµ±ä¸€ä½¿ç”¨æ¯«ç§’ç´š timestamp å„²å­˜ï¼Œç¢ºä¿ç²¾ç¢ºåº¦å’Œä¸€è‡´æ€§
- **æ¨™æº–åŒ– UI çµ„ä»¶**ï¼šæ‰€æœ‰å½ˆå‡ºè¦–çª—çµ±ä¸€ä½¿ç”¨ el-drawer å¯¦ä½œï¼Œæä¾›ä¸€è‡´çš„ä½¿ç”¨é«”é©—
- **I/O æ•ˆèƒ½å„ªå…ˆ**ï¼šæ•´è¡¨è®€å–é…åˆè¨˜æ†¶é«”è™•ç†ï¼Œæœ€å¤§åŒ– Google Sheets è®€å¯«æ•ˆèƒ½
- **é…ç½®é©…å‹•å¤–æ›**ï¼šé€éé…ç½®ç‰©ä»¶æ§åˆ¶åŠŸèƒ½æ¨¡çµ„çš„å•Ÿç”¨èˆ‡åœç”¨
- **ç¾¤çµ„å¼æ¬Šé™ç®¡ç†**ï¼šæ”¯æ´å¤šé‡è§’è‰²å’Œè·¨å°ˆæ¡ˆæ¬Šé™ï¼Œç¾¤çµ„å¯é‡ç”¨ä¸”å½ˆæ€§åˆ†é…
- **æ‰¹é‡æ“ä½œæ”¯æ´**ï¼šæ”¯æ´æ‰¹é‡å»ºç«‹ç¾¤çµ„ã€è¤‡è£½å°ˆæ¡ˆå’Œéšæ®µç­‰æ•ˆç‡åŠŸèƒ½
- **UUID è­˜åˆ¥ç³»çµ±**ï¼šçµ±ä¸€ä½¿ç”¨ UUID ç¢ºä¿å…¨åŸŸå”¯ä¸€æ€§ï¼Œé¿å…ä½µç™¼è¡çª
- **é›¶æˆæœ¬é‹ç‡Ÿ**ï¼šå®Œå…¨åŸºæ–¼ Google å…è²»æœå‹™ï¼Œç„¡éœ€ç¶­è­·æˆæœ¬
- **æ°‘ä¸»æ±ºç­–**ï¼šçµ„å…§å…±è­˜æ©Ÿåˆ¶ï¼Œé¿å…å–®é»æ±ºç­–é¢¨éšª
- **è‡ªé¡˜åƒèˆ‡**ï¼šè‡ªé¡˜è©•åˆ†æ©Ÿåˆ¶ï¼Œé€éæ¿€å‹µè¨­è¨ˆä¿ƒé€²åƒèˆ‡
- **å…¬å¹³ç«¶çˆ­**ï¼šé›¶å’ŒéŠæˆ²è¨­è¨ˆï¼Œç¢ºä¿ç³»çµ±ç¶“æ¿Ÿå¹³è¡¡
- **å½ˆæ€§ç®¡ç†**ï¼šç¸½ PM åˆ¶è¡¡æ©Ÿåˆ¶ï¼Œè™•ç†å„ç¨®ç•°å¸¸ç‹€æ³
- **å®Œæ•´è¿½è¹¤**ï¼šæ“ä½œè¨˜éŒ„å’Œå¯©è¨ˆæ—¥èªŒï¼Œæ”¯æ´ç”¨æˆ¶è¡Œç‚ºå›æº¯
- **ä¸å¯è®Šè³‡æ–™æ¨¡å¼**ï¼šç³»çµ±æ¥­å‹™é‚è¼¯å¤©ç„¶æ”¯æ´ä¸å¯è®Šè³‡æ–™ï¼Œæ‰€æœ‰æ­·å²è¨˜éŒ„å®Œæ•´ä¿ç•™ï¼Œæä¾›å®Œæ•´çš„å¯©è¨ˆè»Œè·¡
- **è¤‡è£½èˆ‡ç¯„æœ¬æ”¯æ´**ï¼šæ”¯æ´å°ˆæ¡ˆè¤‡è£½ï¼ˆåŒ…å«æ‰€æœ‰éšæ®µï¼‰å’Œå–®ç¨éšæ®µè¤‡è£½åŠŸèƒ½ï¼Œæé«˜é…ç½®æ•ˆç‡ä¸¦æ¸›å°‘é‡è¤‡å·¥ä½œ

## ç³»çµ±è§’è‰²

### ç¸½ PM ç¾¤çµ„
- **æ¬Šé™**ï¼šå°ˆæ¡ˆå»ºç«‹ã€åƒæ•¸è¨­å®šã€æœ€çµ‚æ±ºç­–æ¬Šã€ç¾¤çµ„ç®¡ç†ã€æ•™å¸«æ¬Šé™
- **è·è²¬**ï¼šå»ºç«‹éšæ®µã€è¨­å®šç¾¤çµ„ã€è™•ç†ç•°å¸¸æƒ…æ³ã€è³ªé‡æŠŠé—œã€ç”¨æˆ¶åŒ¯å…¥
- **å…¨åŸŸæ¬Šé™**ï¼š`create_project`, `system_admin`, `manage_users`, `manage_groups`, `generate_invites`, `teacher_privilege`

### æ•™å¸«ç¾¤çµ„
- **æ¬Šé™**ï¼šæ•™å¸«æŠ•ç¥¨æ¬Šé™ã€æˆæœè©•å¯©ã€å­¸è¡“æ±ºç­–
- **è·è²¬**ï¼šæˆæœè©•åˆ†ã€æ’åå¯©æ ¸ã€å­¸è¡“å“è³ªæŠŠé—œã€æ•™å­¸æŒ‡å°
- **å…¨åŸŸæ¬Šé™**ï¼š`teacher_privilege`
- **è¨­è¨ˆç†å¿µ**ï¼šå°ˆæ³¨æ–¼æ•™å­¸ç›¸é—œåŠŸèƒ½ï¼Œèˆ‡ç³»çµ±ç®¡ç†æ¬Šé™åˆ†é›¢

### äº¤æˆæœäººç¾¤çµ„
- **æ¬Šé™**ï¼šæˆæœæäº¤ã€åƒèˆ‡åº¦åˆ†é…ã€é‡äº¤ç”³è«‹ã€ç¾¤çµ„å¼æ¬Šé™åƒèˆ‡
- **è·è²¬**ï¼šæŒ‰æ™‚æäº¤é«˜å“è³ªæˆæœã€å”å•†çµ„å…§åƒèˆ‡åº¦åˆ†é…

### å¯©æ ¸è€…ç¾¤çµ„
- **å¯¦éš›ä¸Š**ï¼šèˆ‡äº¤æˆæœäººç‚ºåŒä¸€ç¾¤é«”ï¼ˆäº’è©•æ©Ÿåˆ¶ï¼‰
- **æ¬Šé™**ï¼šæˆæœè©•åˆ†ã€æ’åã€è©•è«–æ’°å¯«ã€æŠ•ç¥¨å¯©æ ¸
- **è·è²¬**ï¼šå®¢è§€è©•åˆ†ã€æ’°å¯«å»ºè¨­æ€§è©•è«–ã€èªçœŸæŠ•ç¥¨

**è¨»ï¼š** æ‰€æœ‰è§’è‰²åŸºæ–¼ç¾¤çµ„å¼æ¬Šé™ç®¡ç†ï¼Œä¸€å€‹ç”¨æˆ¶å¯ä»¥åœ¨ä¸åŒå°ˆæ¡ˆä¸­æ“æœ‰ä¸åŒè§’è‰²ï¼Œæˆ–åœ¨åŒä¸€å°ˆæ¡ˆä¸­æ“æœ‰å¤šé‡è§’è‰²ã€‚æ•™å¸«æ¬Šé™(`teacher_privilege`)ç¾å·²å¾ç³»çµ±ç®¡ç†æ¬Šé™ä¸­åˆ†é›¢ï¼Œå½¢æˆç¨ç«‹çš„æ•™å¸«ç¾¤çµ„é«”ç³»ã€‚

## å‡½æ•¸å¼æ¶æ§‹è¨­è¨ˆ

### æ ¸å¿ƒæ¶æ§‹åŸå‰‡

#### åˆ†å±¤è·è²¬
- **API å±¤ (main.gs)**ï¼šçµ±ä¸€çš„ HTTP è«‹æ±‚å…¥å£é»
- **æ¥­å‹™é‚è¼¯å±¤**ï¼šå„åŠŸèƒ½é ˜åŸŸçš„ç´”é‚è¼¯é‹ç®—
- **è³‡æ–™å­˜å–å±¤ (database.gs)**ï¼šé›†ä¸­æ‰€æœ‰ Google Sheets I/O æ“ä½œ
- **å·¥å…·å‡½æ•¸å±¤**ï¼šæ¬Šé™æª¢æŸ¥ã€é…ç½®ç®¡ç†ã€å·¥å…·å‡½æ•¸

#### æ•ˆèƒ½å„ªåŒ–ç­–ç•¥
- **æ‰¹æ¬¡è¼‰å…¥**ï¼šä¸€æ¬¡è®€å–æ‰€æœ‰ç›¸é—œè³‡æ–™åˆ°è¨˜æ†¶é«”
- **è¨˜æ†¶é«”è™•ç†**ï¼šæ‰€æœ‰è¨ˆç®—åœ¨è¨˜æ†¶é«”ä¸­å®Œæˆ
- **æ‰¹æ¬¡å¯«å…¥**ï¼šæ”¶é›†æ‰€æœ‰è®Šæ›´å¾Œä¸€æ¬¡æ€§å¯«å…¥ Google Sheets
- **æŸ¥è©¢å„ªåŒ–**ï¼šå–„ç”¨ Google Sheets çš„æ‰¹æ¬¡è®€å–å’Œè¨˜æ†¶é«”ç¯©é¸åŠŸèƒ½

### æª”æ¡ˆçµ„ç¹”çµæ§‹

#### å¾Œç«¯æ¶æ§‹ (Google Apps Script)
```
scripts/
â”œâ”€â”€ main.js              # API å…¥å£é»èˆ‡è·¯ç”±
â”œâ”€â”€ database.js          # Google Sheets è³‡æ–™å­˜å–å±¤
â”œâ”€â”€ projects.js          # å°ˆæ¡ˆç®¡ç†æ¥­å‹™é‚è¼¯
â”œâ”€â”€ stages.js            # éšæ®µç®¡ç†æ¥­å‹™é‚è¼¯
â”œâ”€â”€ submissions.js       # æˆæœæäº¤æ¥­å‹™é‚è¼¯
â”œâ”€â”€ users.js             # ç”¨æˆ¶ç®¡ç†æ¥­å‹™é‚è¼¯
â”œâ”€â”€ groups.js            # ç¾¤çµ„ç®¡ç†æ¥­å‹™é‚è¼¯
â”œâ”€â”€ notifications.js     # é€šçŸ¥ç³»çµ±æ¥­å‹™é‚è¼¯
â”œâ”€â”€ scoring.js           # è©•åˆ†åŠŸèƒ½ (å¤–æ›)
â”œâ”€â”€ wallet.js            # éŒ¢åŒ…åŠŸèƒ½ (å¤–æ›)
â”œâ”€â”€ permissions.js       # æ¬Šé™æª¢æŸ¥é‚è¼¯
â”œâ”€â”€ config.js            # ç³»çµ±é…ç½®ç®¡ç† (PropertiesService + Sheets)
â”œâ”€â”€ logging.js           # çµ±ä¸€æ—¥èªŒç³»çµ± (å·²å®Œå…¨æ•´åˆconsoleè¼¸å‡º)
â””â”€â”€ utils.js             # é€šç”¨å·¥å…·å‡½æ•¸
```

#### é…ç½®ç®¡ç†ç­–ç•¥
**PropertiesService å­˜å„²:**
- ç³»çµ±æ ¸å¿ƒåƒæ•¸ (å…¨åŸŸæ´»é ç°¿ IDã€API é‡‘é‘°ç­‰)
- æ‡‰ç”¨ç¨‹å¼è¨­å®š (é è¨­å€¼ã€é™åˆ¶åƒæ•¸)
- éƒ¨ç½²ç’°å¢ƒé…ç½® (é–‹ç™¼/æ­£å¼ç’°å¢ƒåˆ‡æ›)
- å¿«å–è¨­å®šå’Œæ™‚é–“åƒæ•¸
- æ—¥èªŒæ§åˆ¶åƒæ•¸ (LOG_CONSOLE ç­‰) - æ§åˆ¶å‰å¾Œç«¯consoleè¼¸å‡ºè¡Œç‚º

**Google Sheets å­˜å„²:**
- ç”¨æˆ¶å¯é…ç½®çš„æ¥­å‹™åƒæ•¸
- å°ˆæ¡ˆç¯„æœ¬å’Œéšæ®µè¨­å®š
- å‹•æ…‹é…ç½®å’Œå¯¦é©—åŠŸèƒ½é–‹é—œ
- éœ€è¦ç‰ˆæœ¬æ§åˆ¶çš„é…ç½®é …ç›®

#### å‰ç«¯æ¶æ§‹ (Vue 3 + Element Plus)
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/      # Vue å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ layout/      # ä½ˆå±€å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ project/     # å°ˆæ¡ˆç›¸é—œå…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ stage/       # éšæ®µç®¡ç†å…ƒä»¶
â”‚   â”‚   â””â”€â”€ common/      # é€šç”¨å…ƒä»¶
â”‚   â”œâ”€â”€ composables/     # Vue 3 çµ„åˆå¼ API
â”‚   â”‚   â”œâ”€â”€ useGASApi.js # GAS API æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ useProject.js# å°ˆæ¡ˆç‹€æ…‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ useAuth.js   # èªè­‰ç‹€æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ views/           # é é¢è¦–åœ–
â”‚   â”œâ”€â”€ router/          # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ stores/          # ç‹€æ…‹ç®¡ç† (Pinia)
â”‚   â””â”€â”€ utils/           # å‰ç«¯å·¥å…·å‡½æ•¸
â”œâ”€â”€ public/              # éœæ…‹è³‡æº
â””â”€â”€ dist/                # æ§‹å»ºç”¢ç‰©
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### 1. API å±¤ (main.gs)

#### çµ±ä¸€è«‹æ±‚å…¥å£
- **doGet/doPost** å‡½æ•¸è™•ç†æ‰€æœ‰ HTTP è«‹æ±‚
- **è·¯ç”±åˆ†ç™¼**ï¼šæ ¹æ“šè«‹æ±‚é¡å‹åˆ†ç™¼åˆ°å°æ‡‰æ¥­å‹™å‡½æ•¸
- **çµ±ä¸€éŒ¯èª¤è™•ç†**ï¼šæ¨™æº–åŒ–éŒ¯èª¤å›æ‡‰æ ¼å¼
- **èº«ä»½é©—è­‰**ï¼šçµ±ä¸€çš„ç”¨æˆ¶èº«ä»½æª¢æŸ¥

#### å®‰å…¨é‚Šç•Œ
- å”¯ä¸€å°å¤–æš´éœ²çš„ä»‹é¢
- æ‰€æœ‰å…§éƒ¨å‡½æ•¸ä¸ç›´æ¥å°å¤–æš´éœ²
- å®Œæ•´çš„è¼¸å…¥é©—è­‰å’Œæ¬Šé™æª¢æŸ¥

### 2. è³‡æ–™å­˜å–å±¤ (database.js)

#### Google Sheets åˆ†ç‰‡æ¶æ§‹æ•´åˆ
- **å¤šåˆ†ç‰‡è¨­è¨ˆ**ï¼šå…¨åŸŸæ´»é ç°¿ + å°ˆæ¡ˆæ´»é ç°¿ï¼Œé¿å…å–®ä¸€è©¦ç®—è¡¨é™åˆ¶
- **æ•´è¡¨è®€å–æ¨¡å¼**ï¼šä¸€æ¬¡è®€å–å®Œæ•´å·¥ä½œè¡¨ï¼Œåœ¨è¨˜æ†¶é«”ä¸­é€²è¡Œç¯©é¸è™•ç†
- **æ´»é ç°¿è·¯ç”±**ï¼šæ™ºèƒ½è·¯ç”±ç³»çµ±ï¼Œè‡ªå‹•é¸æ“‡æ­£ç¢ºçš„æ´»é ç°¿é€²è¡Œæ“ä½œ
- **å¿«å–æ©Ÿåˆ¶**ï¼šå·¥ä½œè¡¨è³‡æ–™å¿«å–ï¼Œæ¸›å°‘ Google Sheets API èª¿ç”¨æ¬¡æ•¸
- **å”¯è®€æ–°å¢ç­–ç•¥**ï¼šç³»çµ±è¨­è¨ˆç‚ºåªåŸ·è¡Œè®€å–å’Œæ–°å¢æ“ä½œï¼Œå®Œå…¨é¿å…ä¿®æ”¹ç¾æœ‰ç´€éŒ„
- **æ‰¹æ¬¡æ–°å¢å„ªåŒ–**ï¼šæ”¶é›†æ–°è³‡æ–™å¾Œçµ±ä¸€å¯«å…¥ï¼Œæå‡å¯«å…¥æ•ˆèƒ½ä¸¦ç¶­æŒè³‡æ–™å®Œæ•´æ€§

#### å”¯è®€æ–°å¢è¨­è¨ˆåŸå‰‡
**æ ¸å¿ƒç†å¿µ**ï¼šå› æ‡‰ Google Sheets åœ¨ä¿®æ”¹æ“ä½œä¸Šçš„æ•ˆèƒ½é™åˆ¶ï¼Œç³»çµ±å¾æ ¹æœ¬æ¥­å‹™é‚è¼¯è¨­è¨ˆå°±é¿å…è³‡æ–™ä¿®æ”¹éœ€æ±‚ï¼š

**æ¥­å‹™å±¤é¢æ”¯æŒ**ï¼š
- **æäº¤ä¸å¯ä¿®æ”¹**ï¼šæˆæœä¸€æ—¦æäº¤ç¢ºå®šå°±ä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½é‡æ–°æäº¤ç”¢ç”Ÿæ–°ç´€éŒ„
- **è©•åˆ†ä¸å¯ä¿®æ”¹**ï¼šæ’åæŠ•ç¥¨ä¸€æ—¦æäº¤å°±ä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½é‡æ–°æŠ•ç¥¨ç”¢ç”Ÿæ–°ç´€éŒ„
- **çå‹µç™¼æ”¾ç´€éŒ„**ï¼šæ‰€æœ‰çå‹µäº¤æ˜“éƒ½æ˜¯æ–°å¢ç´€éŒ„ï¼Œå½¢æˆå®Œæ•´çš„äº¤æ˜“æ­·å²
- **éšæ®µç‹€æ…‹è¿½è¹¤**ï¼šéšæ®µæ¨é€²ç”¢ç”Ÿæ–°çš„ç‹€æ…‹è¨˜éŒ„ï¼Œä¿ç•™å®Œæ•´çš„ç‹€æ…‹è®Šæ›´æ­·å²

**æŠ€è¡“å±¤é¢å„ªå‹¢**ï¼š
- **æœ€ä½³æ•ˆèƒ½**ï¼šé¿å… Google Sheets ä¿®æ”¹æ“ä½œçš„æ•ˆèƒ½ç“¶é ¸
- **è³‡æ–™å®‰å…¨**ï¼šæ¸›å°‘è³‡æ–™æå£é¢¨éšªï¼Œæ‰€æœ‰æ­·å²è³‡æ–™å®Œæ•´ä¿ç•™
- **å¯©è¨ˆå®Œæ•´**ï¼šå¤©ç„¶å½¢æˆå®Œæ•´çš„å¯©è¨ˆè»Œè·¡ï¼Œæ”¯æ´å®Œæ•´çš„è¡Œç‚ºå›æº¯
- **ä½µç™¼å®‰å…¨**ï¼šé¿å…å¤šä½¿ç”¨è€…åŒæ™‚ä¿®æ”¹åŒä¸€ç´€éŒ„çš„è¡çªå•é¡Œ

#### åˆ†ç‰‡ç®¡ç†åŠŸèƒ½
```javascript
// æ´»é ç°¿ç®¡ç†
function getGlobalWorkbook() { ... }
function getProjectWorkbook(projectId) { ... }
function createProjectWorkbook(projectId, projectName) { ... }

// è³‡æ–™è®€å–æ“ä½œ
function readGlobalData() { ... }
function readProjectData(projectId) { ... }
function readFullSheet(workbook, sheetName) { ... }

// è³‡æ–™æ–°å¢æ“ä½œï¼ˆå”¯è®€æ–°å¢è¨­è¨ˆï¼‰
function addRowToSheet(projectId, sheetName, data) { ... }
function batchAddToSheet(projectId, sheetName, dataArray) { ... }
// æ³¨æ„ï¼šç³»çµ±è¨­è¨ˆç‚ºä¸ä¿®æ”¹ç¾æœ‰ç´€éŒ„ï¼Œæ‰€æœ‰ç‹€æ…‹è®Šæ›´éƒ½é€éæ–°å¢ç´€éŒ„å¯¦ç¾

// è¨˜æ†¶é«”ç¯©é¸
function filterDataInMemory(data, filters) { ... }
function searchDataInMemory(data, searchTerm, fields) { ... }
```

#### UUID è­˜åˆ¥ç³»çµ±
- **çµ±ä¸€ ID ç”Ÿæˆ**ï¼šæ‰€æœ‰å¯¦é«”ä½¿ç”¨ UUID ç¢ºä¿å…¨åŸŸå”¯ä¸€æ€§
- **é¡å‹åŒ–å‰ç¶´**ï¼šä½¿ç”¨é¡å‹å‰ç¶´ä¾¿æ–¼è­˜åˆ¥å’Œé™¤éŒ¯
- **ç„¡è¡çªä¿è­‰**ï¼šé¿å…ä½µç™¼å­˜å–æ™‚çš„ ID è¡çªå•é¡Œ

### 3. æ¥­å‹™é‚è¼¯å±¤

#### å°ˆæ¡ˆç®¡ç† (projects.gs)
- **å°ˆæ¡ˆå»ºç«‹**ï¼šå°ˆæ¡ˆåˆå§‹åŒ–å’Œè¨­å®š
- **éšæ®µç®¡ç†**ï¼šéšæ®µæ¨é€²å’Œç‹€æ…‹æ§åˆ¶
- **æˆå“¡ç®¡ç†**ï¼šå°ˆæ¡ˆæˆå“¡åˆ†é…å’Œæ¬Šé™è¨­å®š
- **å°ˆæ¡ˆç›£æ§**ï¼šé€²åº¦è¿½è¹¤å’Œç‹€æ…‹å ±å‘Š

#### æˆæœæäº¤ (submissions.gs)
- **æäº¤æµç¨‹**ï¼šæˆæœæäº¤å’Œæš«å­˜æ©Ÿåˆ¶
- **çµ„å…§å…±è­˜**ï¼šæäº¤ç¢ºèªå’Œå”å•†æ©Ÿåˆ¶
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šå…§å®¹ç‰ˆæœ¬ç®¡ç†å’Œæ¯”è¼ƒ
- **é‡äº¤æ©Ÿåˆ¶**ï¼šæœŸé™å…§é‡æ–°æäº¤è™•ç†

#### éšæ®µç®¡ç† (stages.gs)
- **éšæ®µé…ç½®**ï¼šéšæ®µåƒæ•¸å’Œè¦å‰‡è¨­å®š
- **ç”Ÿå‘½é€±æœŸæ§åˆ¶**ï¼špending â†’ active â†’ voting â†’ completed ç‹€æ…‹æµç¨‹
- **è‡ªå‹•å·¡é‚**ï¼šå®šæ™‚æª¢æŸ¥éæœŸéšæ®µï¼Œè‡ªå‹•è½‰æ›ç‚ºæŠ•ç¥¨ç‹€æ…‹
- **æŠ•ç¥¨æ©Ÿåˆ¶**ï¼šæŠ•ç¥¨åŠŸèƒ½åªåœ¨votingç‹€æ…‹å•Ÿç”¨ï¼Œç¢ºä¿æŠ•ç¥¨æ™‚æ©Ÿ
- **åƒèˆ‡ç¢ºèª**ï¼šæˆå“¡åƒèˆ‡æ„é¡˜ç¢ºèªæ©Ÿåˆ¶
- **ç‹€æ…‹ç®¡ç†**ï¼šéšæ®µç‹€æ…‹è¿½è¹¤å’Œæ›´æ–°

#### ç”¨æˆ¶ç®¡ç† (users.gs)
- **ç”¨æˆ¶è¨»å†Š**ï¼šé‚€è«‹ç¢¼æ©Ÿåˆ¶å’Œæ‰¹é‡åŒ¯å…¥
- **é‚€è«‹æµç¨‹**ï¼š
  1. ç®¡ç†å“¡è¼¸å…¥ç›®æ¨™ç”¨æˆ¶çš„ Email
  2. ç³»çµ±ç”Ÿæˆå°ˆå±¬é‚€è«‹ç¢¼
  3. ç™¼é€é‚€è«‹éƒµä»¶çµ¦è©²ç”¨æˆ¶
  4. ç”¨æˆ¶ä½¿ç”¨é‚€è«‹ç¢¼è¨»å†Š
- **ç¾¤çµ„ç®¡ç†**ï¼šç”¨æˆ¶ç¾¤çµ„åŠ å…¥å’Œæ¬Šé™ç®¡ç†
- **è‡ªåŠ©ç¾¤çµ„åŠ å…¥**ï¼šç”¨æˆ¶å¯åŠ å…¥é–‹æ”¾ç¾¤çµ„ï¼Œç¸½ PM å¯å¼·åˆ¶æ“ä½œ
- **èªè­‰ç®¡ç†**ï¼šç”¨æˆ¶å/å¯†ç¢¼èªè­‰ç³»çµ±

#### ç¾¤çµ„ç®¡ç† (groups.gs)
- **ç¾¤çµ„å»ºç«‹**ï¼šå»ºç«‹å’Œé…ç½®ç¾¤çµ„åŸºæœ¬è³‡è¨Š
- **æˆå“¡ç®¡ç†**ï¼šç¾¤çµ„æˆå“¡çš„åŠ å…¥å’Œç§»é™¤
- **æ¬Šé™åˆ†é…**ï¼šç¾¤çµ„åœ¨ä¸åŒå°ˆæ¡ˆä¸­çš„è§’è‰²å’Œæ¬Šé™
- **ç¾¤çµ„é‡ç”¨**ï¼šè·¨å°ˆæ¡ˆçš„ç¾¤çµ„é‡ç”¨æ©Ÿåˆ¶

#### æ¨™ç±¤ç®¡ç† (tags_api.js)
- **å…¨åŸŸæ¨™ç±¤ç³»çµ±**ï¼šçµ±ä¸€çš„æ¨™ç±¤å‰µå»ºå’Œç®¡ç†æ©Ÿåˆ¶
- **ç°¡åŒ–è¨­è¨ˆ**ï¼šç§»é™¤æ¨™ç±¤åˆ†é¡(category)å±¬æ€§ï¼Œç°¡åŒ–æ¨™ç±¤çµæ§‹
- **å½©è‰²æ¨™ç±¤**ï¼šè‡ªè¨‚æ¨™ç±¤é¡è‰²ï¼Œæä¾›è¦–è¦ºåŒ–åˆ†é¡
- **æ¬Šé™æ§åˆ¶**ï¼šç³»çµ±ç®¡ç†å“¡ç®¡ç†æ¨™ç±¤ï¼Œå°ˆæ¡ˆç®¡ç†è€…æŒ‡æ´¾æ¨™ç±¤
- **æ¨™ç±¤æŒ‡æ´¾**ï¼š
  - å°ˆæ¡ˆæ¨™ç±¤ï¼šå°ˆæ¡ˆç®¡ç†è€…å¯ç‚ºå°ˆæ¡ˆæŒ‡æ´¾æ¨™ç±¤é€²è¡Œåˆ†é¡
  - ç”¨æˆ¶æ¨™ç±¤ï¼šç³»çµ±ç®¡ç†å“¡å¯ç‚ºç”¨æˆ¶æŒ‡æ´¾æŠ€èƒ½æˆ–éƒ¨é–€æ¨™ç±¤
- **åš´æ ¼ä½œç”¨åŸŸ**ï¼šåªæœ‰å®Œå…¨ç›¸åŒæ¨™ç±¤é›†åˆçš„å¯¦é«”èƒ½äº’ç›¸è¨ªå•
- **è»Ÿåˆªé™¤æ©Ÿåˆ¶**ï¼šæ¨™ç±¤åœç”¨è€Œéåˆªé™¤ï¼Œä¿æŒè³‡æ–™å®Œæ•´æ€§
- **é—œè¯ç®¡ç†**ï¼šè‡ªå‹•ç®¡ç†æ¨™ç±¤èˆ‡å°ˆæ¡ˆ/ç”¨æˆ¶çš„é—œè¯é—œä¿‚

### 4. å·¥ä½œè¡¨çµæ§‹ç¯„æœ¬å®šç¾©

#### å”¯è®€æ–°å¢è¨­è¨ˆï¼šçµæ§‹å®šç¾©åœ¨ä»£ç¢¼ä¸­

**ç‚ºä»€éº¼ä¸å­˜åœ¨ Templates å·¥ä½œè¡¨ï¼Ÿ**

ç³»çµ±è¨­è¨ˆéµå¾ª **å”¯è®€æ–°å¢è¨­è¨ˆåŸå‰‡**ï¼Œæ‰€æœ‰å·¥ä½œè¡¨çµæ§‹å®šç¾©éƒ½ç›´æ¥å¯«åœ¨ä»£ç¢¼ä¸­ï¼Œè€Œéå­˜å„²åœ¨æ•¸æ“šåº«ä¸­ã€‚åŸå› ï¼š

1. **åˆ†ç‰‡æ•¸æ“šåº«ç‰¹æ€§**ï¼šæ¯å€‹æ–°å°ˆæ¡ˆéƒ½éœ€è¦å‰µå»ºç¨ç«‹çš„å°ˆæ¡ˆæ´»é ç°¿
2. **å·¥ä½œè¡¨çµæ§‹å›ºå®š**ï¼šæ¯å€‹æ´»é ç°¿éƒ½éœ€è¦ç›¸åŒçš„å·¥ä½œè¡¨çµæ§‹å’Œæ¬„ä½
3. **ç³»çµ±ç©©å®šæ€§**ï¼šçµæ§‹å®šç¾©å±¬æ–¼ç³»çµ±æ ¸å¿ƒï¼Œä¸æ‡‰è©²åœ¨é‹è¡Œæ™‚ä¿®æ”¹

#### çµæ§‹ç¯„æœ¬çš„ä»£ç¢¼å¯¦ç¾

**é‡è¦ï¼šå»ºè­°å°‡ç¯„æœ¬å®šç¾©ç¨ç«‹æˆæª”æ¡ˆä¾¿æ–¼ç¶­è­·**

**ğŸ‘¤ äººå·¥ä½œæ¥­ vs ğŸ¤– ç¨‹å¼è‡ªå‹•åŒ–åˆ†å·¥**ï¼š

**ğŸ‘¤ ä½ åªéœ€è¦åšçš„**ï¼š
1. **è¨­å®šè³‡æ–™åº«ç›®éŒ„**ï¼šåœ¨ PropertiesService ä¸­è¨­å®š `DATABASE_FOLDER_ID`
2. **ï¼ˆå¦‚éœ€ï¼‰èª¿æ•´å…¨åŸŸæ´»é ç°¿**ï¼šæ‰‹å‹•èª¿æ•´ç³»çµ±é è¨­é…ç½®

**ğŸ¤– ç¨‹å¼å®Œå…¨è‡ªå‹•è™•ç†**ï¼š
- âœ… æ‰€æœ‰å·¥ä½œè¡¨çµæ§‹å‰µå»º
- âœ… æ‰€æœ‰å°ˆæ¡ˆæ´»é ç°¿å‰µå»º  
- âœ… æ‰€æœ‰æ¬„ä½å®šç¾©å’Œæ¨™é¡Œè¨­å®š
- âœ… æ‰€æœ‰å·¥ä½œè¡¨æ ¼å¼åŒ–

**å»ºè­°çš„æª”æ¡ˆçµæ§‹**ï¼š

```javascript
// scripts/database_schemas.js - å·¥ä½œè¡¨çµæ§‹ç¯„æœ¬ï¼ˆå»ºè­°ç¨ç«‹æª”æ¡ˆï¼‰
// ç”¨é€”ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰å·¥ä½œè¡¨æ¬„ä½å®šç¾©ï¼Œæ–¹ä¾¿äººå·¥ç¶­è­·

/**
 * å…¨åŸŸæ´»é ç°¿å·¥ä½œè¡¨çµæ§‹
 * ç”¨é€”ï¼šå®šç¾©è·¨å°ˆæ¡ˆå…±äº«çš„è³‡æ–™è¡¨æ¬„ä½
 */
const GLOBAL_WORKBOOK_SCHEMAS = {
  // å°ˆæ¡ˆç¸½è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„ç³»çµ±ä¸­æ‰€æœ‰å°ˆæ¡ˆçš„åŸºæœ¬è³‡è¨Š
  Projects: [
    'projectId',      // å°ˆæ¡ˆå”¯ä¸€è­˜åˆ¥ç¢¼ (UUID)
    'projectName',    // å°ˆæ¡ˆåç¨±
    'description',    // å°ˆæ¡ˆæè¿°
    'totalStages',    // ç¸½éšæ®µæ•¸
    'currentStage',   // ç•¶å‰éšæ®µ
    'status',         // å°ˆæ¡ˆç‹€æ…‹ (active/completed/archived)
    'createdBy',      // å»ºç«‹è€… Email
    'createdTime',    // å»ºç«‹æ™‚é–“ (timestamp)
    'lastModified',   // æœ€å¾Œä¿®æ”¹æ™‚é–“ (timestamp)
    'workbookId'      // å°æ‡‰çš„å°ˆæ¡ˆæ´»é ç°¿ ID
  ],
  
  // ç³»çµ±ç”¨æˆ¶ç¸½è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„ç³»çµ±ä¸­æ‰€æœ‰ç”¨æˆ¶çš„åŸºæœ¬è³‡è¨Š
  Users: [
    'userId',         // ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼ (UUID)
    'userEmail',      // ç”¨æˆ¶ Email (ä¸»éµ)
    'displayName',    // é¡¯ç¤ºåç¨±
    'registrationTime', // è¨»å†Šæ™‚é–“ (timestamp)
    'lastLoginTime',  // æœ€å¾Œç™»å…¥æ™‚é–“ (timestamp)
    'status',         // ç”¨æˆ¶ç‹€æ…‹ (active/suspended)
    'preferences'     // ç”¨æˆ¶åå¥½è¨­å®š (JSON)
  ],
  
  // ç³»çµ±è¨­å®šåƒæ•¸è¡¨ - ç”¨é€”ï¼šå­˜æ”¾å¯èª¿æ•´çš„ç³»çµ±è¨­å®šå€¼
  SystemConfigs: [
    'configKey',      // è¨­å®šé …ç›®éµå€¼
    'configValue',    // è¨­å®šé …ç›®å€¼
    'description',    // è¨­å®šèªªæ˜
    'category',       // è¨­å®šåˆ†é¡ (timing/scoring/system/invitations)
    'lastModified',   // æœ€å¾Œä¿®æ”¹æ™‚é–“ (timestamp)
    'createdBy'       // è¨­å®šè€…
  ],
  
  // é‚€è«‹ç¢¼ç®¡ç†è¡¨ - ç”¨é€”ï¼šè¿½è¹¤ç³»çµ±ç™¼å‡ºçš„æ‰€æœ‰é‚€è«‹ç¢¼
  Invitations: [
    'invitationId',   // é‚€è«‹ç¢¼å”¯ä¸€è­˜åˆ¥ç¢¼ (UUID)
    'invitationCode', // é‚€è«‹ç¢¼ (åŠ å¯†å­˜å„²)
    'targetEmail',    // ç›®æ¨™ç”¨æˆ¶ Email
    'createdBy',      // å»ºç«‹è€… Email
    'createdTime',    // å»ºç«‹æ™‚é–“ (timestamp)
    'expiryTime',     // éæœŸæ™‚é–“ (timestamp)
    'usedTime',       // ä½¿ç”¨æ™‚é–“ (timestamp)
    'status',         // ç‹€æ…‹ (pending/used/expired)
    'metadata'        // é¡å¤–è³‡è¨Š (JSON)
  ]
};

/**
 * å°ˆæ¡ˆæ´»é ç°¿å·¥ä½œè¡¨çµæ§‹
 * ç”¨é€”ï¼šå®šç¾©æ¯å€‹å°ˆæ¡ˆç¨ç«‹æ´»é ç°¿çš„å·¥ä½œè¡¨æ¬„ä½
 */
const PROJECT_WORKBOOK_SCHEMAS = {
  // å°ˆæ¡ˆè©³ç´°è³‡è¨Šè¡¨ - ç”¨é€”ï¼šè©²å°ˆæ¡ˆçš„è©³ç´°è¨­å®šå’Œç‹€æ…‹
  ProjectInfo: [
    'projectId', 'projectName', 'description', 'totalStages', 
    'currentStage', 'status', 'createdBy', 'createdTime', 'lastModified'
  ],
  
  // ç¾¤çµ„åŸºæœ¬è³‡æ–™è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„å°ˆæ¡ˆä¸­çš„æ‰€æœ‰ç¾¤çµ„
  Groups: [
    'groupId', 'groupName', 'description', 'createdBy', 
    'createdTime', 'status', 'allowChange'
  ],
  
  // ç”¨æˆ¶ç¾¤çµ„é—œè¯è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„ç”¨æˆ¶å’Œç¾¤çµ„çš„é—œä¿‚
  UserGroups: [
    'membershipId', 'groupId', 'userEmail', 'role', 'joinTime', 'isActive'
  ],
  
  // éšæ®µè³‡æ–™è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„å°ˆæ¡ˆçš„å„å€‹éšæ®µè¨­å®š
  Stages: [
    'stageId', 'stageName', 'description', 'startDate', 'endDate', 
    'status', 'consensusDeadline'  // status: pending|active|voting|completed
  ],
  
  // æˆæœæäº¤è¨˜éŒ„è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„æ‰€æœ‰æˆæœæäº¤ï¼ˆå”¯è®€æ–°å¢ï¼‰
  Submissions: [
    'submissionId', 'stageId', 'groupId', 'contentMarkdown', 
    'actualAuthors', 'submissionTime', 'lastModified'
  ],
  
  // æ’åçµæœè¡¨ - ç”¨é€”ï¼šè¨˜éŒ„å„ç¾¤çµ„çš„æ’åæŠ•ç¥¨ï¼ˆå”¯è®€æ–°å¢ï¼‰
  Rankings: [
    'rankingId', 'stageId', 'groupId', 'rankings', 'submittedBy', 'submissionTime'
  ],
  
  // è©•è«–è³‡æ–™è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„æ‰€æœ‰è©•è«–å’Œå›è¦†ï¼ˆå”¯è®€æ–°å¢ï¼‰
  Comments: [
    'commentId', 'stageId', 'authorEmail', 'content', 'mentionedGroups', 
    'parentCommentId', 'isReply', 'replyLevel', 'createdTime'
  ],
  
  // æŠ•ç¥¨è¨˜éŒ„è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„å„ç¨®æŠ•ç¥¨æ´»å‹•ï¼ˆå”¯è®€æ–°å¢ï¼‰
  Votes: [
    'voteId', 'stageId', 'voterEmail', 'voteType', 'voteData', 'voteTime'
  ],
  
  // å€‹äººéŒ¢åŒ…è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„ç”¨æˆ¶çš„è™›æ“¬é»æ•¸é¤˜é¡ï¼ˆå¤–æ›åŠŸèƒ½ï¼‰
  Wallets: [
    'walletId', 'userEmail', 'currentBalance', 'totalEarned', 
    'totalSpent', 'lastUpdated', 'metadata'
  ],
  
  // äº¤æ˜“è¨˜éŒ„è¡¨ - ç”¨é€”ï¼šè¨˜éŒ„æ‰€æœ‰é»æ•¸äº¤æ˜“ï¼ˆå¤–æ›åŠŸèƒ½ï¼Œå”¯è®€æ–°å¢ï¼‰
  Transactions: [
    'transactionId', 'userEmail', 'amount', 'transactionType', 
    'description', 'relatedEntityId', 'timestamp'
  ],
  
  // æ“ä½œæ—¥èªŒè¡¨ - ç”¨é€”ï¼šè¨˜éŒ„æ‰€æœ‰ç”¨æˆ¶æ“ä½œä»¥ä¾¿å¯©è¨ˆï¼ˆå”¯è®€æ–°å¢ï¼‰
  EventLogs: [
    'logId', 'userEmail', 'action', 'entityType', 'entityId', 
    'details', 'timestamp', 'ipAddress'
  ]
};

/**
 * ç²å–å·¥ä½œè¡¨çµæ§‹å®šç¾©çš„å‡½æ•¸
 * ç”¨é€”ï¼šæä¾›çµ¦å…¶ä»–æ¨¡çµ„èª¿ç”¨ï¼Œå–å¾—æ­£ç¢ºçš„æ¬„ä½å®šç¾©
 */
function getGlobalWorkbookSchema() {
  return GLOBAL_WORKBOOK_SCHEMAS;
}

function getProjectWorkbookSchema() {
  return PROJECT_WORKBOOK_SCHEMAS;
}

// å°å‡ºä¾›å…¶ä»–æª”æ¡ˆä½¿ç”¨
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { 
    getGlobalWorkbookSchema, 
    getProjectWorkbookSchema 
  };
}
```

**ç‚ºä»€éº¼å»ºè­°ç”¨é™£åˆ—å­˜æ¬„ä½åç¨±ï¼Ÿ**
1. **ç°¡å–®æ˜“è®€**ï¼šç´”ç²¹çš„æ¬„ä½åç¨±åˆ—è¡¨ï¼Œä¸å«è¤‡é›œé‚è¼¯
2. **æ˜“æ–¼ç¶­è­·**ï¼šäººå·¥å¯ä»¥å¿«é€Ÿèª¿æ•´æ¬„ä½é †åºå’Œåç¨±
3. **ç‰ˆæœ¬æ§åˆ¶å‹å–„**ï¼šGit diff å¯ä»¥æ¸…æ¥šé¡¯ç¤ºæ¬„ä½è®Šæ›´
4. **é¿å…éŒ¯èª¤**ï¼šç°¡å–®çš„è³‡æ–™çµæ§‹æ¸›å°‘å‡ºéŒ¯æ©Ÿæœƒ

#### é€™ç¨®è¨­è¨ˆçš„å„ªå‹¢

1. **ç‰ˆæœ¬æ§åˆ¶**ï¼šçµæ§‹è®Šæ›´æœ‰æ¸…æ¥šçš„ç‰ˆæœ¬æ­·å²
2. **éƒ¨ç½²ä¸€è‡´æ€§**ï¼šæ‰€æœ‰ç’°å¢ƒä½¿ç”¨ç›¸åŒçš„çµæ§‹å®šç¾©  
3. **ç¶­è­·ç°¡ä¾¿**ï¼šä¸éœ€è¦é¡å¤–çš„ç¯„æœ¬ç®¡ç† UI
4. **æ•ˆèƒ½å„ªè¶Š**ï¼šé¿å…é¡å¤–çš„ç¯„æœ¬æŸ¥è©¢æ“ä½œ
5. **ç³»çµ±ç©©å®š**ï¼šçµæ§‹å®šç¾©ä¸æœƒè¢«æ„å¤–ä¿®æ”¹

### 5. å¤–æ›åŠŸèƒ½æ¨¡çµ„

#### è©•åˆ†å¼•æ“ (scoring.gs)
- **å•Ÿç”¨æ¢ä»¶**ï¼š`config.scoring.enabled = true`
- **æ’åè¨ˆç®—**ï¼šäº’è©•çµæœçµ±è¨ˆå’Œæ’åç”Ÿæˆ
- **çå‹µé‚è¼¯**ï¼šçé‡‘åˆ†é…è¦å‰‡å’Œè¨ˆç®—
- **ç¸½ PM åˆ¶è¡¡**ï¼šåŠ æ¬Šå¹³å‡å’Œå¦æ±ºæ¬Šæ©Ÿåˆ¶
- **è©•è«–çå‹µ**ï¼šæœ€ä½³è©•è«–é¸æ“‡å’Œçå‹µç™¼æ”¾

##### è©•è«–æ’åé…ç½® (Comment Ranking Configuration)

ç³»çµ±æ”¯æ´å…©ç¨®äº’æ–¥çš„è©•è«–çå‹µæ¨¡å¼ï¼Œé€éå°ˆæ¡ˆå±¤ç´šé…ç½®æ§åˆ¶ï¼š

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `maxCommentSelections` | INTEGER | å›ºå®š TOP N æ¨¡å¼çš„è©•è«–æ•¸é‡ä¸Šé™ï¼ˆ1-10ï¼‰ |
| `commentRewardPercentile` | REAL | ç™¾åˆ†æ¯”æ¨¡å¼é–¾å€¼ï¼ˆ0-100ï¼‰ |

**äº’æ–¥é‚è¼¯**ï¼š
- `commentRewardPercentile = 0` â†’ ä½¿ç”¨ `maxCommentSelections` ä½œç‚ºå›ºå®šç²çäººæ•¸
- `commentRewardPercentile > 0` â†’ å‹•æ…‹è¨ˆç®— `Math.ceil(uniqueAuthors * percentile / 100)`

**è³‡æ–™æµ**ï¼š
1. å°ˆæ¡ˆå‰µå»ºæ™‚è¨­ç½®é€™å…©å€‹æ¬„ä½
2. å‰ç«¯é€šé `useProjectCore` TanStack Query ç²å–å°ˆæ¡ˆè³‡æ–™ï¼ˆåŒ…å«é€™å…©å€‹æ¬„ä½ï¼‰
3. å­çµ„ä»¶é€šé props æ¥æ”¶ `maxCommentSelections`ï¼ˆå¿…éœ€ï¼Œç„¡é è¨­å€¼ï¼‰
4. çµç®—æ™‚å¾Œç«¯ä½¿ç”¨ `calculateCommentRewardLimit()` è¨ˆç®—å¯¦éš›ç²çäººæ•¸

**å‰ç«¯çµ„ä»¶æ•´åˆ**ï¼š
- `CommentVoteModal` - å­¸ç”Ÿè©•è«–æŠ•ç¥¨æ™‚çš„é¸æ“‡ä¸Šé™
- `TeacherVoteModal` - æ•™å¸«è©•è«–æ’åæ™‚çš„é¸æ“‡ä¸Šé™
- `SubmitCommentModal` - é è¦½çé‡‘åˆ†é…æ™‚çš„æ’åé¸é …
- `CommentVotingAnalysisModal` - åˆ†æçµæœæ™‚çš„æ’ååˆ†å¸ƒçµ±è¨ˆ

#### éŒ¢åŒ…ç³»çµ± (wallet.gs)
- **ä¾è³´æ¢ä»¶**ï¼šä¾è³´è©•åˆ†åŠŸèƒ½å•Ÿç”¨
- **è³¬å†Šç®¡ç†**ï¼šTransactions è¡¨è¨˜éŒ„æ‰€æœ‰çå‹µæ˜ç´°
- **é¤˜é¡è¨ˆç®—**ï¼šå‹•æ…‹è¨ˆç®—ç”¨æˆ¶ç¸½ç²å¾—çå‹µ
- **çå‹µåˆ†é…**ï¼šå€‹äººåŒ–çå‹µç›´æ¥è¨˜éŒ„åˆ°äº¤æ˜“è¡¨
- **æ­·å²è¿½è¹¤**ï¼šå®Œæ•´çš„çå‹µä¾†æºå’Œæ™‚é–“è¨˜éŒ„

### 5. åŸºç¤è¨­æ–½å±¤

#### æ¬Šé™ç®¡ç† (permissions.gs)
- **æ¬Šé™æª¢æŸ¥**ï¼šç´”é‚è¼¯é‹ç®—ï¼Œä¸ç›´æ¥å­˜å–è³‡æ–™åº«
- **ç¾¤çµ„é©—è­‰**ï¼šåŸºæ–¼ç”¨æˆ¶ç¾¤çµ„é—œä¿‚çš„æ¬Šé™åˆ¤æ–·
- **è§’è‰²ç®¡ç†**ï¼šå‹•æ…‹è§’è‰²åˆ†é…å’Œæ¬Šé™æ§åˆ¶
- **å­˜å–æ§åˆ¶**ï¼šè³‡æºå­˜å–æ¬Šé™é©—è­‰

#### é…ç½®ç®¡ç† (config.gs)
- **ç³»çµ±é…ç½®**ï¼šæ ¸å¿ƒåŠŸèƒ½åƒæ•¸è¨­å®š
- **å¤–æ›æ§åˆ¶**ï¼šåŠŸèƒ½æ¨¡çµ„å•Ÿç”¨/åœç”¨é–‹é—œ
- **ç’°å¢ƒè®Šæ•¸**ï¼šä¸åŒéƒ¨ç½²ç’°å¢ƒçš„é…ç½®æ”¯æ´
- **å‹•æ…‹é…ç½®**ï¼šé‹è¡Œæ™‚é…ç½®ä¿®æ”¹æ”¯æ´

#### å·¥å…·å‡½æ•¸ (utils.js)
- **éŒ¯èª¤è™•ç†**ï¼šçµ±ä¸€çš„éŒ¯èª¤è™•ç†å’Œå›æ‡‰æ ¼å¼
- **è³‡æ–™é©—è­‰**ï¼šè¼¸å…¥è³‡æ–™æ ¼å¼é©—è­‰
- **æ—¥æœŸè™•ç†**ï¼šæ™‚é–“æˆ³å’Œæ—¥æœŸæ ¼å¼è½‰æ›
- **UUID ç”Ÿæˆ**ï¼šçµ±ä¸€çš„ UUID ç”Ÿæˆæ©Ÿåˆ¶
- **Session ç®¡ç†**ï¼šåŸºæ–¼ UserPropertiesService çš„ session è™•ç†
- **é€šç”¨é‚è¼¯**ï¼šè·¨æ¨¡çµ„å…±ç”¨çš„å·¥å…·å‡½æ•¸

### 6. å‰ç«¯æ¶æ§‹ç³»çµ± (Vue 3 + Element Plus)

#### ç¾ä»£åŒ–å‰ç«¯æ¶æ§‹
ç³»çµ±å‰ç«¯æ¡ç”¨ Vue 3 + Element Plus æŠ€è¡“æ£§ï¼Œæä¾›éŸ¿æ‡‰å¼ã€ç¾ä»£åŒ–çš„ç”¨æˆ¶ä»‹é¢é«”é©—ã€‚é€é Composition API å’Œè‡ªå®šç¾© composables å¯¦ç¾èˆ‡ Google Apps Script å¾Œç«¯çš„ç„¡ç¸«æ•´åˆã€‚

#### å‰ç«¯æŠ€è¡“æ£§
- **æ ¸å¿ƒæ¡†æ¶**ï¼šVue 3 (Composition API)
- **UI çµ„ä»¶åº«**ï¼šElement Plus (æ¨™æº–åŒ– el-drawer å½ˆçª—)
- **åœ–æ¨™åº«**ï¼šFontAwesome 6
- **æ•¸æ“šè¦–è¦ºåŒ–**ï¼šD3.js v7 (ç”¨æ–¼æŠ•ç¥¨çµæœåœ–è¡¨)
- **Markdown è™•ç†**ï¼šmarked.js
- **XSS é˜²è­·**ï¼šDOMPurify
- **æ™‚é–“è™•ç†**ï¼šDay.js
- **å¤šèªè¨€æ”¯æ´**ï¼šElement Plus ä¸­æ–‡èªè¨€åŒ…
- **ç‹€æ…‹ç®¡ç†**ï¼šäº‹ä»¶é©…å‹•æ¶æ§‹ (CustomEvent)
- **è¨ˆæ™‚å™¨ç®¡ç†**ï¼šå…§å»º timer cleanup æ©Ÿåˆ¶
- **éƒ¨ç½²æ–¹å¼**ï¼šCDN æ•´åˆ (ç„¡éœ€æ§‹å»ºå·¥å…·)
- **é–‹ç™¼èªè¨€**ï¼šJavaScript (ES5 å…¼å®¹)

#### äº‹ä»¶é©…å‹•æ¶æ§‹

##### ç™»å…¥ç‹€æ…‹ç®¡ç†
ç³»çµ±æ¡ç”¨äº‹ä»¶é©…å‹•æ¶æ§‹ç®¡ç†ç™»å…¥ç‹€æ…‹ï¼Œé¿å…é é¢é‡æ–°è¼‰å…¥ï¼š

```javascript
// ç™¼é€ç™»å…¥æˆåŠŸäº‹ä»¶
window.dispatchEvent(new CustomEvent('auth-state-changed', {
  detail: { 
    type: 'login-success', 
    user: userData.user,
    sessionId: userData.sessionId 
  }
}))

// App.vue ç›£è½ç™»å…¥ç‹€æ…‹è®ŠåŒ–
window.addEventListener('auth-state-changed', this.handleAuthStateChange)

// è‡ªå‹•é‡æ–°è¼‰å…¥ç•¶å‰é é¢æ•¸æ“š
async refreshCurrentPageData() {
  if (this.currentPage === 'dashboard' && this.$refs.dashboard) {
    await this.$refs.dashboard.loadProjects()
  }
  if (this.currentPage === 'project' && this.$refs.projectDetail) {
    await this.$refs.projectDetail.loadProjectData()
  }
}
```

##### è¨ˆæ™‚å™¨ç®¡ç†
ç³»çµ±å…§å»ºè¨ˆæ™‚å™¨ç®¡ç†æ©Ÿåˆ¶ï¼Œé˜²æ­¢è¨˜æ†¶é«”æ´©æ¼ï¼š

```javascript
// é©—è­‰ç¢¼å€’æ•¸è¨ˆæ™‚å™¨
startVerificationTimer() {
  this.verificationCodeExpiry = Date.now() + (10 * 60 * 1000)
  this.verificationTimer = setInterval(() => {
    const remainingMs = this.verificationCodeExpiry - Date.now()
    this.verificationRemainingTime = Math.ceil(remainingMs / 1000)
    
    if (remainingMs <= 0) {
      this.clearVerificationTimer()
    }
  }, 1000)
}

// æ¸…ç†è¨ˆæ™‚å™¨æ–¹æ³•
clearVerificationTimer() {
  if (this.verificationTimer) {
    clearInterval(this.verificationTimer)
    this.verificationTimer = null
  }
}

// çµ„ä»¶éŠ·æ¯€æ™‚è‡ªå‹•æ¸…ç†
beforeUnmount() {
  this.clearVerificationTimer()
}
```

#### å‰ç«¯æŠ€è¡“è¦ç¯„

##### CDN ä¾è³´è¼‰å…¥é †åº
æ‰€æœ‰å‰ç«¯ä¾è³´é€šé CDN è¼‰å…¥ï¼Œç¢ºä¿åœ¨ GAS ç’°å¢ƒä¸­çš„å…¼å®¹æ€§ï¼š

```html
<!-- æ ¸å¿ƒä¾è³´ -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
<script src="https://unpkg.com/element-plus/dist/locale/zh-tw.min.js"></script>

<!-- åŠŸèƒ½ä¾è³´ -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.7/dist/purify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.9/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.9/locale/zh-tw.js"></script>

<!-- æ•¸æ“šè¦–è¦ºåŒ– -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
```

##### ä¾è³´æª¢æŸ¥æ©Ÿåˆ¶
å¯¦ä½œä¾è³´è¼‰å…¥æª¢æŸ¥ï¼Œç¢ºä¿æ‰€æœ‰åº«è¼‰å…¥å®Œæˆå¾Œæ‰åˆå§‹åŒ–æ‡‰ç”¨ï¼š

```javascript
function checkDependencies() {
  const dependencies = [
    { name: 'Vue', check: () => typeof Vue !== 'undefined' },
    { name: 'ElementPlus', check: () => typeof ElementPlus !== 'undefined' },
    { name: 'marked', check: () => typeof marked !== 'undefined' },
    { name: 'DOMPurify', check: () => typeof DOMPurify !== 'undefined' },
    { name: 'dayjs', check: () => typeof dayjs !== 'undefined' },
    { name: 'D3', check: () => typeof d3 !== 'undefined' }
  ];
  
  const missing = dependencies.filter(dep => !dep.check());
  return missing.length === 0;
}
```

##### Vue 3 æ‡‰ç”¨åˆå§‹åŒ–æ¨¡å¼
ç‚ºé¿å… GAS iframe ç’°å¢ƒä¸­çš„è¼‰å…¥å•é¡Œï¼Œæ¡ç”¨å»¶é²åˆå§‹åŒ–æ¨¡å¼ï¼š

```javascript
// ç­‰å¾…ä¾è³´è¼‰å…¥å®Œæˆ
const dependencyInterval = setInterval(() => {
  if (checkDependencies()) {
    clearInterval(dependencyInterval);
    initializeVueApp();
  }
}, 200);

function initializeVueApp() {
  const { createApp } = Vue;
  const { ElMessage, ElLoading } = ElementPlus;
  
  const app = createApp({
    // æ‡‰ç”¨é…ç½®
  });
  
  app.use(ElementPlus);
  app.mount('#app');
}
```

##### D3.js æ•¸æ“šè¦–è¦ºåŒ–è¦ç¯„
ä½¿ç”¨ D3.js v7 é€²è¡Œæ‰€æœ‰åœ–è¡¨å’Œæ•¸æ“šè¦–è¦ºåŒ–ï¼š

```javascript
// D3.js åŸºæœ¬ä½¿ç”¨æ¨¡å¼
function createChart(data, containerId) {
  // ç¢ºä¿ D3 å·²è¼‰å…¥
  if (typeof d3 === 'undefined') {
    console.error('D3.js å°šæœªè¼‰å…¥');
    return;
  }
  
  const svg = d3.select(`#${containerId}`)
    .append('svg')
    .attr('width', 400)
    .attr('height', 300);
    
  // åœ–è¡¨ç¹ªè£½é‚è¼¯
  svg.selectAll('rect')
    .data(data)
    .enter()
    .append('rect')
    .attr('x', (d, i) => i * 50)
    .attr('y', d => 300 - d.value * 10)
    .attr('width', 40)
    .attr('height', d => d.value * 10)
    .attr('fill', '#409EFF');
}
```

##### Markdown è™•ç†è¦ç¯„
ä½¿ç”¨ marked.js + DOMPurify ç¢ºä¿å®‰å…¨çš„ Markdown æ¸²æŸ“ï¼š

```javascript
function renderMarkdown(content) {
  // è¨­å®š marked é¸é …
  marked.setOptions({
    breaks: true,
    gfm: true,
    sanitize: false // ç”± DOMPurify è™•ç†
  });
  
  // æ¸²æŸ“ä¸¦æ¸…ç† HTML
  const rawHtml = marked.parse(content);
  const cleanHtml = DOMPurify.sanitize(rawHtml);
  
  return cleanHtml;
}
```

##### éŸ¿æ‡‰å¼è¨­è¨ˆèˆ‡ä¸»é¡Œ
æ¡ç”¨ CSS è®Šæ•¸å’Œ Element Plus ä¸»é¡Œç³»çµ±ï¼š

```css
:root {
  --primary-color: #409eff;
  --success-color: #67c23a;
  --warning-color: #e6a23c;
  --danger-color: #f56c6c;
  --info-color: #909399;
  
  --bg-color: #ffffff;
  --bg-color-page: #f0f2f5;
  --text-color-primary: #303133;
  --text-color-regular: #606266;
  
  --header-height: 60px;
  --sidebar-width: 260px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg-color: #1a1a1a;
    --bg-color-page: #141414;
    --text-color-primary: #e4e7ed;
    --text-color-regular: #cfd3dc;
  }
}
```

### 7. Session ç®¡ç†ç³»çµ±

#### Session æ¶æ§‹è¨­è¨ˆ - Cache API + UserProperties é›™é‡æ©Ÿåˆ¶
ç³»çµ±æ¡ç”¨ Google Apps Script çš„ **Cache API** ä½œç‚ºä¸»è¦ session å­˜å„²ï¼Œé…åˆ **UserPropertiesService** ä½œç‚ºé•·æœŸå‚™ä»½ï¼Œçµåˆ Vue 3 å‰ç«¯ç‹€æ…‹ç®¡ç†ï¼Œæä¾›é«˜æ•ˆä¸”å¯é çš„ç”¨æˆ¶ç‹€æ…‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆã€‚

#### Cache API å„ªå‹¢èˆ‡é¸æ“‡ç†ç”±
**ç›¸æ¯” UserPropertiesService çš„å„ªå‹¢ï¼š**
- **é«˜æ•ˆå­˜å–**ï¼šCache API è®€å¯«é€Ÿåº¦æ›´å¿«ï¼Œé©åˆé »ç¹çš„ session é©—è­‰
- **é©åˆçŸ­æœŸè³‡æ–™**ï¼šSession è³‡æ–™æœ¬è³ªä¸Šæ˜¯è‡¨æ™‚æ€§çš„ï¼Œéå¸¸é©åˆ Cache ç‰¹æ€§
- **è‡ªå‹•éæœŸ**ï¼šæ”¯æ´ TTL (Time To Live)ï¼Œè‡ªå‹•æ¸…ç†éæœŸ session
- **æ¸›å°‘é…é¡æ¶ˆè€—**ï¼šé¿å…é »ç¹å¯«å…¥ UserPropertiesï¼Œç¯€çœé…é¡
- **æ›´ä½³æ•ˆèƒ½**ï¼šåœ¨é«˜ä½µç™¼æƒ…æ³ä¸‹è¡¨ç¾æ›´å„ª

**é›™é‡å­˜å„²ç­–ç•¥ï¼š**
- **Cache API (ä¸»è¦)**ï¼šå­˜å„²å®Œæ•´ session è³‡æ–™ï¼Œ6å°æ™‚ TTL
- **UserPropertiesService (å‚™ä»½)**ï¼šå­˜å„²é—œéµ session è³‡è¨Šï¼Œ8å°æ™‚éæœŸ
- **è‡ªå‹•æ¢å¾©æ©Ÿåˆ¶**ï¼šCache éæœŸæ™‚å¾ UserProperties è‡ªå‹•æ¢å¾© session

#### Cache API æŠ€è¡“è¦æ ¼
- **å­˜å–é€Ÿåº¦**ï¼šæ¯«ç§’ç´šéŸ¿æ‡‰ï¼Œæ¯” UserProperties å¿« 5-10 å€
- **å­˜å„²å®¹é‡**ï¼šæ¯å€‹ Cache å¯¦ä¾‹æ”¯æ´å¤§é‡è³‡æ–™
- **TTL æ”¯æ´**ï¼šæœ€å¤§ 21,600 ç§’ (6 å°æ™‚)
- **ä½œç”¨åŸŸ**ï¼šScript Cache (åŒä¸€è…³æœ¬å…§å…±äº«)
- **è‡ªå‹•æ¸…ç†**ï¼šéæœŸè³‡æ–™è‡ªå‹•æ¸…é™¤ï¼Œç„¡éœ€æ‰‹å‹•ç®¡ç†

#### èªè­‰æµç¨‹æ¶æ§‹ï¼ˆé›™éšæ®µé©—è­‰ï¼‰
```
1. ç”¨æˆ¶è¼¸å…¥ Email/å¯†ç¢¼ â†’ ç³»çµ±é©—è­‰
2. ç™¼é€é©—è­‰ç¢¼åˆ° Email â†’ å­—æ¯å‹é©—è­‰ç¢¼ï¼ˆé˜²æ­¢Google Sheetsèª¤è®€æ•¸å­—ï¼‰
3. ç”¨æˆ¶è¼¸å…¥é©—è­‰ç¢¼ â†’ 10åˆ†é˜å€’æ•¸è¨ˆæ™‚å™¨
4. é©—è­‰æˆåŠŸç”Ÿæˆ SessionID â†’ æ ¼å¼: sess_{timestamp}_{random}
5. å»ºç«‹ Session è³‡æ–™ â†’ å®Œæ•´ç”¨æˆ¶ç‹€æ…‹è³‡è¨Š
6. é›™é‡å­˜å„²:
   â”œâ”€â”€ Cache.put(sessionId, sessionData, 6å°æ™‚)
   â””â”€â”€ UserProperties.set(userEmail, basicSession, 8å°æ™‚)
7. è¿”å› SessionID â†’ å‰ç«¯å­˜å„² (localStorage)
8. äº‹ä»¶é©…å‹•ç‹€æ…‹åŒæ­¥ â†’ CustomEvent 'auth-state-changed'
```

#### é©—è­‰ç¢¼å€’æ•¸è¨ˆæ™‚å™¨
- **UIçµ„ä»¶**: el-progress ç·šæ€§é€²åº¦æ¢
- **æ™‚é–“é¡¯ç¤º**: å‰©é¤˜åˆ†é˜:ç§’æ•¸ (ä¾‹: 09:45)
- **é¡è‰²è®ŠåŒ–**: ç¶ è‰²â†’é»ƒè‰²â†’ç´…è‰² (æ ¹æ“šå‰©é¤˜æ™‚é–“)
- **è‡ªå‹•éæœŸ**: 10åˆ†é˜å¾Œéœ€é‡æ–°ç™¼é€
- **è¨˜æ†¶é«”ç®¡ç†**: æ¸…ç†è¨ˆæ™‚å™¨é¿å…è¨˜æ†¶é«”æ´©æ¼

#### Session è³‡æ–™çµæ§‹è¨­è¨ˆ
```javascript
// Cache ä¸­çš„å®Œæ•´ Session è³‡æ–™ (~1-2KB)
const cacheSessionData = {
  // èªè­‰è³‡è¨Š
  sessionId: 'sess_1640000000000_abc123',
  userEmail: 'user@example.com',
  userId: 'usr_uuid',
  displayName: 'ä½¿ç”¨è€…åç¨±',
  
  // æ™‚é–“ç®¡ç†
  loginTime: 1640000000000,
  expiryTime: 1640000000000 + (8 * 60 * 60 * 1000),
  lastActivity: 1640000000000,
  
  // æ¬Šé™èˆ‡ç‹€æ…‹
  permissions: ['submit', 'vote', 'comment'],
  currentProject: 'proj_uuid',
  currentStage: 'stage_uuid',
  
  // ç”¨æˆ¶åå¥½
  preferences: {
    theme: 'light',
    notifications: {
      email_enabled: true,
      mention_notification: true,
      project_notification: true,
      submission_notification: true,
      ranking_notification: true,
      wallet_notification: true
    }
  },
  
  // ç³»çµ±æ¨™è­˜
  loginSource: 'gas_webapp'
};

// UserProperties ä¸­çš„å‚™ä»½è³‡æ–™ (~200 bytes)
const backupSessionData = {
  sessionId: 'sess_1640000000000_abc123',
  userEmail: 'user@example.com',
  loginTime: 1640000000000,
  expiryTime: 1640000000000 + (8 * 60 * 60 * 1000)
};
```

#### Cache API Session ç®¡ç†ç­–ç•¥
```javascript
// å­˜å„²ç­–ç•¥
Cache éµå€¼æ ¼å¼: 'auth_session_{sessionId}'
TTL è¨­å®š: 21600 ç§’ (6å°æ™‚)
å‚™ä»½éµå€¼æ ¼å¼: 'extended_session_{userEmail}'

// é©—è­‰æµç¨‹
1. æª¢æŸ¥ Cache.get('auth_session_' + sessionId)
   â”œâ”€â”€ æ‰¾åˆ° â†’ æ›´æ–° lastActivity â†’ è¿”å› session è³‡æ–™
   â””â”€â”€ æœªæ‰¾åˆ° â†’ æŸ¥æ‰¾ UserProperties å‚™ä»½
       â”œâ”€â”€ æ‰¾åˆ°ä¸”æœªéæœŸ â†’ é‡å»º Cache â†’ è¿”å› session è³‡æ–™  
       â””â”€â”€ æœªæ‰¾åˆ°æˆ–å·²éæœŸ â†’ Session ç„¡æ•ˆ

// è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶
- Cache éæœŸè‡ªå‹•æ¸…é™¤
- UserProperties å®šæ™‚æ¸…ç†éæœŸé …ç›®
- æ”¯æ´æ‰‹å‹•æ¸…ç† API
```

#### æ•ˆèƒ½å„ªåŒ–è¨­è¨ˆ
```javascript
// å¿«å–å±¤ç´šç­–ç•¥
L1: Cache API (æ¯«ç§’ç´šå­˜å–)
L2: UserProperties (ç§’ç´šå­˜å–)
L3: Google Sheets ç”¨æˆ¶è³‡æ–™ (ç§’ç´šå­˜å–ï¼Œæœ‰å¿«å–)

// è®€å–å„ªå…ˆç´š
1. Cache API æŸ¥æ‰¾ (æœ€å¿«)
2. UserProperties æ¢å¾© (ä¸­ç­‰)
3. é‡æ–°èªè­‰ (æœ€æ…¢)

// å¯«å…¥ç­–ç•¥
- ç™»å…¥æ™‚ï¼šåŒæ™‚å¯«å…¥ Cache + UserProperties
- æ›´æ–°æ™‚ï¼šå„ªå…ˆæ›´æ–° Cacheï¼Œå®šæœŸåŒæ­¥ UserProperties
- ç™»å‡ºæ™‚ï¼šæ¸…é™¤ Cache + UserProperties
```

## è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆ

### Google Sheets åˆ†ç‰‡æ¶æ§‹

#### æ•´é«”æ¶æ§‹ç­–ç•¥
ç³»çµ±æ¡ç”¨ Google Sheets ä½œç‚ºä¸»è¦è³‡æ–™åº«ï¼Œä½¿ç”¨å¤šåˆ†ç‰‡ç­–ç•¥é¿å…å–®ä¸€è©¦ç®—è¡¨çš„é™åˆ¶ã€‚åˆ†ç‚ºå…¨åŸŸæ´»é ç°¿ï¼ˆå­˜æ”¾è·¨å°ˆæ¡ˆå…±äº«è³‡æ–™ï¼‰å’Œå°ˆæ¡ˆæ´»é ç°¿ï¼ˆæ¯å€‹å°ˆæ¡ˆç¨ç«‹ï¼‰ï¼Œé€éæ•´è¡¨è®€å–é…åˆè¨˜æ†¶é«”ç¯©é¸çš„æ–¹å¼ï¼Œåœ¨å®Œå…¨å…è²»çš„å‰æä¸‹æä¾›é«˜æ•ˆçš„è³‡æ–™å­˜å–ã€‚

#### è³‡æ–™åº«çµ„ç¹”çµæ§‹
```
Google Sheets åˆ†ç‰‡æ¶æ§‹:
â”œâ”€â”€ ScoringSystem-Global (å…¨åŸŸæ´»é ç°¿)
â”‚   â”œâ”€â”€ Projects (å°ˆæ¡ˆæ¸…å–®)
â”‚   â”œâ”€â”€ Users (ç”¨æˆ¶ç¸½è¡¨)
â”‚   â”œâ”€â”€ SystemConfigs (ç³»çµ±é…ç½®)
â”‚   â”œâ”€â”€ Tags (å…¨åŸŸæ¨™ç±¤ç®¡ç†)
â”‚   â”œâ”€â”€ ProjectTags (å°ˆæ¡ˆæ¨™ç±¤é—œè¯)
â”‚   â”œâ”€â”€ UserTags (ç”¨æˆ¶æ¨™ç±¤é—œè¯)
â”‚   â””â”€â”€ Templates (å°ˆæ¡ˆç¯„æœ¬)
â””â”€â”€ ScoringSystem-Project-{ProjectID} (å°ˆæ¡ˆæ´»é ç°¿ x N)
    â”œâ”€â”€ ProjectInfo (å°ˆæ¡ˆè³‡è¨Š)
    â”œâ”€â”€ Groups (ç¾¤çµ„è³‡æ–™)
    â”œâ”€â”€ UserGroups (ç”¨æˆ¶ç¾¤çµ„é—œè¯)
    â”œâ”€â”€ Stages (éšæ®µè³‡æ–™)
    â”œâ”€â”€ Submissions (æˆæœæäº¤)
    â”œâ”€â”€ Rankings (æ’åçµæœ)
    â”œâ”€â”€ Comments (è©•è«–è³‡æ–™)
    â”œâ”€â”€ Votes (æŠ•ç¥¨è¨˜éŒ„)
    â”œâ”€â”€ Wallets (å€‹äººéŒ¢åŒ…)
    â”œâ”€â”€ Transactions (äº¤æ˜“è¨˜éŒ„)
    â”œâ”€â”€ EventLogs (æ“ä½œæ—¥èªŒ)
    â””â”€â”€ StageConfigs (éšæ®µé…ç½®)
```

#### Google Sheets æ¶æ§‹å„ªå‹¢
- **å®Œå…¨å…è²»**ï¼šåŸºæ–¼ Google Sheets å…è²»æœå‹™ï¼Œç„¡ä»»ä½•æˆæœ¬
- **è³‡æ–™éš”é›¢**ï¼šæ¯å€‹å°ˆæ¡ˆç¨ç«‹æ´»é ç°¿ï¼Œæå‡å®‰å…¨æ€§å’Œæ•ˆèƒ½
- **ç„¡é™æ“´å±•**ï¼šå¯å»ºç«‹ç„¡é™æ•¸é‡çš„å°ˆæ¡ˆæ´»é ç°¿
- **ç›´è§€ç®¡ç†**ï¼šè³‡æ–™ç›´æ¥åœ¨ Google Sheets ä¸­å¯è¦‹ï¼Œä¾¿æ–¼é™¤éŒ¯å’Œç¶­è­·
- **æ•´è¡¨è®€å–**ï¼šé¿å…è¤‡é›œæŸ¥è©¢é‚è¼¯ï¼Œä¸€æ¬¡è®€å–å¾Œåœ¨è¨˜æ†¶é«”è™•ç†
- **é›¶ç¶­è­·æˆæœ¬**ï¼šç„¡éœ€ç®¡ç†è³‡æ–™åº«ä¼ºæœå™¨æˆ–æ“”å¿ƒæœå‹™ä¸­æ–·

## è³‡æ–™å­˜å–å„ªåŒ–ç­–ç•¥

### æ•´è¡¨è®€å–æ¨¡å¼
```javascript
// ä¸€æ¬¡è¼‰å…¥å°ˆæ¡ˆå®Œæ•´è³‡æ–™
function loadCompleteProjectData(projectId, userEmail) {
  // è®€å–å…¨åŸŸè³‡æ–™ï¼ˆä½¿ç”¨å¿«å–ï¼‰
  const globalData = getCachedGlobalData();
  
  // è®€å–å°ˆæ¡ˆè³‡æ–™ï¼ˆä½¿ç”¨å¿«å–ï¼‰
  const projectData = getCachedProjectData(projectId);
  
  return {
    // å…¨åŸŸè³‡æ–™
    allProjects: globalData.projects,
    allUsers: globalData.users,
    systemConfigs: globalData.systemConfigs,
    
    // å°ˆæ¡ˆç‰¹å®šè³‡æ–™
    project: projectData.projectInfo,
    groups: projectData.groups,
    userGroups: projectData.userGroups,
    stages: projectData.stages,
    submissions: projectData.submissions,
    rankings: projectData.rankings,
    comments: projectData.comments,
    votes: projectData.votes,
    wallets: projectData.wallets,
    transactions: projectData.transactions,
    eventLogs: projectData.eventLogs,
    stageConfigs: projectData.stageConfigs
  };
}

// è¨˜æ†¶é«”ç¯©é¸ç¯„ä¾‹
function getStageSubmissions(allData, stageId) {
  return allData.submissions.filter(submission => 
    submission.stageId === stageId
  );
}

function getUserWallet(allData, userEmail) {
  return allData.wallets.find(wallet => 
    wallet.userEmail === userEmail
  );
}
```

### æ‰¹æ¬¡æ–°å¢æ¨¡å¼ï¼ˆå”¯è®€æ–°å¢è¨­è¨ˆï¼‰
```javascript
// æ”¶é›†æ‰€æœ‰æ–°è³‡æ–™å¾Œä¸€æ¬¡æ€§æ‰¹æ¬¡æ–°å¢åˆ° Google Sheets
function batchAddStageResults(projectId, stageCompletionRecord, rankings, transactions, votes) {
  const projectWorkbook = getProjectWorkbook(projectId);
  
  // æ–°å¢éšæ®µå®Œæˆè¨˜éŒ„ï¼ˆä¸ä¿®æ”¹ç¾æœ‰éšæ®µè³‡æ–™ï¼‰
  if (stageCompletionRecord) {
    addRowToSheet(projectId, 'StageProgress', stageCompletionRecord);
  }
  
  // æ‰¹æ¬¡æ–°å¢æ’åè³‡æ–™
  if (rankings.length > 0) {
    batchAddRows(projectId, 'Rankings', rankings);
  }
  
  // æ‰¹æ¬¡æ–°å¢äº¤æ˜“è³‡æ–™
  if (transactions.length > 0) {
    batchAddRows(projectId, 'Transactions', transactions);
  }
  
  // æ‰¹æ¬¡æ–°å¢æŠ•ç¥¨è³‡æ–™
  if (votes.length > 0) {
    batchAddRows(projectId, 'Votes', votes);
  }
  
  // ä½¿å¿«å–å¤±æ•ˆ
  invalidateProjectCache(projectId);
}

// è¨­è¨ˆèªªæ˜ï¼š
// - éšæ®µç‹€æ…‹è®Šæ›´é€éæ–°å¢ StageProgress è¨˜éŒ„å¯¦ç¾ï¼Œä¸ä¿®æ”¹åŸå§‹ Stages è¨˜éŒ„
// - æ‰€æœ‰æ“ä½œéƒ½æ˜¯æ–°å¢è¨˜éŒ„ï¼Œç¢ºä¿å®Œæ•´çš„æ­·å²è¿½è¹¤

// æ‰¹æ¬¡æ–°å¢å¤šè¡Œè³‡æ–™
function batchAddRows(projectId, sheetName, dataArray) {
  const workbook = getProjectWorkbook(projectId);
  const sheet = workbook.getSheetByName(sheetName);
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  
  const newRows = dataArray.map(data => 
    headers.map(header => data[header] || '')
  );
  
  sheet.getRange(
    sheet.getLastRow() + 1, 
    1, 
    newRows.length, 
    headers.length
  ).setValues(newRows);
}
```

### è¨˜æ†¶é«”è™•ç†å„ªåŒ–
```javascript
// æ‰€æœ‰è¨ˆç®—åœ¨è¨˜æ†¶é«”ä¸­å®Œæˆï¼Œé¿å…é‡è¤‡è®€å– Google Sheets
function processStageCompletion(stageId) {
  const userEmail = getCurrentUser();
  const projectId = getProjectIdByStage(stageId);
  
  // ä¸€æ¬¡è¼‰å…¥æ‰€æœ‰ç›¸é—œè³‡æ–™
  const allData = loadCompleteProjectData(projectId, userEmail);
  
  // æ¬Šé™æª¢æŸ¥ï¼ˆè¨˜æ†¶é«”æ“ä½œï¼‰
  if (!canCompleteStageInMemory(userEmail, projectId, allData)) {
    throw new Error('æ¬Šé™ä¸è¶³');
  }
  
  // æ¥­å‹™é‚è¼¯è™•ç†ï¼ˆè¨˜æ†¶é«”æ“ä½œï¼‰
  const stageSubmissions = getStageSubmissions(allData, stageId);
  const rankings = calculateRankingsInMemory(stageSubmissions);
  
  // å¤–æ›åŠŸèƒ½è™•ç†
  let transactions = [];
  let votes = [];
  if (getConfig().scoring.enabled) {
    const rewards = calculateRewardsInMemory(rankings);
    transactions = prepareTransactionData(rewards);
    votes = prepareVoteData(allData.votes, stageId);
  }
  
  // æº–å‚™æ‰€æœ‰æ›´æ–°è³‡æ–™
  const stageUpdates = prepareStageStatusUpdate(stageId, 'completed');
  const rankingData = prepareRankingData(rankings);
  
  // ä¸€æ¬¡æ€§æ‰¹æ¬¡å¯«å…¥ Google Sheets
  batchUpdateStageResults(projectId, stageUpdates, rankingData, transactions, votes);
  
  return { rankings, transactions };
}

// å¿«å–ç®¡ç†
const sheetsCache = new Map();
const CACHE_TIMEOUT = 5 * 60 * 1000; // 5åˆ†é˜

function getCachedProjectData(projectId) {
  const cacheKey = `project_${projectId}`;
  
  if (sheetsCache.has(cacheKey)) {
    const cached = sheetsCache.get(cacheKey);
    if (Date.now() - cached.timestamp < CACHE_TIMEOUT) {
      return cached.data;
    }
  }
  
  const data = readProjectData(projectId);
  sheetsCache.set(cacheKey, {
    data: data,
    timestamp: Date.now()
  });
  
  return data;
}
```

## æ¥­å‹™æµç¨‹è¨­è¨ˆ

### ä¸»è¦æ¥­å‹™æµç¨‹

#### 1. å°ˆæ¡ˆåˆå§‹åŒ–æµç¨‹
1. **ç¸½ PM å»ºç«‹å°ˆæ¡ˆ**ï¼šè¨­å®šåŸºæœ¬è³‡è¨Šå’Œéšæ®µé…ç½®ï¼Œç”Ÿæˆ proj_uuid
2. **åˆ†é…ç¾¤çµ„æ¬Šé™**ï¼šè¨­å®šç¾æœ‰ç¾¤çµ„èˆ‡å°ˆæ¡ˆçš„é—œä¿‚å’Œè§’è‰²æ¬Šé™
3. **å»ºç«‹å°ˆæ¡ˆè³‡æ–™**ï¼šåœ¨ Google Sheets å°ˆæ¡ˆåˆ†ç‰‡ä¸­å»ºç«‹ç›¸é—œå·¥ä½œè¡¨
4. **åˆå§‹åŒ–å¤–æ›åŠŸèƒ½**ï¼šæ ¹æ“šé…ç½®å•Ÿç”¨è©•åˆ†å’ŒéŒ¢åŒ…åŠŸèƒ½

#### 2. æˆæœæäº¤æµç¨‹ï¼ˆç‰ˆæœ¬è¿½è¹¤è¨­è¨ˆï¼‰
1. **æˆæœè£½ä½œéšæ®µ**ï¼šåœ˜éšŠå”ä½œå®Œæˆéšæ®µæˆæœ
2. **çµ„å…§æäº¤**ï¼šä»»ä¸€çµ„å“¡å¯æäº¤æˆæœä¸¦æ¨™è¨»å¯¦éš›ä½œè€…
3. **ç‰ˆæœ¬è¿½è¹¤æ©Ÿåˆ¶**ï¼šæ¯æ¬¡æäº¤è‡ªå‹•ç”Ÿæˆç‰ˆæœ¬è™Ÿï¼ˆv1, v2, v3...ï¼‰ï¼ŒèˆŠç‰ˆæœ¬å®Œæ•´ä¿ç•™
4. **æ’¤å›æ©Ÿåˆ¶**ï¼šçµ„å…§å¯æ’¤å›æäº¤ï¼ˆæ¨™è¨˜ç‚ºwithdrawnï¼‰ï¼Œè€Œéåˆªé™¤è¨˜éŒ„
5. **çµ„å…§æŠ•ç¥¨ç¢ºèª**ï¼šçµ„å“¡å°æœ€æ–°æäº¤çš„åƒèˆ‡åº¦åˆ†é…é€²è¡ŒæŠ•ç¥¨ï¼ˆåŒæ„/ä¸åŒæ„ï¼‰
6. **å…±è­˜æˆªæ­¢ç¢ºèª**ï¼šç³»çµ±åœ¨éšæ®µæˆªæ­¢æ™‚æª¢æŸ¥å…±è­˜ç‹€æ…‹ï¼Œç„¡å…±è­˜å‰‡æ²’æ”¶å…¨éƒ¨é»æ•¸
7. **åƒèˆ‡è³‡æ ¼ç¢ºå®š**ï¼šåªæœ‰åœ¨æˆªæ­¢æ™‚é”æˆå…±è­˜çš„çµ„åˆ¥å¯ç²å¾—é»æ•¸

**è¨­è¨ˆèªªæ˜**ï¼š
- æ‰€æœ‰æäº¤éƒ½æ˜¯æ–°å¢è¨˜éŒ„ï¼Œå¸¶æœ‰ç‰ˆæœ¬è™Ÿæ¨™è­˜
- æ’¤å›æäº¤åªæ¨™è¨˜ç‹€æ…‹ï¼Œä¸åˆªé™¤æ­·å²è¨˜éŒ„
- æŠ•ç¥¨æ¡ç”¨ç°¡åŒ–çš„åŒæ„/ä¸åŒæ„æ©Ÿåˆ¶ï¼Œé‡å°æ•´å€‹åƒèˆ‡åº¦ææ¡ˆ
- ç³»çµ±ä¸è‡ªå‹•æ‰¹å‡†ï¼Œåªåœ¨æˆªæ­¢æ™‚æª¢æŸ¥å…±è­˜ç‹€æ…‹
- ç¢ºä¿å®Œæ•´çš„æäº¤æ­·å²å’Œå¯©è¨ˆè»Œè·¡

#### 3. æ’åè©•ä¼°æµç¨‹ï¼ˆè©•åˆ†åŠŸèƒ½å•Ÿç”¨æ™‚ï¼‰

##### 3.1 çµ„å…§åƒèˆ‡åº¦ç¢ºèªæ©Ÿåˆ¶ï¼ˆå”¯è®€æ–°å¢è¨­è¨ˆï¼‰
1. **åƒèˆ‡è³‡æ ¼**ï¼šåªæœ‰æäº¤éå ±å‘Šçš„çµ„åˆ¥å¯ä»¥åƒèˆ‡è©•åˆ†
2. **åƒèˆ‡åº¦ææ¡ˆ**ï¼šæäº¤å ±å‘Šæ™‚åŒ…å«åƒèˆ‡åº¦åˆ†é…è³‡è¨Š
   - åƒèˆ‡åº¦åˆ†é…æ ¼å¼ï¼š`{"user1@email.com": 30, "user2@email.com": 40, "user3@email.com": 30}`
   - ç¸½å’Œå¿…é ˆç‚º100%
   - æ¯æ¬¡æäº¤å¸¶æœ‰ç‰ˆæœ¬è™Ÿï¼ˆv1, v2, v3...ï¼‰
3. **çµ„å…§æŠ•ç¥¨ç¢ºèª**ï¼šçµ„å…§æˆå“¡å°åƒèˆ‡åº¦åˆ†é…æŠ•ç¥¨
   - ç°¡åŒ–çš„åŒæ„/ä¸åŒæ„äºŒå…ƒæŠ•ç¥¨
   - æŠ•ç¥¨é‡å°æ•´å€‹åƒèˆ‡åº¦ææ¡ˆï¼Œä¸æ˜¯å€‹åˆ¥é …ç›®
   - æ–°å¢è¨˜éŒ„è‡³ ParticipationVotes è¡¨
   - åªæœ‰åŒçµ„æˆå“¡å¯ä»¥æŠ•ç¥¨

**è¨­è¨ˆèªªæ˜**ï¼š
- åƒèˆ‡åº¦åˆ†é…å·²åŒ…å«åœ¨æäº¤ä¸­ï¼ŒæŠ•ç¥¨åªæ˜¯ç¢ºèªæ©Ÿåˆ¶
- æ¯æ¬¡æŠ•ç¥¨éƒ½æ˜¯æ–°å¢è¨˜éŒ„ï¼Œå¦‚éœ€æ”¹ç¥¨å‰‡ç”¢ç”Ÿæ–°æŠ•ç¥¨è¨˜éŒ„
- ç³»çµ±åœ¨æˆªæ­¢æ™‚æª¢æŸ¥å…±è­˜ç‹€æ…‹ï¼Œç„¡å…±è­˜å‰‡æ²’æ”¶é»æ•¸
- ä¸å†æœ‰è¤‡é›œçš„æ’åææ¡ˆæ©Ÿåˆ¶ï¼Œç°¡åŒ–ç‚ºåƒèˆ‡åº¦ç¢ºèª

##### 3.2 å…±è­˜è™•ç†é‚è¼¯
1. **æˆªæ­¢æ™‚å…±è­˜æª¢æŸ¥**ï¼š
   - ç³»çµ±åœ¨éšæ®µæˆªæ­¢æ™‚æª¢æŸ¥æ‰€æœ‰çµ„åˆ¥çš„å…±è­˜ç‹€æ…‹
   - åªæœ‰å…¨çµ„æˆå“¡éƒ½åŒæ„çš„çµ„åˆ¥å¯ç²å¾—é»æ•¸
   - ç„¡å…±è­˜çš„çµ„åˆ¥å°‡æ²’æ”¶å…¨éƒ¨éšæ®µé»æ•¸
2. **å…±è­˜ç¢ºèªæ©Ÿåˆ¶**ï¼š
   - çµ„å…§æˆå“¡å¿…é ˆå°åƒèˆ‡åº¦åˆ†é…é”æˆä¸€è‡´
   - æ¡ç”¨å…¨å“¡åŒæ„åˆ¶ï¼Œè€Œéå¤šæ•¸æ±º
   - å…±è­˜æœŸé–“çµ„åˆ¥å¯é‡æ–°æäº¤ä¸¦é‡æ–°æŠ•ç¥¨
3. **è­¦å‘Šæ©Ÿåˆ¶**ï¼š
   - **å…±è­˜è­¦å‘Šçµ„ä»¶**: el-alert è­¦å‘Šæç¤ºæ¡†
   - **è­¦å‘Šè¨Šæ¯**: "è²´çµ„å°šæœªå–å¾—é»æ•¸åˆ†é…å…±è­˜ï¼Œæˆªæ­¢å‰ç„¡å…±è­˜ï¼Œå°‡æ²’æ”¶å…¨éƒ¨é»æ•¸"
   - **å€’æ•¸è¨ˆæ™‚å™¨**: éšæ®µæˆªæ­¢æ™‚é–“å€’æ•¸ï¼Œæ ¼å¼ "Xå¤©Xæ™‚Xåˆ†"
   - **å³æ™‚æ›´æ–°**: WebSocket-likeæ©Ÿåˆ¶æ›´æ–°æŠ•ç¥¨ç‹€æ…‹å’Œå…±è­˜é€²åº¦
   - **æ“ä½œæç¤º**: å¼•å°ç”¨æˆ¶é‡æ–°ææ¡ˆæˆ–æŠ•ç¥¨ç›´åˆ°éšæ®µçµç®—
   - **è¦–è¦ºåŒ–é€²åº¦**: é€²åº¦æ¢é¡¯ç¤ºçµ„å…§æŠ•ç¥¨é€²åº¦ (ä¾‹: 2/5äººå·²æŠ•ç¥¨)

##### 3.3 è©•è«–ç³»çµ±æ©Ÿåˆ¶

**è©•è«–æ’°å¯«èˆ‡äº’å‹•**ï¼š
1. **è‡ªç”±è©•è«–**ï¼šä»»ä½•å€‹äººå¯åœ¨éšæ®µå…§è‡ªç”±æ’°å¯«è©•è«–
2. **@æåŠæ©Ÿåˆ¶**ï¼šè©•è«–ä¸­å¯ä½¿ç”¨ @grp_xxx æåŠç‰¹å®šçµ„åˆ¥
3. **ç³»çµ±è§£æ**ï¼šç³»çµ±è‡ªå‹•è§£æè©•è«–ä¸­çš„çµ„åˆ¥æåŠï¼Œå­˜å…¥ mentionedGroups
4. **é€šçŸ¥æ©Ÿåˆ¶**ï¼šå³æ™‚é€šçŸ¥ç³»çµ±ï¼Œæ”¯æ´11ç¨®é€šçŸ¥é¡å‹
5. **å›è¦†åŠŸèƒ½**ï¼šè¢«æåŠçµ„åˆ¥å¯å›è¦†è©•è«–ï¼Œä½†é™åˆ¶ä¸€å±¤å›è¦†ï¼ˆreplyLevel â‰¤ 1ï¼‰

**è©•è«–æ’åæ©Ÿåˆ¶**ï¼š
1. **åƒèˆ‡è³‡æ ¼**ï¼šåªæœ‰æ’°å¯«éã€åŒ…å« mention çš„é ‚ç´šè©•è«–ã€‘çš„å€‹äººå¯åƒèˆ‡è©•è«–æ’åæŠ•ç¥¨
   - å¿…é ˆæ˜¯é ‚ç´šè©•è«–ï¼ˆéå›è¦†ï¼ŒreplyLevel = 0ï¼‰
   - è©•è«–ä¸­çš„ mentionedGroups æˆ– mentionedUsers ä¸ç‚ºç©º
   - è¨­è¨ˆç†å¿µï¼šé¼“å‹µæœ‰å»ºè¨­æ€§çš„äº’å‹•ï¼Œç¢ºä¿è©•è«–é‡å°å…·é«”çµ„åˆ¥æˆ–ç”¨æˆ¶

2. **æ’åå°è±¡**ï¼šåƒ…å°ã€åŒ…å« mention çš„é ‚ç´šè©•è«–ã€‘é€²è¡Œæ’å
   - å¿…é ˆæ˜¯é ‚ç´šè©•è«–ï¼ˆéå›è¦†ï¼‰
   - mentionedGroups æˆ– mentionedUsers ä¸ç‚ºç©º
   - **ã€èº«ä»½é™åˆ¶ã€‘ä½œè€…å¿…é ˆæ˜¯å°ˆæ¡ˆä¸­çš„ Group Leader æˆ– Group Member**
     - åªæœ‰åœ¨ `usergroups` è¡¨ä¸­æœ‰ `role='leader'` æˆ– `role='member'` ä¸” `isActive=1` çš„ç”¨æˆ¶
     - æ’é™¤ Teacherï¼ˆ`projectviewers.role='teacher'`ï¼‰çš„è©•è«–
     - æ’é™¤ Observerï¼ˆ`projectviewers.role='observer'`ï¼‰çš„è©•è«–
     - æ’é™¤æ²’æœ‰çµ„åˆ¥èº«ä»½çš„ç”¨æˆ¶è©•è«–
   - ä¸åŒ…å«æŠ•ç¥¨è€…è‡ªå·±çš„è©•è«–ï¼ˆé˜²æ­¢è‡ªæŠ•ï¼‰
   - ä¸åŒ…å«ç´”ç²¹è‡ªèªªè‡ªè©±æˆ–ç„¡é‡å°æ€§çš„è©•è«–

3. **æ•™å¸«æŠ•ç¥¨è¦å‰‡**ï¼š
   - æ•™å¸«çš„è©•è«–**ä¸æœƒå‡ºç¾**åœ¨ä»»ä½•äººçš„æŠ•ç¥¨åˆ—è¡¨ä¸­ï¼ˆæ•™å¸«ä¸èƒ½æˆç‚ºå€™é¸äººï¼‰
   - æ•™å¸«é€²è¡ŒæŠ•ç¥¨æ™‚ï¼Œå€™é¸äººè¦å‰‡èˆ‡å­¸ç”Ÿå®Œå…¨ç›¸åŒ
   - æ•™å¸«åªèƒ½æŠ•ç¥¨çµ¦ Group Leader/Member æ’°å¯«çš„æœ‰ mention è©•è«–
   - å”¯ä¸€å·®ç•°ï¼šæ•™å¸«é‚„å¯å°æˆæœé€²è¡Œæ’åï¼ˆç¶œåˆæŠ•ç¥¨ï¼‰

4. **å€‹äººææ¡ˆ**ï¼šç¬¦åˆè³‡æ ¼çš„äººæäº¤å€‹äººçš„è©•è«–å‰ä¸‰åæ’åº â†’ CommentRankingProposals

5. **çµ±è¨ˆè¨ˆç®—**ï¼šç³»çµ±çµ±è¨ˆæ‰€æœ‰ææ¡ˆï¼Œè¨ˆç®—è©•è«–å¹³å‡æ’å

6. **ç¢ºå®šç²ç**ï¼šé¸å‡ºæœ€çµ‚å‰ä¸‰åè©•è«–ï¼Œç™¼æ”¾è©•è«–çå‹µ

##### 3.4 æäº¤æ’¤å›æ©Ÿåˆ¶

**æ’¤å›æ“ä½œ**ï¼š
1. **æ’¤å›æ¬Šé™**ï¼šçµ„å…§ä»»ä½•æˆå“¡å¯ä»¥æ’¤å›çµ„å…§çš„æäº¤
2. **æ’¤å›æµç¨‹**ï¼š
   - æ¨™è¨˜æäº¤ç‹€æ…‹ç‚º 'withdrawn'
   - è¨˜éŒ„æ’¤å›æ™‚é–“ (withdrawnTime)
   - è¨˜éŒ„æ’¤å›æ“ä½œè€… (withdrawnBy)
   - ä¿ç•™å®Œæ•´æ­·å²è¨˜éŒ„ï¼Œä¸å¯¦éš›åˆªé™¤

**æ’¤å›å¾Œé‡æ–°æäº¤**ï¼š
1. **ç‰ˆæœ¬éå¢**ï¼šæ–°æäº¤è‡ªå‹•ç”¢ç”Ÿä¸‹ä¸€ç‰ˆæœ¬è™Ÿï¼ˆv2ã€v3...ï¼‰
2. **æŠ•ç¥¨é‡ç½®**ï¼šçµ„å…§éœ€é‡æ–°å°æ–°ç‰ˆæœ¬é€²è¡ŒæŠ•ç¥¨
3. **å…±è­˜é‡æ–°ç¢ºèª**ï¼šé‡æ–°å•Ÿå‹•å…±è­˜ç¢ºèªæµç¨‹

**é‡è¦è¨­è¨ˆåŸå‰‡**ï¼š
- **ä¸å…è¨±åˆªé™¤**ï¼šç³»çµ±ä¸æä¾›çœŸæ­£çš„åˆªé™¤åŠŸèƒ½ï¼Œåªæœ‰æ’¤å›
- **å®Œæ•´å¯©è¨ˆè»Œè·¡**ï¼šæ‰€æœ‰æ“ä½œè¨˜éŒ„å®Œæ•´ä¿ç•™
- **ç‰ˆæœ¬è¿½è¹¤**ï¼šæ¯æ¬¡é‡æ–°æäº¤å‰µå»ºæ–°ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬æ··äº‚

##### 3.5 å…¶ä»–æŠ•ç¥¨æ´»å‹•
1. **ç¸½PMæ’å**ï¼šç¸½PMå–®ç¨å°å„çµ„é€²è¡Œæ’åæŠ•ç¥¨
2. **æŠ•ç¥¨å¯©æ ¸**ï¼šå°æˆæœé€²è¡Œé€šé/ä¸é€šéæŠ•ç¥¨

#### 4. çå‹µåˆ†é…æµç¨‹ï¼ˆè©•åˆ†åŠŸèƒ½å•Ÿç”¨æ™‚ï¼‰

##### 4.1 ç³»çµ±æ’åè¨ˆç®—
1. **å­¸ç”Ÿæ’åçµ±è¨ˆ**ï¼šå¾ FinalRankings è¡¨çµ±è¨ˆå„çµ„æ”¶åˆ°çš„æ’åæŠ•ç¥¨
2. **ç¸½PMæ’å**ï¼šå¾ Votes è¡¨æ”¶é›†ç¸½PMçš„æ’åæŠ•ç¥¨
3. **åŠ æ¬Šè¨ˆç®—**ï¼šå­¸ç”Ÿæ’å Ã— 70% + ç¸½PMæ’å Ã— 30%
4. **æœ€çµ‚æ’å**ï¼šè¨ˆç®—çµæœå­˜å…¥ SystemRankings è¡¨

##### 4.2 çå‹µç™¼æ”¾æ©Ÿåˆ¶
1. **æˆæœçå‹µ**ï¼šæŒ‰ SystemRankings è¡¨çš„æœ€çµ‚æ’åç™¼æ”¾çé‡‘
2. **è©•è«–çå‹µ**ï¼š
   - çµ±è¨ˆ CommentRankingProposals è¡¨ä¸­çš„æ‰€æœ‰æ’åææ¡ˆ
   - è¨ˆç®—æ¯å€‹è©•è«–çš„å¹³å‡æ’ååˆ†æ•¸
   - é¸å‡ºå‰ä¸‰åè©•è«–ï¼Œç™¼æ”¾çé‡‘çµ¦è©•è«–ä½œè€…
   - æ›´æ–° Comments è¡¨çš„ isAwarded å’Œ awardRank æ¬„ä½
3. **åƒèˆ‡è³‡æ ¼æª¢æŸ¥**ï¼šç¢ºèªç²çè€…ç¢ºå¯¦åœ¨å…±è­˜æˆªæ­¢æ™‚é–“å‰ç¢ºèªåƒèˆ‡
4. **é»æ•¸ç™¼æ”¾**ï¼šæ›´æ–°åƒèˆ‡æˆå“¡çš„å€‹äººéŒ¢åŒ…å¸³æˆ¶é¤˜é¡

##### 4.3 æˆæœæ’åè¨ˆç®—ç¯„ä¾‹
```javascript
// å­¸ç”Ÿæ’åçµ±è¨ˆ (å¾ FinalRankings)
groupA_studentRanks = [1, 2, 1, 3]; // å¹³å‡: 1.75
groupB_studentRanks = [2, 1, 2, 1]; // å¹³å‡: 1.5

// ç¸½PMæ’å (å¾ Votes è¡¨ï¼ŒvoteType: 'pm_ranking')
groupA_pmRank = 2;
groupB_pmRank = 1;

// æœ€çµ‚æ’åè¨ˆç®—
groupA_finalScore = 1.75 * 0.7 + 2 * 0.3 = 1.825
groupB_finalScore = 1.5 * 0.7 + 1 * 0.3 = 1.35

// groupB ç²å¾—ç¬¬ä¸€å (åˆ†æ•¸è¶Šä½æ’åè¶Šé«˜)
```

##### 4.4 è©•è«–æ’åè¨ˆç®—ç¯„ä¾‹
```javascript
// è©•è«–æ’åææ¡ˆçµ±è¨ˆ (å¾ CommentRankingProposals)
commentA_rankings = [1, 3, 2, 1]; // å¹³å‡: 1.75
commentB_rankings = [2, 1, 1, 3]; // å¹³å‡: 1.75
commentC_rankings = [3, 2, 3, 2]; // å¹³å‡: 2.5

// æœ€çµ‚è©•è«–æ’å (åˆ†æ•¸è¶Šä½æ’åè¶Šé«˜)
// commentA å’Œ commentB ä¸¦åˆ—ç¬¬ä¸€ï¼ŒcommentC ç¬¬ä¸‰
// çå‹µåˆ†é…ï¼šcommentA ç²ç¬¬1åçå‹µï¼ŒcommentB ç²ç¬¬2åçå‹µï¼ŒcommentC ç²ç¬¬3åçå‹µ
```

##### 4.5 åŒåæ¬¡è™•ç†æ©Ÿåˆ¶

**æ’åè¨ˆç®—æ–¹å¼ï¼šStandard Rankingï¼ˆæ¨™æº–ç«¶è³½æ’åï¼‰**
- ä¸¦åˆ—è€…ä½¿ç”¨ç›¸åŒæ’å
- ä¸‹ä¸€å€‹æ’åè‡ªå‹•è·³è™Ÿï¼ˆä½”ç”¨çš„ä½ç½®æ•¸ï¼‰
- ç¯„ä¾‹ï¼š1st, 2nd, 2nd, 4thï¼ˆè·³éç¬¬3åï¼‰

**çé‡‘åˆ†é…æ–¹å¼ï¼šOccupied Rank Methodï¼ˆä½”ç”¨ä½ç½®æ³•ï¼‰**

ç•¶å‡ºç¾åŒåæ¬¡æ™‚ï¼Œç³»çµ±æ¡ç”¨ã€Œä½”ç”¨ä½ç½®æ³•ã€é€²è¡Œçé‡‘åˆ†é…ï¼š

1. **åŸç†**ï¼šä¸¦åˆ—è€…ä½”ç”¨é€£çºŒçš„æ’åä½ç½®ï¼Œä¸¦å¹³åˆ†é€™äº›ä½ç½®çš„ç¸½æ¬Šé‡
2. **å…¬å¼**ï¼š
   ```
   ä¸¦åˆ—ç¬¬Kåï¼Œå…±Näºº â†’ ä½”ç”¨æ’å K åˆ° K+N-1
   æ¯äººæ¬Šé‡ = Î£(totalGroups - rank + 1) / Nï¼Œå…¶ä¸­ rank âˆˆ [K, K+N-1]
   ```

3. **ç¯„ä¾‹è¨ˆç®—**ï¼š

**æƒ…æ³1ï¼šSubmission æ’åï¼ˆ4çµ„åƒè³½ï¼Œ100é»çæ± ï¼‰**
```
æ’åçµæœï¼šç¬¬1å(1çµ„), ç¬¬2å(2çµ„ä¸¦åˆ—), ç¬¬4å(1çµ„)

æ¬Šé‡è¨ˆç®—ï¼š
- ç¬¬1åï¼šä½”ä½1 â†’ æ¬Šé‡ = 4
- ç¬¬2åï¼ˆ2çµ„ï¼‰ï¼šä½”ä½2,3 â†’ æ¬Šé‡ = (3+2)/2 = 2.5ï¼ˆæ¯çµ„ï¼‰
- ç¬¬4åï¼šä½”ä½4 â†’ æ¬Šé‡ = 1

ç¸½æ¬Šé‡ = 4 + 2.5 + 2.5 + 1 = 10

é»æ•¸åˆ†é…ï¼š
- ç¬¬1åï¼š4/10 Ã— 100 = 40é»
- ç¬¬2åï¼ˆæ¯çµ„ï¼‰ï¼š2.5/10 Ã— 100 = 25é» âœ“ æ¯”ç¬¬4åå¤š
- ç¬¬4åï¼š1/10 Ã— 100 = 10é»
```

**æƒ…æ³2ï¼šComment æ’åï¼ˆå‰3åæœ‰çï¼Œ50é»çæ± ï¼‰**
```
æ’åçµæœï¼šç¬¬1å(2äººä¸¦åˆ—), ç¬¬3å(1äºº)

æ¬Šé‡è¨ˆç®—ï¼š
- ç¬¬1åï¼ˆ2äººï¼‰ï¼šä½”ä½1,2 â†’ æ¬Šé‡ = (3+2)/2 = 2.5ï¼ˆæ¯äººï¼‰
- ç¬¬3åï¼ˆ1äººï¼‰ï¼šä½”ä½3 â†’ æ¬Šé‡ = 1

ç¸½æ¬Šé‡ = 2.5 + 2.5 + 1 = 6

é»æ•¸åˆ†é…ï¼š
- ç¬¬1åï¼ˆæ¯äººï¼‰ï¼š2.5/6 Ã— 50 = 20.83é»
- ç¬¬3åï¼š1/6 Ã— 50 = 8.33é»
```

**é‡è¦ç‰¹æ€§ï¼š**
- âœ… åŒåæ¬¡è€…ç²å¾—ç›¸åŒçå‹µï¼ˆå…¬å¹³æ€§ï¼‰
- âœ… æ’åè¶Šå‰ï¼Œå³ä½¿ä¸¦åˆ—ï¼Œä»æ¯”å¾Œé¢æ’åç²å¾—æ›´å¤šçå‹µ
- âœ… ç¸½çæ± åˆ†é…å®Œæ•´ï¼Œç„¡å‰©é¤˜
- âœ… ç¬¦åˆæ¥­ç•Œæ¨™æº–ï¼ˆé¡ä¼¼å¥§é‹çç‰Œæ’åé‚è¼¯ï¼‰

#### 5. éšæ®µæ¨é€²æµç¨‹
1. **å¯©æ ¸è©•ä¼°**ï¼šæª¢æŸ¥æŠ•ç¥¨é€šéç‡æ˜¯å¦é”åˆ°é–€æª»
2. **è‡ªå‹•æ¨é€²**ï¼šé”åˆ°é–€æª»è‡ªå‹•é€²å…¥ä¸‹ä¸€éšæ®µ
3. **ç¸½ PM ä»‹å…¥**ï¼šæœªé”é–€æª»æ™‚ç”±ç¸½ PM æ±ºç­–
4. **ç‹€æ…‹æ›´æ–°**ï¼šæ›´æ–°å°ˆæ¡ˆå’Œéšæ®µç‹€æ…‹
5. **é€šçŸ¥ç™¼é€**ï¼šé€šçŸ¥ç›¸é—œæˆå“¡éšæ®µè®Šæ›´

### ç•°å¸¸è™•ç†æ©Ÿåˆ¶

#### æ’ååƒèˆ‡ä¸è¶³
- **æª¢æ¸¬æ¢ä»¶**ï¼šæäº¤æœ€çµ‚æ’åçš„çµ„åˆ¥éå°‘ï¼ˆå»ºè­°å°‘æ–¼ç¸½çµ„æ•¸çš„50%ï¼‰
- **è™•ç†æ–¹å¼**ï¼šç³»çµ±ä»å¯é‹ä½œï¼Œä½†æ’åå¯ä¿¡åº¦é™ä½
- **æ›¿ä»£æ©Ÿåˆ¶**ï¼šç¸½PMå¯é¸æ“‡èª¿æ•´æ¬Šé‡ï¼Œæé«˜ç¸½PMæ’åçš„å½±éŸ¿åŠ›ï¼ˆå¦‚æ”¹ç‚º 30%å­¸ç”Ÿ + 70%ç¸½PMï¼‰

#### çµ„å…§åˆ†æ­§
- **æäº¤è¡çª**ï¼šæ¡ç”¨æœ€å¾Œæäº¤çš„ç‰ˆæœ¬
- **åƒèˆ‡åº¦çˆ­è­°**ï¼šæœªé”æˆå…±è­˜æ™‚çé‡‘æ¶ˆå¤±
- **ä½œè€…æ¨™è¨»çˆ­è­°**ï¼šç¸½ PM äººå·¥ä»²è£

#### æŠ€è¡“æ•…éšœ
- **è³‡æ–™æå£**ï¼šè‡ªå‹•å‚™ä»½å’Œæ¢å¾©æ©Ÿåˆ¶
- **ç³»çµ±ç•°å¸¸**ï¼šç¸½ PM äººå·¥ä»‹å…¥è™•ç†
- **ç¶²è·¯ä¸­æ–·**ï¼šæœ¬åœ°æš«å­˜å’Œé‡è©¦æ©Ÿåˆ¶

#### æƒ¡æ„è¡Œç‚º
- **æƒ¡æ„è©•åˆ†**ï¼šç¸½ PM å¦æ±ºæ¬Šè™•ç†
- **è™›å‡æäº¤**ï¼šç‰ˆæœ¬æ§åˆ¶å’Œå¯©æ ¸æ©Ÿåˆ¶
- **æ¬Šé™æ¿«ç”¨**ï¼šæ“ä½œæ—¥èªŒè¿½è¹¤å’Œå›æ»¾

## ç³»çµ±é…ç½®ç®¡ç†è¨­è¨ˆ

### PropertiesService é…ç½®ç®¡ç†

#### é…ç½®åˆ†å±¤ç­–ç•¥
```javascript
// scripts/config.js - ç³»çµ±é…ç½®ç®¡ç†

class ConfigManager {
  
  /**
   * PropertiesService å­˜å„²çš„ç³»çµ±æ ¸å¿ƒåƒæ•¸
   * ç‰¹é»ï¼šå¿«é€Ÿå­˜å–ã€ä¸éœ€ç¶²è·¯è«‹æ±‚ã€å®‰å…¨æ€§é«˜
   */
  static getSystemConfig(key, defaultValue = null) {
    const scriptProps = PropertiesService.getScriptProperties();
    const value = scriptProps.getProperty(key);
    
    if (value === null) {
      return defaultValue;
    }
    
    // å˜—è©¦è§£æ JSON
    try {
      return JSON.parse(value);
    } catch {
      return value;
    }
  }
  
  static setSystemConfig(key, value) {
    const scriptProps = PropertiesService.getScriptProperties();
    const stringValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
    scriptProps.setProperty(key, stringValue);
  }
  
  static setBatchSystemConfig(configs) {
    const scriptProps = PropertiesService.getScriptProperties();
    const stringConfigs = {};
    
    Object.keys(configs).forEach(key => {
      const value = configs[key];
      stringConfigs[key] = typeof value === 'object' ? JSON.stringify(value) : String(value);
    });
    
    scriptProps.setProperties(stringConfigs);
  }
  
  /**
   * ç³»çµ±æ ¸å¿ƒåƒæ•¸åˆ—è¡¨
   */
  static getCoreConfigs() {
    return {
      // è³‡æ–™åº«é…ç½®
      DATABASE_FOLDER: this.getSystemConfig('DATABASE_FOLDER'), // Google Drive è³‡æ–™åº«æ–‡ä»¶å¤¾ ID
      GLOBAL_WORKBOOK_ID: this.getSystemConfig('GLOBAL_WORKBOOK_ID'), // å…¨åŸŸæ´»é ç°¿ ID
      
      // Cache è¨­å®š
      CACHE_TIMEOUT: this.getSystemConfig('CACHE_TIMEOUT', 5 * 60 * 1000), // 5åˆ†é˜
      SESSION_TIMEOUT: this.getSystemConfig('SESSION_TIMEOUT', 8 * 60 * 60 * 1000), // 8å°æ™‚
      
      // ç³»çµ±é™åˆ¶
      MAX_SUBMISSION_LENGTH: this.getSystemConfig('MAX_SUBMISSION_LENGTH', 10000),
      
      // é€šçŸ¥è¨­å®š
      EMAIL_DAILY_LIMIT: this.getSystemConfig('EMAIL_DAILY_LIMIT', 100),
      NOTIFICATION_BATCH_SIZE: this.getSystemConfig('NOTIFICATION_BATCH_SIZE', 10),
      
      // æ•ˆèƒ½åƒæ•¸
      BATCH_READ_SIZE: this.getSystemConfig('BATCH_READ_SIZE', 1000),
      PARALLEL_REQUESTS_LIMIT: this.getSystemConfig('PARALLEL_REQUESTS_LIMIT', 5),
      
      // å®‰å…¨è¨­å®š
      ADMIN_EMAILS: this.getSystemConfig('ADMIN_EMAILS', []),
      ALLOWED_DOMAINS: this.getSystemConfig('ALLOWED_DOMAINS', []),
      
      // åŠŸèƒ½é–‹é—œ
      FEATURE_FLAGS: this.getSystemConfig('FEATURE_FLAGS', {
        scoring_enabled: true,
        wallet_enabled: true,
        comment_ranking_enabled: true,
        debug_mode: false
      }),
      
      // éƒ¨ç½²ç’°å¢ƒ
      DEBUG_MODE: this.getSystemConfig('DEBUG_MODE', false),
      API_VERSION: this.getSystemConfig('API_VERSION', '1.0.0')
    };
  }
  
  /**
   * Google Sheets å­˜å„²çš„æ¥­å‹™é…ç½®
   * ç‰¹é»ï¼šç”¨æˆ¶å¯ç·¨è¼¯ã€æœƒè®Šæ›´ã€éœ€ç‰ˆæœ¬æ§åˆ¶
   */
  static getBusinessConfig(configKey) {
    try {
      const globalData = readGlobalData();
      const config = globalData.systemConfigs.find(c => c.configKey === configKey);
      
      if (!config) {
        console.warn(`æ¥­å‹™é…ç½®ä¸å­˜åœ¨: ${configKey}`);
        return null;
      }
      
      // å˜—è©¦è§£æ JSON
      try {
        return JSON.parse(config.configValue);
      } catch {
        return config.configValue;
      }
      
    } catch (error) {
      console.error(`è®€å–æ¥­å‹™é…ç½®å¤±æ•—: ${configKey}`, error);
      return null;
    }
  }
  
  static setBusinessConfig(configKey, configValue, description, category = 'general') {
    try {
      const updateData = {
        configKey: configKey,
        configValue: typeof configValue === 'object' ? JSON.stringify(configValue) : String(configValue),
        description: description,
        category: category,
        lastModified: Date.now()
      };
      
      updateSheetRow(null, 'SystemConfigs', 'configKey', configKey, updateData);
      
    } catch (error) {
      console.error(`è¨­å®šæ¥­å‹™é…ç½®å¤±æ•—: ${configKey}`, error);
      throw error;
    }
  }
  
  /**
   * é è¨­æ¥­å‹™é…ç½®
   */
  static getDefaultBusinessConfigs() {
    return {
      // éšæ®µè¨­å®š
      DEFAULT_STAGE_DURATION: 7, // å¤©
      DEFAULT_CONSENSUS_RATIO: 0.7, // 70%
      MIN_GROUP_SIZE: 2,
      MAX_GROUP_SIZE: 6,
      
      // è©•åˆ†è¨­å®š
      RANKING_WEIGHTS: {
        student_weight: 0.7,
        pm_weight: 0.3
      },
      
      // éŒ¢åŒ…è¨­å®š
      WALLET_SETTINGS: {
        initial_balance: 0,
        reward_amounts: {
          first_place: 100,
          second_place: 60,
          third_place: 30,
          comment_award: 20
        }
      },
      
      // é€šçŸ¥è¨­å®š
      NOTIFICATION_SETTINGS: {
        mention_notification: true,
        stage_deadline_reminder: true,
        submission_notification: true,
        ranking_notification: true,
        daily_summary: false
      },
      
      // UI è¨­å®š
      UI_SETTINGS: {
        theme: 'light',
        sidebar_collapsed: false,
        items_per_page: 20,
        date_format: 'zh-TW'
      }
    };
  }
  
  /**
   * åˆå§‹åŒ–ç³»çµ±é…ç½®
   */
  static initializeSystem() {
    console.log('åˆå§‹åŒ–ç³»çµ±é…ç½®...');
    
    // è¨­å®šæ ¸å¿ƒç³»çµ±åƒæ•¸
    const coreConfigs = {
      // è³‡æ–™åº«æ–‡ä»¶å¤¾ (å¿…é ˆæ‰‹å‹•è¨­å®š)
      DATABASE_FOLDER: '', // éœ€è¦ç®¡ç†å“¡æ‰‹å‹•è¨­å®š Google Drive æ–‡ä»¶å¤¾ ID
      
      CACHE_TIMEOUT: 5 * 60 * 1000,
      SESSION_TIMEOUT: 8 * 60 * 60 * 1000,
      EMAIL_DAILY_LIMIT: 100,
      FEATURE_FLAGS: {
        scoring_enabled: true,
        wallet_enabled: true,
        comment_ranking_enabled: true,
        debug_mode: false
      },
      API_VERSION: '1.0.0'
    };
    
    this.setBatchSystemConfig(coreConfigs);
    
    // åˆå§‹åŒ–æ¥­å‹™é…ç½®åˆ° Google Sheets
    const businessConfigs = this.getDefaultBusinessConfigs();
    Object.keys(businessConfigs).forEach(key => {
      this.setBusinessConfig(
        key, 
        businessConfigs[key], 
        `é è¨­${key}è¨­å®š`, 
        'default'
      );
    });
    
    console.log('ç³»çµ±é…ç½®åˆå§‹åŒ–å®Œæˆ');
  }
  
  /**
   * ç’°å¢ƒç›¸é—œæ“ä½œ
   */
  
  static isDebugMode() {
    return this.getSystemConfig('DEBUG_MODE', false) || this.isDevelopment();
  }
  
  static isFeatureEnabled(featureName) {
    const flags = this.getSystemConfig('FEATURE_FLAGS', {});
    return flags[featureName] === true;
  }
  
  /**
   * å–å¾—å®Œæ•´é…ç½®
   */
  static getAllConfigs() {
    const coreConfigs = this.getCoreConfigs();
    const businessConfigs = {};
    
    // è®€å–æ‰€æœ‰æ¥­å‹™é…ç½®
    try {
      const globalData = readGlobalData();
      globalData.systemConfigs.forEach(config => {
        try {
          businessConfigs[config.configKey] = JSON.parse(config.configValue);
        } catch {
          businessConfigs[config.configKey] = config.configValue;
        }
      });
    } catch (error) {
      console.error('è®€å–æ¥­å‹™é…ç½®å¤±æ•—:', error);
    }
    
    return {
      core: coreConfigs,
      business: businessConfigs
    };
  }
}

// å…¨åŸŸå‡½æ•¸å°è£
function getConfig(key, defaultValue = null) {
  // å…ˆå¾ PropertiesService æŸ¥æ‰¾
  const coreValue = ConfigManager.getSystemConfig(key);
  if (coreValue !== null) {
    return coreValue;
  }
  
  // å†å¾ Google Sheets æŸ¥æ‰¾
  const businessValue = ConfigManager.getBusinessConfig(key);
  if (businessValue !== null) {
    return businessValue;
  }
  
  return defaultValue;
}

function setConfig(key, value, isBusinessConfig = false) {
  if (isBusinessConfig) {
    ConfigManager.setBusinessConfig(key, value, `ç³»çµ±è¨­å®š: ${key}`);
  } else {
    ConfigManager.setSystemConfig(key, value);
  }
}

function isFeatureEnabled(featureName) {
  return ConfigManager.isFeatureEnabled(featureName);
}

function isDebugMode() {
  return ConfigManager.isDebugMode();
}

/**
 * åˆ†ç‰‡è³‡æ–™åº«ç®¡ç†ç³»çµ±
 */
class DatabaseManager {
  
  /**
   * å–å¾—è³‡æ–™åº«æ–‡ä»¶å¤¾
   */
  static getDatabaseFolder() {
    const folderId = ConfigManager.getSystemConfig('DATABASE_FOLDER');
    if (!folderId) {
      throw new Error('ç³»çµ±æœªè¨­å®š DATABASE_FOLDERï¼Œè«‹è¯çµ¡ç®¡ç†å“¡');
    }
    
    try {
      return DriveApp.getFolderById(folderId);
    } catch (error) {
      throw new Error(`è³‡æ–™åº«æ–‡ä»¶å¤¾ä¸å­˜åœ¨æˆ–ç„¡æ¬Šé™å­˜å–: ${folderId}`);
    }
  }
  
  /**
   * åˆå§‹åŒ–å…¨åŸŸæ´»é ç°¿
   */
  static initializeGlobalWorkbook() {
    console.log('åˆå§‹åŒ–å…¨åŸŸè³‡æ–™åº«...');
    
    const folder = this.getDatabaseFolder();
    const workbookName = 'ScoringSystem-Global';
    
    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
    const existingFiles = folder.getFilesByName(workbookName);
    if (existingFiles.hasNext()) {
      const existingFile = existingFiles.next();
      const workbookId = existingFile.getId();
      
      ConfigManager.setSystemConfig('GLOBAL_WORKBOOK_ID', workbookId);
      console.log(`ä½¿ç”¨ç¾æœ‰å…¨åŸŸæ´»é ç°¿: ${workbookId}`);
      return SpreadsheetApp.openById(workbookId);
    }
    
    // å»ºç«‹æ–°çš„å…¨åŸŸæ´»é ç°¿
    const spreadsheet = SpreadsheetApp.create(workbookName);
    const file = DriveApp.getFileById(spreadsheet.getId());
    
    // ç§»å‹•åˆ°æŒ‡å®šæ–‡ä»¶å¤¾
    folder.addFile(file);
    DriveApp.getRootFolder().removeFile(file);
    
    // è¨­å®šå·¥ä½œè¡¨çµæ§‹
    this.setupGlobalWorkbookStructure(spreadsheet);
    
    // å„²å­˜ ID åˆ°é…ç½®
    const workbookId = spreadsheet.getId();
    ConfigManager.setSystemConfig('GLOBAL_WORKBOOK_ID', workbookId);
    
    console.log(`å»ºç«‹æ–°å…¨åŸŸæ´»é ç°¿: ${workbookId}`);
    return spreadsheet;
  }
  
  /**
   * å»ºç«‹å°ˆæ¡ˆåˆ†ç‰‡æ´»é ç°¿
   */
  static createProjectWorkbook(projectId, projectName) {
    console.log(`ç‚ºå°ˆæ¡ˆ ${projectId} å»ºç«‹åˆ†ç‰‡æ´»é ç°¿...`);
    
    const folder = this.getDatabaseFolder();
    const workbookName = `ScoringSystem-Project-${projectId}`;
    
    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
    const existingFiles = folder.getFilesByName(workbookName);
    if (existingFiles.hasNext()) {
      const existingFile = existingFiles.next();
      console.log(`å°ˆæ¡ˆæ´»é ç°¿å·²å­˜åœ¨: ${existingFile.getId()}`);
      return SpreadsheetApp.openById(existingFile.getId());
    }
    
    // å»ºç«‹æ–°çš„å°ˆæ¡ˆæ´»é ç°¿
    const spreadsheet = SpreadsheetApp.create(workbookName);
    const file = DriveApp.getFileById(spreadsheet.getId());
    
    // ç§»å‹•åˆ°æŒ‡å®šæ–‡ä»¶å¤¾
    folder.addFile(file);
    DriveApp.getRootFolder().removeFile(file);
    
    // è¨­å®šå·¥ä½œè¡¨çµæ§‹
    this.setupProjectWorkbookStructure(spreadsheet, projectId);
    
    // æ›´æ–°å…¨åŸŸæ´»é ç°¿ä¸­çš„å°ˆæ¡ˆè³‡è¨Š
    this.updateProjectRecord(projectId, spreadsheet.getId());
    
    console.log(`å»ºç«‹å°ˆæ¡ˆæ´»é ç°¿: ${spreadsheet.getId()}`);
    return spreadsheet;
  }
  
  /**
   * è¨­å®šå…¨åŸŸæ´»é ç°¿çµæ§‹
   */
  static setupGlobalWorkbookStructure(spreadsheet) {
    // å¼•ç”¨ä»£ç¢¼ä¸­å®šç¾©çš„å·¥ä½œè¡¨çµæ§‹æ¨¡æ¿
    const templates = getGlobalWorkbookTemplate();
    
    // åˆªé™¤é è¨­å·¥ä½œè¡¨
    const defaultSheet = spreadsheet.getSheets()[0];
    
    // æ ¹æ“šæ¨¡æ¿å»ºç«‹æ‰€æœ‰å·¥ä½œè¡¨
    Object.keys(templates).forEach(sheetName => {
      const headers = templates[sheetName];
      const sheet = spreadsheet.insertSheet(sheetName);
      const range = sheet.getRange(1, 1, 1, headers.length);
      range.setValues([headers]);
      
      // è¨­å®šæ¨™é¡Œæ¬„æ ¼å¼
      range.setFontWeight('bold');
      range.setBackground('#f0f0f0');
    });
    
    // åˆªé™¤é è¨­å·¥ä½œè¡¨
    spreadsheet.deleteSheet(defaultSheet);
    
    console.log('å…¨åŸŸæ´»é ç°¿çµæ§‹è¨­å®šå®Œæˆ');
  }
  
  /**
   * è¨­å®šå°ˆæ¡ˆæ´»é ç°¿çµæ§‹
   */
  static setupProjectWorkbookStructure(spreadsheet, projectId) {
    // å¼•ç”¨ä»£ç¢¼ä¸­å®šç¾©çš„å·¥ä½œè¡¨çµæ§‹æ¨¡æ¿
    const templates = getProjectWorkbookTemplate();
    
    // åˆªé™¤é è¨­å·¥ä½œè¡¨
    const defaultSheet = spreadsheet.getSheets()[0];
    
    // æ ¹æ“šæ¨¡æ¿å»ºç«‹æ‰€æœ‰å·¥ä½œè¡¨
    Object.keys(templates).forEach(sheetName => {
      const headers = templates[sheetName];
      const sheet = spreadsheet.insertSheet(sheetName);
      const range = sheet.getRange(1, 1, 1, headers.length);
      range.setValues([headers]);
      
      // è¨­å®šæ¨™é¡Œæ¬„æ ¼å¼
      range.setFontWeight('bold');
      range.setBackground('#e3f2fd');
    });
    
    // åˆªé™¤é è¨­å·¥ä½œè¡¨
    spreadsheet.deleteSheet(defaultSheet);
    
    console.log(`å°ˆæ¡ˆ ${projectId} æ´»é ç°¿çµæ§‹è¨­å®šå®Œæˆ`);
  }
  
  /**
   * æ›´æ–°å…¨åŸŸæ´»é ç°¿ä¸­çš„å°ˆæ¡ˆè¨˜éŒ„
   */
  static updateProjectRecord(projectId, workbookId) {
    try {
      updateSheetRow(null, 'Projects', 'projectId', projectId, {
        workbookId: workbookId
      });
      console.log(`æ›´æ–°å°ˆæ¡ˆ ${projectId} çš„ workbookId: ${workbookId}`);
    } catch (error) {
      console.error(`æ›´æ–°å°ˆæ¡ˆè¨˜éŒ„å¤±æ•—:`, error);
    }
  }
  
  /**
   * å–å¾—æ‰€æœ‰å°ˆæ¡ˆæ´»é ç°¿æ¸…å–®
   */
  static listAllProjectWorkbooks() {
    try {
      const folder = this.getDatabaseFolder();
      const files = folder.getFilesByType(MimeType.GOOGLE_SHEETS);
      const projectWorkbooks = [];
      
      while (files.hasNext()) {
        const file = files.next();
        const filename = file.getName();
        
        if (filename.startsWith('ScoringSystem-Project-')) {
          const projectId = filename.replace('ScoringSystem-Project-', '');
          projectWorkbooks.push({
            projectId: projectId,
            filename: filename,
            fileId: file.getId(),
            lastModified: file.getLastUpdated()
          });
        }
      }
      
      return projectWorkbooks;
    } catch (error) {
      console.error('åˆ—èˆ‰å°ˆæ¡ˆæ´»é ç°¿å¤±æ•—:', error);
      return [];
    }
  }
  
  /**
   * æ¸…ç†å­¤ç«‹çš„å°ˆæ¡ˆæ´»é ç°¿
   */
  static cleanupOrphanedWorkbooks() {
    console.log('æª¢æŸ¥å­¤ç«‹çš„å°ˆæ¡ˆæ´»é ç°¿...');
    
    const projectWorkbooks = this.listAllProjectWorkbooks();
    const globalData = readGlobalData();
    const activeProjectIds = globalData.projects.map(p => p.projectId);
    
    let cleanedCount = 0;
    
    projectWorkbooks.forEach(workbook => {
      if (!activeProjectIds.includes(workbook.projectId)) {
        console.log(`ç™¼ç¾å­¤ç«‹æ´»é ç°¿: ${workbook.filename}`);
        
        // å¯é¸æ“‡åˆªé™¤æˆ–æ¨™è¨˜ç‚ºå­¤ç«‹
        // DriveApp.getFileById(workbook.fileId).setTrashed(true);
        cleanedCount++;
      }
    });
    
    console.log(`æª¢æŸ¥å®Œæˆï¼Œç™¼ç¾ ${cleanedCount} å€‹å­¤ç«‹æ´»é ç°¿`);
    return cleanedCount;
  }
}

// å°å‡º API å‡½æ•¸
function initializeDatabase() {
  return DatabaseManager.initializeGlobalWorkbook();
}

function createProjectDatabase(projectId, projectName) {
  return DatabaseManager.createProjectWorkbook(projectId, projectName);
}

function getDatabaseFolder() {
  return DatabaseManager.getDatabaseFolder();
}

function cleanupDatabase() {
  return DatabaseManager.cleanupOrphanedWorkbooks();
}
```

### é…ç½®ä½¿ç”¨ç¯„ä¾‹
```javascript
// ä½¿ç”¨ç³»çµ±é…ç½®
const cacheTimeout = getConfig('CACHE_TIMEOUT');

// åŠŸèƒ½é–‹é—œæª¢æŸ¥
if (isFeatureEnabled('scoring_enabled')) {
  // åŸ·è¡Œè©•åˆ†ç›¸é—œé‚è¼¯
}

// ç’°å¢ƒæª¢æŸ¥
if (isDebugMode()) {
  console.log('Debug æ¨¡å¼é–‹å•Ÿ');
}

// å‹•æ…‹é…ç½®æ›´æ–°
setConfig('DEFAULT_STAGE_DURATION', 10, true); // å­˜å…¥ Sheets
setConfig('DEBUG_MODE', true, false); // å­˜å…¥ PropertiesService
```

## æ¬Šé™ç®¡ç†è¨­è¨ˆ

### ç¾¤çµ„å¼æ¬Šé™ç³»çµ±

#### ç¾¤çµ„ç®¡ç†æ©Ÿåˆ¶
ç³»çµ±æ¡ç”¨ç¾¤çµ„å¼æ¬Šé™ç®¡ç†ï¼Œå–ä»£è¤‡é›œçš„æ¨™ç±¤å¼æ¬Šé™ã€‚ç”¨æˆ¶é€éåŠ å…¥ç¾¤çµ„ç²å¾—ç›¸æ‡‰æ¬Šé™ï¼Œç¾¤çµ„å¯ä»¥è·¨å°ˆæ¡ˆé‡ç”¨ä¸¦åˆ†é…ä¸åŒè§’è‰²ã€‚

#### æ¬Šé™æª¢æŸ¥æ©Ÿåˆ¶
```javascript
// permissions.gs - ç´”é‚è¼¯é‹ç®—
function checkPermissionInMemory(userEmail, action, resource, allData) {
  const userProjectGroups = getUserProjectGroupsFromMemory(
    allData.userGroups, 
    allData.projectGroups, 
    userEmail, 
    resource.projectId
  );
  
  switch(action) {
    case 'create_project':
      return userProjectGroups.some(group => group.groupRole === 'pm');
    
    case 'submit_deliverable':
      return userProjectGroups.some(group => 
        group.groupRole === 'deliverable_team' && 
        group.permissions.includes('submit')
      );
    
    case 'vote_ranking':
      return userProjectGroups.some(group => 
        group.permissions.includes('vote')
      );
    
    case 'complete_stage':
      return userProjectGroups.some(group => 
        group.groupRole === 'pm'
      );
    
    default:
      return false;
  }
}
```

#### ç¾¤çµ„è§’è‰²å®šç¾©
- **pm**ï¼šå°ˆæ¡ˆç®¡ç†è€…è§’è‰²ï¼Œå…·æœ‰æœ€é«˜æ¬Šé™
- **deliverable_team**ï¼šäº¤æˆæœåœ˜éšŠï¼Œè² è²¬æäº¤æˆæœå’Œäº’è©•
- **reviewer**ï¼šç´”å¯©æ ¸è€…è§’è‰²ï¼Œåƒ…åƒèˆ‡è©•åˆ†ä¸æäº¤æˆæœ
- **observer**ï¼šè§€å¯Ÿè€…è§’è‰²ï¼Œåƒ…æŸ¥çœ‹æ¬Šé™

#### ç¾¤çµ„æ¬Šé™æ§åˆ¶
```javascript
// ç¾¤çµ„åŠ å…¥æ§åˆ¶æ©Ÿåˆ¶
allowChange: true   // ç”¨æˆ¶å¯è‡ªç”±åŠ å…¥ï¼Œç¸½PMå¯ç®¡ç†æˆå“¡
allowChange: false  // ç¾¤çµ„é–å®šï¼Œåƒ…ç¸½PMå¯å¼·åˆ¶æ“ä½œ
```

## å¤–æ›ç³»çµ±è¨­è¨ˆ

### é…ç½®é©…å‹•çš„å¤–æ›æ©Ÿåˆ¶

#### ç³»çµ±é…ç½®çµæ§‹
```javascript
// config.gs
function getSystemConfig() {
  return {
    // æ ¸å¿ƒç³»çµ±é…ç½®
    core: {
      approvalThreshold: 0.67,
      maxResubmissions: 3,
      pmWeight: 0.3
    },
    
    // å¤–æ›åŠŸèƒ½é…ç½®
    plugins: {
      scoring: {
        enabled: true,
        standardRewardPool: 300,
        evaluationThreshold: 0.5,
        commentRewardRatio: 0.2
      },
      
      wallet: {
        enabled: true, // ä¾è³´ scoring.enabled
        initialBalance: 0,
        maxTransactionHistory: 1000
      },
      
      notification: {
        enabled: true,
        emailEnabled: true,
        slackEnabled: false
      },
      
      audit: {
        enabled: true,
        detailLevel: 'full',
        retentionDays: 365
      }
    }
  };
}
```

#### æ¢ä»¶å¼åŠŸèƒ½åŸ·è¡Œ
```javascript
// æ¥­å‹™å‡½æ•¸ä¸­çš„å¤–æ›æª¢æŸ¥æ¨¡å¼
function processStageCompletion(stageId) {
  const config = getSystemConfig();
  
  // æ ¸å¿ƒæ¥­å‹™é‚è¼¯ï¼ˆç¸½æ˜¯åŸ·è¡Œï¼‰
  const stageResult = updateStageStatus(stageId, 'completed');
  
  // å¤–æ›åŠŸèƒ½ï¼ˆæ¢ä»¶åŸ·è¡Œï¼‰
  let rankings = [];
  let transactions = [];
  
  if (config.plugins.scoring.enabled) {
    rankings = calculateStageRankings(stageId, config.plugins.scoring);
    
    if (config.plugins.wallet.enabled) {
      transactions = distributeRewards(rankings, config.plugins.wallet);
    }
  }
  
  if (config.plugins.audit.enabled) {
    logStageCompletion(stageId, stageResult, rankings);
  }
  
  return { stageResult, rankings, transactions };
}
```

### å¤–æ›ä¾è³´ç®¡ç†

#### éŒ¢åŒ…ä¾è³´è©•åˆ†æª¢æŸ¥
```javascript
// wallet.gs
function addReward(userEmail, amount, source) {
  const config = getSystemConfig();
  
  // æª¢æŸ¥ä¾è³´çš„å¤–æ›æ˜¯å¦å•Ÿç”¨
  if (!config.plugins.scoring.enabled) {
    console.log('WalletåŠŸèƒ½éœ€è¦ScoringåŠŸèƒ½å•Ÿç”¨');
    return null;
  }
  
  if (!config.plugins.wallet.enabled) {
    console.log('WalletåŠŸèƒ½æœªå•Ÿç”¨');
    return null;
  }
  
  // åŸ·è¡ŒéŒ¢åŒ…é‚è¼¯
  return processRewardTransaction(userEmail, amount, source);
}
```

## æ¸¬è©¦ç­–ç•¥

### å‡½æ•¸å¼æ¸¬è©¦æ–¹æ³•

#### å–®å…ƒæ¸¬è©¦è¨­è¨ˆ
```javascript
// æ¸¬è©¦ç´”é‚è¼¯å‡½æ•¸
function testCalculateRankings() {
  const mockSubmissions = [
    { groupId: 'A', score: 85 },
    { groupId: 'B', score: 92 },
    { groupId: 'C', score: 78 }
  ];
  
  const rankings = calculateRankingsInMemory(mockSubmissions);
  
  assert(rankings[0].groupId === 'B');
  assert(rankings[0].rank === 1);
  assert(rankings.length === 3);
}

// æ¸¬è©¦æ¬Šé™æª¢æŸ¥é‚è¼¯
function testPermissionCheck() {
  const mockPermissionData = {
    userGroups: [
      ['mbr_uuid1', 'grp_uuid1', 'user1@email.com', 'member', Date.now(), true]
    ],
    projectGroups: [
      ['map_uuid1', 'proj_uuid1', 'grp_uuid1', 'pm', 'create,manage', Date.now()]
    ]
  };
  
  const canCreate = checkPermissionInMemory(
    'user1@email.com', 
    'create_project', 
    {projectId: 'proj_uuid1'}, 
    mockPermissionData
  );
  
  assert(canCreate === true);
}
```

#### æ•´åˆæ¸¬è©¦è¨­è¨ˆ
```javascript
// æ¸¬è©¦å®Œæ•´æ¥­å‹™æµç¨‹
function testCompleteStageWorkflow() {
  // æº–å‚™æ¸¬è©¦è³‡æ–™
  setupTestDatabase();
  
  // åŸ·è¡Œæ¥­å‹™æµç¨‹
  const result = completeStage('test_stage_001');
  
  // é©—è­‰çµæœ
  assert(result.stageResult.status === 'completed');
  assert(result.rankings.length > 0);
  
  // æ¸…ç†æ¸¬è©¦è³‡æ–™
  cleanupTestDatabase();
}
```

#### Mock è³‡æ–™åº«æ¸¬è©¦
```javascript
// ä½¿ç”¨è¨˜æ†¶é«”æ¨¡æ“¬è³‡æ–™åº«
function createMockDatabase() {
  return {
    core: {
      projects: [
        ['proj_uuid1', 'Test Project', 'Description', 3, 1, 'active', 'pm@email.com', Date.now(), Date.now()]
      ],
      groups: [
        ['grp_uuid1', 'Açµ„', 'Test Group', 'pm@email.com', Date.now(), 'active', true]
      ]
    },
    main: {
      stages: [
        ['stg_uuid1', 'proj_uuid1', 'Stage 1', 1, Date.now(), Date.now() + 86400000, Date.now() + 43200000, 'active', 'Description', Date.now()]
      ],
      submissions: [
        ['sub_uuid1', 'proj_uuid1', 'stg_uuid1', 'grp_uuid1', '# Test Content', '["user1@email.com"]', '{"user1": 1.0}', 'v1', Date.now(), 'user1@email.com', 'submitted']
      ]
    }
  };
}
```

## æ•ˆèƒ½æœ€ä½³åŒ–æŒ‡å¼•

### Google Sheets è®€å¯«æœ€ä½³åŒ–

#### æœ€å°åŒ– Google Sheets API èª¿ç”¨æ¬¡æ•¸
```javascript
// âœ… å¥½çš„åšæ³•ï¼šæ‰¹æ¬¡è¼‰å…¥
function processMultipleSubmissions(submissionIds, projectId) {
  // ä¸€æ¬¡è®€å–å®Œæ•´å·¥ä½œè¡¨ï¼Œåœ¨è¨˜æ†¶é«”ä¸­ç¯©é¸
  const allSubmissions = readSheetData(projectId, 'Submissions');
  const submissions = allSubmissions.filter(submission => 
    submissionIds.includes(submission.submissionId)
  );
  
  const results = [];
  submissions.forEach(submission => {
    // åœ¨è¨˜æ†¶é«”ä¸­è™•ç†
    const processedResult = processSubmissionInMemory(submission);
    results.push(processedResult);
  });
  
  // æ‰¹æ¬¡å¯«å…¥çµæœ
  batchUpdateSubmissionResults(projectId, results);
  
  return results;
}

// âŒ é¿å…çš„åšæ³•ï¼šé‡è¤‡æŸ¥è©¢
function processMultipleSubmissionsBad(submissionIds, projectId) {
  const results = [];
  for (const id of submissionIds) {
    // æ¯æ¬¡éƒ½å–®ç¨è®€å–å·¥ä½œè¡¨
    const allSubmissions = readSheetData(projectId, 'Submissions');
    const submission = allSubmissions.find(s => s.submissionId === id);
    const processedResult = processSubmission(submission);
    // æ¯æ¬¡éƒ½å–®ç¨å¯«å…¥
    updateSheetRow(projectId, 'Submissions', 'submissionId', id, processedResult);
    results.push(processedResult);
  }
  return results;
}
```

#### å¿«å–ç­–ç•¥
```javascript
// database.gs - å¯¦ä½œ Google Sheets è³‡æ–™å¿«å–
const cache = new Map();
const CACHE_TIMEOUT = 5 * 60 * 1000; // 5åˆ†é˜

async function getCachedData(key, loader) {
  const now = Date.now();
  
  if (cache.has(key)) {
    const cached = cache.get(key);
    if (now - cached.timestamp < CACHE_TIMEOUT) {
      return cached.data;
    }
  }
  
  const data = await loader();
  cache.set(key, {
    data: data,
    timestamp: now
  });
  
  return data;
}

function loadUserGroupsCached(userEmail, projectId) {
  return getCachedData(`user_groups_${userEmail}`, () => {
    const allUserGroups = readSheetData(projectId, 'UserGroups');
    return allUserGroups.filter(userGroup => 
      userGroup.userEmail === userEmail && userGroup.isActive === true
    );
  });
}
```

### è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ–

#### è³‡æ–™çµæ§‹è¨­è¨ˆ
```javascript
// ä½¿ç”¨ Map æé«˜æŸ¥è©¢æ•ˆèƒ½
function buildUserGroupsMap(userGroupsArray) {
  const userGroupsMap = new Map();
  
  userGroupsArray.forEach(row => {
    const [membershipId, groupId, userEmail, role, joinTime, isActive] = row;
    
    if (!userGroupsMap.has(userEmail)) {
      userGroupsMap.set(userEmail, []);
    }
    
    if (isActive) {
      userGroupsMap.get(userEmail).push({
        groupId: groupId,
        role: role,
        joinTime: joinTime
      });
    }
  });
  
  return userGroupsMap;
}

// å¿«é€ŸæŸ¥è©¢ç”¨æˆ¶ç¾¤çµ„
function getUserGroupsFromMap(userGroupsMap, userEmail) {
  return userGroupsMap.get(userEmail) || [];
}
```

### Google Sheets æ•ˆèƒ½ç›£æ§

#### æ´»é ç°¿æ•ˆèƒ½è¿½è¹¤
```javascript
// utils.js - Google Sheets æ•ˆèƒ½ç›£æ§
function sheetsPerformanceMonitor(projectId) {
  const startTime = Date.now();
  
  try {
    // æª¢æŸ¥å…¨åŸŸæ´»é ç°¿
    const globalWorkbook = getGlobalWorkbook();
    const globalTestResult = globalWorkbook.getSheetByName('Projects').getRange('A1').getValue();
    
    // æª¢æŸ¥å°ˆæ¡ˆæ´»é ç°¿
    const projectWorkbook = getProjectWorkbook(projectId);
    const projectTestResult = projectWorkbook.getSheetByName('ProjectInfo').getRange('A1').getValue();
    
    // æ¸¬è©¦å¿«å–æ•ˆèƒ½
    const cacheTestStart = Date.now();
    getCachedProjectData(projectId);
    const cacheResponseTime = Date.now() - cacheTestStart;
    
    const totalResponseTime = Date.now() - startTime;
    
    return {
      status: 'healthy',
      totalResponseTime: totalResponseTime,
      cacheResponseTime: cacheResponseTime,
      projectId: projectId,
      globalWorkbook: globalWorkbook.getId(),
      projectWorkbook: projectWorkbook.getId(),
      cacheHit: cacheResponseTime < 100,
      timestamp: Date.now()
    };
    
  } catch (error) {
    return {
      status: 'error',
      responseTime: Date.now() - startTime,
      projectId: projectId,
      error: error.message,
      timestamp: Date.now()
    };
  }
}

// æ•ˆèƒ½æœ€ä½³åŒ–å»ºè­°
function getPerformanceRecommendations(projectId) {
  const projectData = getCachedProjectData(projectId);
  const recommendations = [];
  
  // æª¢æŸ¥è³‡æ–™é‡
  const totalRecords = Object.values(projectData).reduce((sum, sheet) => {
    return sum + (Array.isArray(sheet) ? sheet.length : 0);
  }, 0);
  
  if (totalRecords > 5000) {
    recommendations.push({
      type: 'data_archival',
      message: 'è€ƒæ…®å°å­˜èˆŠè³‡æ–™ä»¥æå‡æ•ˆèƒ½',
      priority: 'medium'
    });
  }
  
  // æª¢æŸ¥å¿«å–ä½¿ç”¨æƒ…æ³
  const cacheSize = sheetsCache.size;
  if (cacheSize > 10) {
    recommendations.push({
      type: 'cache_cleanup',
      message: 'æ¸…ç†éæœŸå¿«å–ä»¥é‡‹æ”¾è¨˜æ†¶é«”',
      priority: 'low'
    });
  }
  
  return recommendations;
}
```

## é‚€è«‹ç¢¼ç³»çµ±è©³ç´°è¨­è¨ˆ

### é‚€è«‹æ©Ÿåˆ¶æµç¨‹

#### 1. é‚€è«‹ç¢¼ç”Ÿæˆæµç¨‹
```javascript
// ç®¡ç†å“¡ç‚ºç‰¹å®šç”¨æˆ¶ç”Ÿæˆé‚€è«‹ç¢¼
function generateInvitationForUser(adminEmail, targetEmail, validDays = 7) {
  // 1. é©—è­‰ç®¡ç†å“¡æ¬Šé™
  // 2. é©—è­‰ç›®æ¨™ Email æ ¼å¼
  // 3. æª¢æŸ¥ç›®æ¨™ç”¨æˆ¶æ˜¯å¦å·²å­˜åœ¨
  // 4. ç”Ÿæˆå”¯ä¸€é‚€è«‹ç¢¼
  // 5. å°‡é‚€è«‹ç¢¼èˆ‡ç›®æ¨™ Email ç¶å®š
  // 6. ç™¼é€é‚€è«‹éƒµä»¶
  return {
    invitationCode: 'INVITE-XXXX-XXXX',
    targetEmail: targetEmail,
    expiryDate: new Date(Date.now() + validDays * 24 * 60 * 60 * 1000)
  };
}
```

#### 2. é‚€è«‹éƒµä»¶å…§å®¹
```
ä¸»é¡Œï¼šæ‚¨å·²è¢«é‚€è«‹åŠ å…¥è©•åˆ†ç³»çµ±

è¦ªæ„›çš„ç”¨æˆ¶ï¼š

æ‚¨å·²è¢«é‚€è«‹åŠ å…¥æˆ‘å€‘çš„å°ˆæ¡ˆè©•åˆ†ç³»çµ±ã€‚
è«‹é»æ“Šä»¥ä¸‹é€£çµå®Œæˆè¨»å†Šï¼š

[è¨»å†Šé€£çµ]

æ‚¨çš„å°ˆå±¬é‚€è«‹ç¢¼ï¼šINVITE-XXXX-XXXX
æ­¤é‚€è«‹ç¢¼å°‡æ–¼ 7 å¤©å¾ŒéæœŸã€‚

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡ã€‚

è¬è¬ï¼
```

#### 3. ç”¨æˆ¶è¨»å†Šæµç¨‹
1. ç”¨æˆ¶æ”¶åˆ°é‚€è«‹éƒµä»¶
2. é»æ“Šè¨»å†Šé€£çµé€²å…¥è¨»å†Šé é¢
3. ç³»çµ±è‡ªå‹•å¡«å…¥é‚€è«‹ç¢¼
4. ç”¨æˆ¶è¨­å®šç”¨æˆ¶åå’Œå¯†ç¢¼
5. ç³»çµ±é©—è­‰é‚€è«‹ç¢¼æœ‰æ•ˆæ€§
6. å»ºç«‹ç”¨æˆ¶å¸³è™Ÿä¸¦æ¨™è¨˜é‚€è«‹ç¢¼ç‚ºå·²ä½¿ç”¨

### é‚€è«‹ç¢¼è³‡æ–™çµæ§‹

```javascript
const invitationSchema = {
  invitationId: 'inv_xxxx',      // å”¯ä¸€è­˜åˆ¥ç¢¼
  invitationCode: 'HASHED_CODE',  // åŠ å¯†å­˜å„²çš„é‚€è«‹ç¢¼
  targetEmail: 'user@email.com',  // ç›®æ¨™ç”¨æˆ¶ Email
  createdBy: 'admin@email.com',   // å»ºç«‹è€…
  createdTime: timestamp,         // å»ºç«‹æ™‚é–“
  expiryTime: timestamp,          // éæœŸæ™‚é–“
  usedTime: null,                 // ä½¿ç”¨æ™‚é–“
  status: 'pending',              // pending/used/expired/cancelled
  metadata: {
    sentCount: 1,                 // éƒµä»¶ç™¼é€æ¬¡æ•¸
    lastSentTime: timestamp,      // æœ€å¾Œç™¼é€æ™‚é–“
    ipAddress: null,              // ä½¿ç”¨æ™‚çš„ IP
    userAgent: null               // ä½¿ç”¨æ™‚çš„ç€è¦½å™¨è³‡è¨Š
  }
};
```

### å®‰å…¨æ€§è€ƒé‡

1. **é‚€è«‹ç¢¼åŠ å¯†**ï¼šé‚€è«‹ç¢¼åœ¨è³‡æ–™åº«ä¸­ä»¥åŠ å¯†å½¢å¼å­˜å„²
2. **å–®ä¸€ç”¨é€”**ï¼šæ¯å€‹é‚€è«‹ç¢¼åªèƒ½ä½¿ç”¨ä¸€æ¬¡
3. **æ™‚æ•ˆæ€§**ï¼šé‚€è«‹ç¢¼æœ‰æ˜ç¢ºçš„éæœŸæ™‚é–“
4. **Email ç¶å®š**ï¼šé‚€è«‹ç¢¼èˆ‡ç‰¹å®š Email ç¶å®šï¼Œé˜²æ­¢æ¿«ç”¨
5. **ç¨½æ ¸è¿½è¹¤**ï¼šè¨˜éŒ„é‚€è«‹ç¢¼çš„å®Œæ•´ç”Ÿå‘½é€±æœŸ

### ç®¡ç†åŠŸèƒ½

1. **æŸ¥çœ‹é‚€è«‹ç¢¼åˆ—è¡¨**ï¼šé¡¯ç¤ºæ‰€æœ‰å·²ç™¼é€çš„é‚€è«‹ç¢¼ç‹€æ…‹
2. **é‡æ–°ç™¼é€é‚€è«‹**ï¼šç‚ºæœªå›æ‡‰çš„ç”¨æˆ¶é‡æ–°ç™¼é€é‚€è«‹éƒµä»¶
3. **æ’¤éŠ·é‚€è«‹ç¢¼**ï¼šå–æ¶ˆå°šæœªä½¿ç”¨çš„é‚€è«‹ç¢¼
4. **é‚€è«‹çµ±è¨ˆ**ï¼šæŸ¥çœ‹é‚€è«‹ç¢¼ä½¿ç”¨ç‡å’Œè½‰æ›ç‡

## éƒ¨ç½²èˆ‡ç¶­è­·

### Google Apps Script + Google Sheets éƒ¨ç½²ç­–ç•¥

#### ç‰ˆæœ¬ç®¡ç†
- **é–‹ç™¼ç‰ˆæœ¬**ï¼šé–‹ç™¼å’Œæ¸¬è©¦éšæ®µä½¿ç”¨ï¼Œç¨ç«‹çš„ Google Sheets å¯¦ä¾‹
- **æ¸¬è©¦ç‰ˆæœ¬**ï¼šåŠŸèƒ½é©—è­‰å’Œä½¿ç”¨è€…æ¥å—æ¸¬è©¦ï¼Œæ¨¡æ“¬ç”Ÿç”¢ç’°å¢ƒ
- **æ­£å¼ç‰ˆæœ¬**ï¼šç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ï¼Œæ­£å¼çš„æ•™å­¸ä½¿ç”¨
- **å‚™ä»½ç‰ˆæœ¬**ï¼šå®šæœŸå‚™ä»½æ´»é ç°¿ï¼Œæ”¯æ´ç·Šæ€¥å›æ»¾

#### ç’°å¢ƒé…ç½®
```javascript

// å‰ç«¯æ§‹å»ºæ•´åˆ
function deployFrontendAssets() {
  // å°‡ Vue 3 æ§‹å»ºç”¢ç‰©æ•´åˆåˆ° GAS å°ˆæ¡ˆ
  const frontendDist = DriveApp.getFolderById('frontend-dist-folder-id');
  const files = frontendDist.getFiles();
  
  while (files.hasNext()) {
    const file = files.next();
    const content = file.getBlob().getDataAsString();
    
    // å°‡å‰ç«¯è³‡æºä½œç‚º HTML æœå‹™æä¾›
    const htmlOutput = HtmlService.createTemplate(content);
    // é€²è¡Œå¿…è¦çš„æ¨¡æ¿è™•ç†
  }
}
```

#### éƒ¨ç½²æª¢æŸ¥æ¸…å–®
1. **Google Sheets è¨­å®š**ï¼šç¢ºèªå…¨åŸŸæ´»é ç°¿å»ºç«‹å’Œå·¥ä½œè¡¨çµæ§‹æ­£ç¢º
2. **æ´»é ç°¿æ¬Šé™é…ç½®**ï¼šè¨­å®šé©ç•¶çš„ Google Sheets å…±äº«æ¬Šé™
3. **GAS å°ˆæ¡ˆé…ç½®**ï¼šç¢ºèª Apps Script å°ˆæ¡ˆè¨­å®šå’Œè§¸ç™¼å™¨é…ç½®
4. **å‰ç«¯è³‡æºæ•´åˆ**ï¼šç¢ºèª Vue 3 æ§‹å»ºç”¢ç‰©æ­£ç¢ºæ•´åˆåˆ° GAS å°ˆæ¡ˆ
5. **åŠŸèƒ½æ¨¡çµ„æª¢æŸ¥**ï¼šç¢ºèªå¤–æ›åŠŸèƒ½æŒ‰é æœŸå•Ÿç”¨/åœç”¨
6. **å¿«å–æ©Ÿåˆ¶æ¸¬è©¦**ï¼šé©—è­‰ Google Sheets è³‡æ–™å¿«å–æ©Ÿåˆ¶é‹ä½œæ­£å¸¸
7. **æ•ˆèƒ½åŸºæº–æ¸¬è©¦**ï¼šç¢ºèªç³»çµ±å›æ‡‰æ™‚é–“åœ¨å¯æ¥å—ç¯„åœï¼ˆ<3ç§’è¼‰å…¥æ™‚é–“ï¼‰
8. **å‚™ä»½æ©Ÿåˆ¶é©—è­‰**ï¼šç¢ºèªæ´»é ç°¿è‡ªå‹•å‚™ä»½åŠŸèƒ½æ­£å¸¸é‹ä½œ

### ç›£æ§èˆ‡ç¶­è­·

#### ç³»çµ±ç›£æ§
```javascript
// utils.js - Google Sheets ç³»çµ±å¥åº·æª¢æŸ¥
function systemHealthCheck() {
  const startTime = Date.now();
  
  try {
    // æª¢æŸ¥å…¨åŸŸæ´»é ç°¿é€£ç·š
    const globalWorkbook = getGlobalWorkbook();
    const projectsSheet = globalWorkbook.getSheetByName('Projects');
    const projectsData = projectsSheet.getRange('A1:A2').getValues();
    
    // æª¢æŸ¥åŸºæœ¬åŠŸèƒ½
    const config = getSystemConfig();
    const currentUser = getCurrentUser();
    
    // æ¸¬è©¦å¿«å–æ©Ÿåˆ¶
    const cacheTestStart = Date.now();
    getCachedGlobalData();
    const cacheResponseTime = Date.now() - cacheTestStart;
    
    const healthStatus = {
      status: 'healthy',
      timestamp: Date.now(),
      responseTime: Date.now() - startTime,
      cacheResponseTime: cacheResponseTime,
      globalWorkbook: {
        id: globalWorkbook.getId(),
        accessible: true,
        projectsCount: projectsData.length - 1
      },
      config: config ? 'loaded' : 'error',
      user: currentUser ? 'authenticated' : 'anonymous',
      cache: {
        enabled: config.cacheEnabled,
        size: sheetsCache.size,
        hitRate: cacheResponseTime < 100 ? 'good' : 'poor'
      }
    };
    
    return healthStatus;
    
  } catch (error) {
    return {
      status: 'error',
      timestamp: Date.now(),
      responseTime: Date.now() - startTime,
      error: error.message,
      stack: error.stack
    };
  }
}

// Vue 3 å‰ç«¯å¥åº·æª¢æŸ¥
function frontendHealthCheck() {
  try {
    // æª¢æŸ¥å‰ç«¯è³‡æºæ˜¯å¦æ­£ç¢ºè¼‰å…¥
    const htmlService = HtmlService.createTemplateFromFile('index');
    const htmlOutput = htmlService.evaluate();
    
    return {
      status: 'healthy',
      frontend: 'loaded',
      timestamp: Date.now()
    };
  } catch (error) {
    return {
      status: 'error',
      frontend: 'failed',
      error: error.message,
      timestamp: Date.now()
    };
  }
}
```

#### éŒ¯èª¤è¿½è¹¤
```javascript
// utils.gs - éŒ¯èª¤è¨˜éŒ„
async function logError(error, context) {
  const errorLog = {
    timestamp: Date.now(),
    error: error.message,
    stack: error.stack,
    context: context,
    user: getCurrentUser(),
    function: context.functionName || 'unknown',
    projectId: context.projectId || null
  };
  
  // è¨˜éŒ„åˆ° Google Sheets EventLogs å·¥ä½œè¡¨
  try {
    addRowToSheet(context.projectId, 'EventLogs', {
      ...errorLog,
      action: 'error_occurred',
      resourceType: 'system',
      severity: context.severity || 'error'
    });
  } catch (logErr) {
    console.error('Failed to log error to Google Sheets:', logErr);
  }
  
  // åš´é‡éŒ¯èª¤ç™¼é€é€šçŸ¥
  if (context.severity === 'critical') {
    sendErrorNotification(errorLog);
  }
}

function withErrorHandling(operation, context) {
  try {
    return {
      success: true,
      data: operation(),
      error: null
    };
  } catch (error) {
    logError(error, context);
    return {
      success: false,
      data: null,
      error: error.message
    };
  }
}
```

#### è³‡æ–™ç¶­è­·æ“ä½œ
```javascript
// database.gs - Google Sheets è³‡æ–™ç¶­è­·
function exportProjectData(projectId) {
  const sheetNames = [
    'Stages', 'Submissions', 'Rankings', 'Comments', 
    'Transactions', 'Votes', 'EventLogs'
  ];
  
  const exportData = {
    projectId: projectId,
    exportTime: Date.now(),
    data: {}
  };
  
  // è®€å–æ‰€æœ‰ç›¸é—œå·¥ä½œè¡¨
  sheetNames.forEach(sheetName => {
    const sheetData = readSheetData(projectId, sheetName);
    exportData.data[sheetName] = sheetData;
  }));
  
  return exportData;
}

function archiveCompletedProject(projectId) {
  // æ›´æ–°å°ˆæ¡ˆç‹€æ…‹ç‚ºå°å­˜
  updateSheetRow(null, 'Projects', 'projectId', projectId, {
    status: 'archived',
    archivedTime: Date.now()
  });
  
  // åŒ¯å‡ºå°ˆæ¡ˆè³‡æ–™ä½œç‚ºå‚™ä»½
  const backupData = await exportProjectData(projectId);
  
  return {
    projectId: projectId,
    archivedTime: Date.now(),
    status: 'archived',
    backupData: backupData
  };
}

function deleteArchivedProject(projectId) {
  // å®‰å…¨æª¢æŸ¥ï¼šç¢ºèªå°ˆæ¡ˆç‹€æ…‹
  const allProjects = readSheetData(null, 'Projects');
  const project = allProjects.find(p => p.projectId === projectId);
  if (!project || project.status !== 'archived') {
    throw new Error('åªèƒ½åˆªé™¤å·²å°å­˜çš„å°ˆæ¡ˆ');
  }
  
  // åˆªé™¤å°ˆæ¡ˆæ´»é ç°¿
  const projectWorkbook = getProjectWorkbook(projectId);
  DriveApp.getFileById(projectWorkbook.getId()).setTrashed(true);
  
  // å¾å…¨åŸŸæ´»é ç°¿åˆªé™¤å°ˆæ¡ˆè¨˜éŒ„
  deleteSheetRow(null, 'Projects', 'projectId', projectId);
  
  return {
    projectId: projectId,
    deletedTime: Date.now(),
    status: 'deleted'
  };
}
```

## å®‰å…¨æ€§è¨­è¨ˆ

### è³‡æ–™å®‰å…¨
- **å­˜å–æ§åˆ¶**ï¼šåŸºæ–¼ Google å¸³è™Ÿçš„èº«ä»½é©—è­‰
- **æ¬Šé™ç®¡ç†**ï¼šç´°ç²’åº¦çš„åŠŸèƒ½æ¬Šé™æ§åˆ¶
- **è³‡æ–™é©—è­‰**ï¼šæ‰€æœ‰è¼¸å…¥è³‡æ–™çš„æ ¼å¼å’Œå…§å®¹é©—è­‰
- **æ“ä½œå¯©è¨ˆ**ï¼šå®Œæ•´çš„ç”¨æˆ¶æ“ä½œè¨˜éŒ„
- **Google Sheets æ¬Šé™æ§åˆ¶**ï¼šé€é Google Sheets å…±äº«æ¬Šé™å’Œå‡½æ•¸å¼æ¬Šé™æª¢æŸ¥æ§åˆ¶è³‡æ–™å­˜å–

### ç³»çµ±å®‰å…¨
- **API å®‰å…¨**ï¼šåªæœ‰ doGet/doPost å°å¤–æš´éœ²
- **è¼¸å…¥é©—è­‰**ï¼šé˜²æ­¢æƒ¡æ„è¼¸å…¥å’Œæ³¨å…¥æ”»æ“Š
- **éŒ¯èª¤è™•ç†**ï¼šä¸æš´éœ²æ•æ„Ÿçš„ç³»çµ±è³‡è¨Š
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æ´å¿«é€Ÿå›æ»¾åˆ°å®‰å…¨ç‰ˆæœ¬
- **UUID ä¿è­·**ï¼šä½¿ç”¨ UUID é¿å…å¯é æ¸¬çš„ ID æ”»æ“Š

### ç¾¤çµ„å®‰å…¨æ©Ÿåˆ¶
```javascript
// permissions.gs - ç¾¤çµ„å®‰å…¨æª¢æŸ¥
function validateGroupOperation(userEmail, operation, groupId, projectId) {
  const coreDb = getCoreDatabase();
  
  // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰æ¬Šé™åŸ·è¡Œç¾¤çµ„æ“ä½œ
  const userPermissions = getUserProjectPermissions(coreDb, userEmail, projectId);
  
  switch(operation) {
    case 'add_member':
    case 'remove_member':
      return userPermissions.includes('manage_groups') || 
             userPermissions.includes('pm');
    
    case 'join_group':
      const group = loadGroupById(coreDb, groupId);
      return group.allowChange;
    
    case 'leave_group':
      return false; // ç”¨æˆ¶ä¸èƒ½ä¸»å‹•é›¢é–‹ç¾¤çµ„
    
    default:
      return false;
  }
}
```

## ç³»çµ±åƒæ•¸é…ç½®

### å¯èª¿æ•´åƒæ•¸

#### æ ¸å¿ƒç³»çµ±åƒæ•¸
- **å¯©æ ¸é€šéé–€æª»**ï¼šé è¨­ 67%ï¼Œå¯èª¿æ•´ç¯„åœ 50%-100%
- **æœ€å¤§é‡äº¤æ¬¡æ•¸**ï¼šé è¨­ 3 æ¬¡ï¼Œå¯èª¿æ•´ç¯„åœ 1-10 æ¬¡
- **ç¸½ PM åŠ æ¬Šæ¯”ä¾‹**ï¼šé è¨­ 30%ï¼Œå¯èª¿æ•´ç¯„åœ 0%-100%

#### è©•åˆ†ç³»çµ±åƒæ•¸ï¼ˆå¤–æ›åŠŸèƒ½ï¼‰
- **æ¨™æº–åŒ–çé‡‘æ± **ï¼šæ¯éšæ®µå›ºå®šé‡‘é¡ï¼Œå¯è‡ªè¨‚
- **è©•è«–çé‡‘æ¯”ä¾‹**ï¼šé è¨­ 20%ï¼Œå¯èª¿æ•´ç¯„åœ 10%-50%
- **è©•åˆ†åƒèˆ‡é–€æª»**ï¼šé è¨­ 50%ï¼Œå¯èª¿æ•´ç¯„åœ 30%-80%
- **æ’åçå‹µåˆ†é…**ï¼šç¬¬1/2/3åçé‡‘æ¯”ä¾‹ï¼Œå¯è‡ªè¨‚

#### ç³»çµ±é‹è¡Œåƒæ•¸
- **å¿«å–éæœŸæ™‚é–“**ï¼šé è¨­ 5 åˆ†é˜ï¼Œå¯èª¿æ•´ç¯„åœ 1-30 åˆ†é˜
- **æ‰¹æ¬¡è™•ç†å¤§å°**ï¼šé è¨­ 100 ç­†ï¼Œå¯èª¿æ•´ç¯„åœ 50-500 ç­†
- **æ“ä½œæ—¥èªŒä¿ç•™å¤©æ•¸**ï¼šé è¨­ 365 å¤©ï¼Œå¯èª¿æ•´ç¯„åœ 30-1095 å¤©

### å»ºè­°é…ç½®

#### å°å‹å°ˆæ¡ˆï¼ˆ3-6 çµ„ï¼‰
- å¯©æ ¸é€šéé–€æª»ï¼š60%
- è©•åˆ†åƒèˆ‡é–€æª»ï¼š50%
- éšæ®µæ•¸é‡ï¼š3-4 å€‹
- æ¯éšæ®µæ™‚ç¨‹ï¼š2-3 é€±

#### ä¸­å‹å°ˆæ¡ˆï¼ˆ7-12 çµ„ï¼‰
- å¯©æ ¸é€šéé–€æª»ï¼š67%
- è©•åˆ†åƒèˆ‡é–€æª»ï¼š60%
- éšæ®µæ•¸é‡ï¼š4-5 å€‹
- æ¯éšæ®µæ™‚ç¨‹ï¼š2-4 é€±

#### å¤§å‹å°ˆæ¡ˆï¼ˆ13+ çµ„ï¼‰
- å¯©æ ¸é€šéé–€æª»ï¼š70%
- è©•åˆ†åƒèˆ‡é–€æª»ï¼š70%
- éšæ®µæ•¸é‡ï¼š5-6 å€‹
- æ¯éšæ®µæ™‚ç¨‹ï¼š3-4 é€±

## å„ªå‹¢ç‰¹è‰²

### æ•™è‚²åƒ¹å€¼
- **åŒå„•å­¸ç¿’**ï¼šé€éäº’è©•ä¿ƒé€²ç›¸äº’å­¸ç¿’å’ŒçŸ¥è­˜åˆ†äº«
- **å€‹äººè²¬ä»»æ„Ÿ**ï¼šå€‹äººåŒ–çå‹µç›´æ¥å°æ‡‰å€‹äººè¡¨ç¾å’Œè²¢ç»
- **çœŸå¯¦è²¢ç»èªå®š**ï¼šåƒèˆ‡ç¢ºèªå’Œä½œè€…æ¨™è¨»ç¢ºä¿çå‹µçµ¦çœŸæ­£è²¢ç»è€…
- **æ‰¹åˆ¤æ€è€ƒè¨“ç·´**ï¼šè©•åˆ†å’Œè©•è«–éç¨‹æå‡åˆ†æå’Œåˆ¤æ–·èƒ½åŠ›
- **åœ˜éšŠå”ä½œæŠ€èƒ½**ï¼šçµ„å…§å…±è­˜æ©Ÿåˆ¶è¨“ç·´æºé€šå’Œå”èª¿èƒ½åŠ›
- **è³ªé‡æ¿€å‹µæ©Ÿåˆ¶**ï¼šå‰ä¸‰åè©•è«–æ©Ÿåˆ¶å¤§å¹…æå‡è©•è«–åƒèˆ‡åº¦å’Œå“è³ª
- **å…¬å¹³ç«¶çˆ­ç’°å¢ƒ**ï¼šå¾¹åº•è§£æ±ºåœ˜éšŠå°ˆæ¡ˆä¸­æ­ä¾¿è»Šçš„å•é¡Œ

### ç®¡ç†æ•ˆç›Š
- **æµç¨‹è‡ªå‹•åŒ–**ï¼šæ¸›å°‘äººå·¥å¹²é éœ€æ±‚ï¼Œæé«˜ç®¡ç†æ•ˆç‡
- **é€æ˜å…¬æ­£**ï¼šæ‰€æœ‰æ±ºç­–éç¨‹é€æ˜å¯è¿½è¹¤ï¼Œå¢åŠ å…¬ä¿¡åŠ›
- **å½ˆæ€§é©æ‡‰**ï¼šå‡½æ•¸å¼æ¶æ§‹é©æ‡‰ä¸åŒè¦æ¨¡å’Œé¡å‹çš„å°ˆæ¡ˆéœ€æ±‚
- **å“è³ªä¿è­‰**ï¼šå¤šå±¤å¯©æ ¸æ©Ÿåˆ¶ç¢ºä¿æˆæœå“è³ªæ¨™æº–
- **ç²¾ç´°æ¬Šé™æ§åˆ¶**ï¼šç¾¤çµ„å¼æ¬Šé™ç®¡ç†ç¢ºä¿è³‡æ–™å’Œæ“ä½œå®‰å…¨
- **å®Œå…¨è‡ªè¨‚åŒ–**ï¼šç¸½ PM å¯å®Œå…¨æ§åˆ¶æ¯éšæ®µçš„åƒæ•¸å’Œçå‹µè¨­å®š

### æŠ€è¡“å„ªå‹¢
- **å®Œå…¨é›¶æˆæœ¬é‹ç‡Ÿ**ï¼šåŸºæ–¼ Google å…è²»æœå‹™ç”Ÿæ…‹ç³»çµ±ï¼ˆGAS + Google Sheetsï¼‰ï¼Œç„¡ä»»ä½•ç¶­è­·æˆæœ¬
- **ç¾ä»£åŒ–ç”¨æˆ¶é«”é©—**ï¼šVue 3 + Element Plus æä¾›éŸ¿æ‡‰å¼ã€ç›´è§€çš„ç¾ä»£åŒ–ä»‹é¢
- **é«˜æ•ˆèƒ½åˆ†ç‰‡æ¶æ§‹**ï¼šGoogle Sheets å¤šåˆ†ç‰‡è¨­è¨ˆï¼Œæ•´è¡¨è®€å–é…åˆè¨˜æ†¶é«”è™•ç†æœ€å¤§åŒ–æ•ˆèƒ½
- **æ˜“æ–¼ç¶­è­·**ï¼šå‡½æ•¸å¼æ¶æ§‹ + Vue 3 Composition APIï¼Œä¾¿æ–¼ç†è§£ã€ä¿®æ”¹å’Œæ“´å±•
- **ç„¡é™å¯æ“´å±•æ€§**ï¼šå°ˆæ¡ˆç¨ç«‹æ´»é ç°¿è¨­è¨ˆï¼Œæ”¯æ´ç„¡é™æ•¸é‡çš„å°ˆæ¡ˆæ“´å±•
- **è³‡æ–™é€æ˜åº¦**ï¼šç›´æ¥åœ¨ Google Sheets ä¸­æŸ¥çœ‹å’Œç®¡ç†è³‡æ–™ï¼Œä¾¿æ–¼é™¤éŒ¯å’Œç¶­è­·  
- **çµ±ä¸€è³‡æ–™ç®¡ç†**ï¼šdatabase.js é›†ä¸­ç®¡ç† Google Sheets æ“ä½œï¼Œè§£æ±ºæ•ˆèƒ½ç“¶é ¸
- **æ™ºèƒ½å¿«å–æ©Ÿåˆ¶**ï¼šå¤šå±¤å¿«å–ç­–ç•¥ï¼Œæœ€å¤§åŒ–æ¸›å°‘ Google Sheets API èª¿ç”¨æ¬¡æ•¸
- **å®Œæ•´æ“ä½œè¿½è¹¤**ï¼šè©³ç´°çš„ç”¨æˆ¶æ“ä½œè¨˜éŒ„å’Œå¯©è¨ˆåŠŸèƒ½ï¼Œæ”¯æ´å®Œæ•´è¡Œç‚ºå›æº¯
- **ç°¡åŒ–ç³»çµ±è¤‡é›œåº¦**ï¼šå€‹äººåŒ–çå‹µæ©Ÿåˆ¶å¤§å¹…ç°¡åŒ–ç³»çµ±è¨­è¨ˆå’Œç®¡ç†è¤‡é›œåº¦
- **å‡½æ•¸å¼è¨­è¨ˆå„ªå‹¢**ï¼šé©åˆ GAS ç’°å¢ƒç‰¹æ€§ï¼Œé¿å…éåº¦å·¥ç¨‹åŒ–å•é¡Œ
- **å‰å¾Œç«¯åˆ†é›¢**ï¼šVue 3 å‰ç«¯èˆ‡ GAS å¾Œç«¯æ¸…æ™°åˆ†é›¢ï¼Œä¾¿æ–¼ç¨ç«‹é–‹ç™¼å’Œæ¸¬è©¦
- **UUID å®‰å…¨æ€§**ï¼šé¿å…å¯é æ¸¬ ID çš„å®‰å…¨é¢¨éšªï¼Œæå‡ç³»çµ±å®‰å…¨æ€§
- **çµ„åˆå¼ API æ•´åˆ**ï¼šé€é composables å¯¦ç¾ GAS API çš„å„ªé›…æ•´åˆå’Œé‡ç”¨
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šElement Plus åŸç”Ÿæ”¯æ´éŸ¿æ‡‰å¼è¨­è¨ˆå’Œæš—è‰²ä¸»é¡Œ

## å¯¦æ–½å»ºè­°

### å°å…¥éšæ®µè¦åŠƒ

#### ç¬¬ä¸€éšæ®µï¼šåŸºç¤æ¶æ§‹å»ºç«‹ï¼ˆ2-4 é€±ï¼‰
1. **Google Sheets æ¶æ§‹è¨­å®š**ï¼šå»ºç«‹å…¨åŸŸæ´»é ç°¿å’Œå·¥ä½œè¡¨çµæ§‹è¨­è¨ˆ
2. **GAS å¾Œç«¯é–‹ç™¼**ï¼šå»ºç«‹ database.js å’Œæ ¸å¿ƒæ¥­å‹™å‡½æ•¸
3. **Vue 3 å‰ç«¯ç’°å¢ƒ**ï¼šè¨­å®š Vue 3 + Element Plus + Vite é–‹ç™¼ç’°å¢ƒ
4. **å‰å¾Œç«¯æ•´åˆ**ï¼šå¯¦ä½œ GAS API composables å’ŒåŸºæœ¬è³‡æ–™æµ
5. **ç¾¤çµ„ç®¡ç†åŠŸèƒ½**ï¼šå¯¦ä½œç¾¤çµ„å»ºç«‹ã€æˆå“¡ç®¡ç†ã€æ¬Šé™åˆ†é…
6. **åŸºç¤æ¸¬è©¦**ï¼šæ ¸å¿ƒåŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦

#### ç¬¬äºŒéšæ®µï¼šå¤–æ›åŠŸèƒ½é–‹ç™¼ï¼ˆ3-4 é€±ï¼‰
1. **è©•åˆ†ç³»çµ±**ï¼šå¯¦ä½œäº’è©•æ©Ÿåˆ¶å’Œæ’åè¨ˆç®—
2. **éŒ¢åŒ…ç³»çµ±**ï¼šå¯¦ä½œè™›æ“¬é»æ•¸å’Œçå‹µåˆ†é…
3. **é…ç½®ç®¡ç†**ï¼šå¯¦ä½œå¤–æ›åŠŸèƒ½çš„å•Ÿç”¨/åœç”¨æ©Ÿåˆ¶
4. **æ•´åˆæ¸¬è©¦**ï¼šå®Œæ•´æ¥­å‹™æµç¨‹çš„ç«¯åˆ°ç«¯æ¸¬è©¦

#### ç¬¬ä¸‰éšæ®µï¼šæ•ˆèƒ½å„ªåŒ–èˆ‡å‰ç«¯å®Œå–„ï¼ˆ2-3 é€±ï¼‰  
1. **Google Sheets å„ªåŒ–**ï¼šå¯¦ä½œæ™ºèƒ½å¿«å–å’Œæ‰¹æ¬¡æ“ä½œæ©Ÿåˆ¶
2. **å‰ç«¯çµ„ä»¶å®Œå–„**ï¼šé–‹ç™¼å®Œæ•´çš„ Vue 3 çµ„ä»¶åº«å’Œé é¢
3. **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šå¯¦ä½œ Element Plus éŸ¿æ‡‰å¼ä½ˆå±€å’Œæš—è‰²ä¸»é¡Œ
4. **æ•ˆèƒ½æ¸¬è©¦**ï¼šå£“åŠ›æ¸¬è©¦å’Œ Google Sheets è®€å¯«æ•ˆèƒ½åŸºæº–æ¸¬è©¦
5. **ç”¨æˆ¶é«”é©—å„ªåŒ–**ï¼šåŠ å…¥è¼‰å…¥å‹•ç•«ã€éŒ¯èª¤è™•ç†ã€é€šçŸ¥ç³»çµ±
6. **é›™éšæ®µé©—è­‰ç³»çµ±**ï¼šEmailé©—è­‰ç¢¼ã€å€’æ•¸è¨ˆæ™‚å™¨ã€è‡ªå‹•é‡ç™¼æ©Ÿåˆ¶
7. **äº‹ä»¶é©…å‹•æ¶æ§‹**ï¼šlogin state managementã€CustomEventé€šä¿¡
8. **å…±è­˜è­¦å‘Šç³»çµ±**ï¼šdeadline countdownã€consensus alertsã€å³æ™‚ç‹€æ…‹æ›´æ–°

#### ç¬¬å››éšæ®µï¼šè©¦è¡Œé©—è­‰ï¼ˆ4-6 é€±ï¼‰
1. **å°è¦æ¨¡è©¦è¡Œ**ï¼šåœ¨å°å‹å°ˆæ¡ˆä¸­è©¦è¡Œç³»çµ±
2. **ä½¿ç”¨è€…åŸ¹è¨“**ï¼šè¨“ç·´ç®¡ç†å“¡å’Œä½¿ç”¨è€…æ“ä½œç³»çµ±
3. **å›é¥‹æ”¶é›†**ï¼šæ”¶é›†ä½¿ç”¨è€…é«”é©—å’Œæ”¹é€²å»ºè­°
4. **ç³»çµ±èª¿å„ª**ï¼šæ ¹æ“šè©¦è¡Œçµæœèª¿æ•´åƒæ•¸å’Œé‚è¼¯

### æˆåŠŸé—œéµè¦ç´ 

#### æŠ€è¡“å±¤é¢
1. **æ•ˆèƒ½ç›£æ§**ï¼šæŒçºŒç›£æ§ç³»çµ±æ•ˆèƒ½ï¼Œç‰¹åˆ¥æ˜¯è·¨åˆ†ç‰‡æ“ä½œ
2. **éŒ¯èª¤è™•ç†**ï¼šå®Œå–„çš„éŒ¯èª¤è¿½è¹¤å’Œè™•ç†æ©Ÿåˆ¶
3. **è³‡æ–™å‚™ä»½**ï¼šå®šæœŸå‚™ä»½é‡è¦è³‡æ–™ï¼Œå»ºç«‹ç½é›£æ¢å¾©è¨ˆç•«
4. **ç‰ˆæœ¬ç®¡ç†**ï¼šè‰¯å¥½çš„ç¨‹å¼ç¢¼ç‰ˆæœ¬æ§åˆ¶å’Œç™¼å¸ƒæµç¨‹

#### ç®¡ç†å±¤é¢
1. **æ¸…æ¥šçš„è¦å‰‡èªªæ˜**ï¼šç¢ºä¿æ‰€æœ‰åƒèˆ‡è€…ç†è§£ç³»çµ±æ©Ÿåˆ¶å’Œè¦å‰‡
2. **é©ç•¶çš„åƒæ•¸èª¿æ•´**ï¼šæ ¹æ“šå°ˆæ¡ˆç‰¹æ€§å’Œä½¿ç”¨è€…å›é¥‹èª¿æ•´ç³»çµ±åƒæ•¸
3. **ç©æ¥µçš„å¼•å°ç®¡ç†**ï¼šåˆæœŸéœ€è¦ç¸½ PM ç©æ¥µå¼•å°å’Œå”åŠ©ä½¿ç”¨è€…
4. **å®šæœŸæª¢è¨å„ªåŒ–**ï¼šæ ¹æ“šä½¿ç”¨ç¶“é©—æŒçºŒå„ªåŒ–æµç¨‹å’Œåƒæ•¸è¨­å®š

#### ä½¿ç”¨è€…å±¤é¢
1. **å……åˆ†çš„åŸ¹è¨“**ï¼šæä¾›å®Œæ•´çš„ç³»çµ±æ“ä½œåŸ¹è¨“å’Œæ–‡ä»¶
2. **åŠæ™‚çš„æ”¯æ´**ï¼šå»ºç«‹ä½¿ç”¨è€…æ”¯æ´æ©Ÿåˆ¶å’Œå•é¡Œå›å ±ç®¡é“
3. **æ¿€å‹µæ©Ÿåˆ¶è¨­è¨ˆ**ï¼šè¨­è¨ˆé©ç•¶çš„æ¿€å‹µæ©Ÿåˆ¶æé«˜åƒèˆ‡åº¦
4. **å›é¥‹æ©Ÿåˆ¶å»ºç«‹**ï¼šå»ºç«‹æŒçºŒçš„ä½¿ç”¨è€…å›é¥‹å’Œæ”¹é€²æ©Ÿåˆ¶

## é¢¨éšªè©•ä¼°èˆ‡æ‡‰å°

### æŠ€è¡“é¢¨éšª

#### æ•ˆèƒ½é¢¨éšª
- **é¢¨éšª**ï¼šå¤§é‡ä½¿ç”¨è€…åŒæ™‚å­˜å–å°è‡´ç³»çµ±ç·©æ…¢
- **æ‡‰å°**ï¼šå¯¦ä½œåˆ†ç‰‡ç­–ç•¥å’Œå¿«å–æ©Ÿåˆ¶å„ªåŒ–
- **ç›£æ§**ï¼šè¨­å®šæ•ˆèƒ½ç›£æ§æŒ‡æ¨™å’Œè­¦å‘Šæ©Ÿåˆ¶

#### è³‡æ–™é¢¨éšª
- **é¢¨éšª**ï¼šGoogle Sheets è³‡æ–™æå£æˆ–éºå¤±
- **æ‡‰å°**ï¼šå®šæœŸè‡ªå‹•å‚™ä»½å’Œç‰ˆæœ¬æ§åˆ¶æ©Ÿåˆ¶
- **æ¢å¾©**ï¼šå»ºç«‹è³‡æ–™æ¢å¾©æµç¨‹å’Œç½é›£æ‡‰è®Šè¨ˆç•«

#### ç›¸å®¹æ€§é¢¨éšª
- **é¢¨éšª**ï¼šGoogle Apps Script å¹³å°ç•°å‹•å½±éŸ¿ç³»çµ±é‹ä½œ
- **æ‡‰å°**ï¼šé—œæ³¨å¹³å°æ›´æ–°è³‡è¨Šï¼ŒåŠæ™‚èª¿æ•´ç¨‹å¼ç¢¼
- **å‚™æ¡ˆ**ï¼šæº–å‚™æ›¿ä»£æŠ€è¡“æ–¹æ¡ˆå’Œé·ç§»è¨ˆç•«

### æ¥­å‹™é¢¨éšª

#### ä½¿ç”¨è€…æ¥å—åº¦é¢¨éšª
- **é¢¨éšª**ï¼šä½¿ç”¨è€…ä¸ç†Ÿæ‚‰æˆ–æŠ—æ‹’æ–°ç³»çµ±
- **æ‡‰å°**ï¼šå……åˆ†çš„åŸ¹è¨“å’Œé€æ­¥å°å…¥ç­–ç•¥
- **æ”¯æ´**ï¼šæä¾›å……è¶³çš„ä½¿ç”¨è€…æ”¯æ´å’Œæ–‡ä»¶

#### åƒèˆ‡åº¦é¢¨éšª
- **é¢¨éšª**ï¼šè©•åˆ†åƒèˆ‡åº¦ä¸è¶³å½±éŸ¿ç³»çµ±é‹ä½œ
- **æ‡‰å°**ï¼šè¨­è¨ˆé©ç•¶çš„æ¿€å‹µæ©Ÿåˆ¶å’Œåƒèˆ‡é–€æª»
- **å‚™æ¡ˆ**ï¼šç¸½ PM ä»‹å…¥æ©Ÿåˆ¶å’Œæ›¿ä»£è©•åˆ†æ–¹æ¡ˆ

#### å…¬å¹³æ€§çˆ­è­°é¢¨éšª
- **é¢¨éšª**ï¼šè©•åˆ†çµæœæˆ–çå‹µåˆ†é…å¼•èµ·çˆ­è­°
- **æ‡‰å°**ï¼šé€æ˜çš„è¦å‰‡èªªæ˜å’Œç”³è¨´æ©Ÿåˆ¶
- **ä»²è£**ï¼šç¸½ PM æœ€çµ‚æ±ºå®šæ¬Šå’Œäººå·¥ä»²è£æµç¨‹

### å®‰å…¨é¢¨éšª

#### è³‡æ–™å®‰å…¨é¢¨éšª
- **é¢¨éšª**ï¼šæ•æ„Ÿè³‡æ–™æ´©éœ²æˆ–æœªæˆæ¬Šå­˜å–
- **æ‡‰å°**ï¼šåš´æ ¼çš„æ¬Šé™æ§åˆ¶å’Œå­˜å–ç´€éŒ„
- **ç›£æ§**ï¼šç•°å¸¸å­˜å–è¡Œç‚ºç›£æ§å’Œè­¦å‘Š

#### ç³»çµ±å®‰å…¨é¢¨éšª
- **é¢¨éšª**ï¼šæƒ¡æ„æ”»æ“Šæˆ–æ¿«ç”¨ç³»çµ±åŠŸèƒ½
- **æ‡‰å°**ï¼šè¼¸å…¥é©—è­‰å’Œæ“ä½œæ—¥èªŒè¿½è¹¤
- **é˜²è­·**ï¼šå¯¦ä½œé©ç•¶çš„å®‰å…¨æª¢æŸ¥æ©Ÿåˆ¶

### é¢¨éšªç·©è§£ç­–ç•¥

#### é é˜²æªæ–½
1. **å……åˆ†æ¸¬è©¦**ï¼šå…¨é¢çš„åŠŸèƒ½æ¸¬è©¦å’Œå£“åŠ›æ¸¬è©¦
2. **é€æ­¥å°å…¥**ï¼šåˆ†éšæ®µå°å…¥é™ä½é¢¨éšªå½±éŸ¿
3. **å‚™æ¡ˆæº–å‚™**ï¼šæº–å‚™å„ç¨®æƒ…æ³çš„æ‡‰è®Šæ–¹æ¡ˆ
4. **æŒçºŒç›£æ§**ï¼šå»ºç«‹ç³»çµ±ç›£æ§å’Œæ—©æœŸè­¦å‘Šæ©Ÿåˆ¶

#### æ‡‰è®Šæªæ–½
1. **å¿«é€Ÿå›æ‡‰**ï¼šå»ºç«‹å•é¡Œå›å ±å’Œå¿«é€Ÿä¿®å¾©æ©Ÿåˆ¶
2. **ç·Šæ€¥å›æ»¾**ï¼šæº–å‚™ç³»çµ±å›æ»¾åˆ°ç©©å®šç‰ˆæœ¬çš„èƒ½åŠ›
3. **äººå·¥ä»‹å…¥**ï¼šç¸½ PM äººå·¥ä»‹å…¥è™•ç†ç•°å¸¸ç‹€æ³
4. **æºé€šæ©Ÿåˆ¶**ï¼šå»ºç«‹èˆ‡ä½¿ç”¨è€…çš„æœ‰æ•ˆæºé€šç®¡é“

## å·²çŸ¥æŠ€è¡“è­°é¡Œ

### Issue: Markdown ç·¨è¼¯å™¨æ•´åˆ
**ç‹€æ…‹ï¼š** å·²æ±ºå®š

**æè¿°ï¼š** ç³»çµ±å°‡ä½¿ç”¨å–®ä¸€ Markdown ç·¨è¼¯å™¨ä½œç‚ºä¸»è¦å…§å®¹è¼¸å…¥æ–¹å¼ã€‚

**å¯¦ä½œæ–¹æ¡ˆï¼š**
1. æ•´åˆ Markdown ç·¨è¼¯å™¨å…ƒä»¶ï¼ˆå¦‚ SimpleMDE æˆ– EasyMDEï¼‰
2. æ”¯æ´å³æ™‚é è¦½åŠŸèƒ½
3. æä¾› Markdown èªæ³•æç¤ºå’Œå·¥å…·åˆ—
4. è‡ªå‹•å„²å­˜è‰ç¨¿åŠŸèƒ½

**å½±éŸ¿ï¼š** ç°¡åŒ–ä½¿ç”¨è€…ä»‹é¢ï¼Œæä¾›çµ±ä¸€çš„å…§å®¹ç·¨è¼¯é«”é©—ã€‚

**å„ªå…ˆç´šï¼š** é«˜ï¼ˆæ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼‰

### Issue: å¤§é‡è³‡æ–™æ•ˆèƒ½æ¸¬è©¦
**ç‹€æ…‹ï¼š** éœ€è¦é©—è­‰

**æè¿°ï¼š** éœ€è¦æ¸¬è©¦åˆ†ç‰‡ç³»çµ±åœ¨å¤§é‡è³‡æ–™æƒ…æ³ä¸‹çš„æ•ˆèƒ½è¡¨ç¾ã€‚

**æ¸¬è©¦é …ç›®ï¼š**
1. 100+ ä½¿ç”¨è€…åŒæ™‚å­˜å–çš„æ•ˆèƒ½æ¸¬è©¦
2. 1000+ æäº¤è¨˜éŒ„çš„æŸ¥è©¢æ•ˆèƒ½æ¸¬è©¦
3. æ‰¹æ¬¡æ“ä½œåœ¨å¤§è³‡æ–™é‡ä¸‹çš„æ•ˆèƒ½é©—è­‰
4. è·¨åˆ†ç‰‡æ“ä½œçš„å»¶é²æ¸¬è©¦

**å½±éŸ¿ï¼š** ç¢ºå®šç³»çµ±çš„æ“´å±•ä¸Šé™å’Œæœ€ä½³åŒ–ç­–ç•¥ã€‚

**å„ªå…ˆç´šï¼š** é«˜ï¼ˆå½±éŸ¿ç³»çµ±å¯æ“´å±•æ€§ï¼‰

## çµèª

æœ¬ç³»çµ±çµåˆäº†ç¾ä»£å°ˆæ¡ˆç®¡ç†ç†å¿µèˆ‡æ•™è‚²è©•ä¼°éœ€æ±‚ï¼Œé€éç²¾å¿ƒè¨­è¨ˆçš„å‡½æ•¸å¼æ¶æ§‹å’Œ Google Sheets å¤šåˆ†ç‰‡æ•´åˆç­–ç•¥ï¼Œå‰µé€ äº†ä¸€å€‹é«˜æ•ˆã€é€æ˜ã€å…¬å¹³çš„å°ˆæ¡ˆç®¡ç†èˆ‡å­¸ç¿’ç’°å¢ƒã€‚ç¾¤çµ„å¼æ¬Šé™ç®¡ç†å’Œé…ç½®é©…å‹•çš„å¤–æ›è¨­è¨ˆç¢ºä¿äº†ç³»çµ±çš„éˆæ´»æ€§å’Œå¯æ“´å±•æ€§ï¼Œèƒ½å¤ é©æ‡‰ä¸åŒè¦æ¨¡å’Œé¡å‹çš„å°ˆæ¡ˆéœ€æ±‚ã€‚

ç³»çµ±çš„ç¨ç‰¹ä¹‹è™•åœ¨æ–¼å°‡éšæ®µåŒ–å°ˆæ¡ˆç®¡ç†ã€åŒå„•äº’è©•ã€è™›æ“¬ç¶“æ¿Ÿç³»çµ±å’Œå®Œæ•´çš„æ¬Šé™æ§åˆ¶æœ‰æ©Ÿçµåˆï¼Œå½¢æˆäº†ä¸€å€‹æ—¢èƒ½ä¿ƒé€²å­¸ç¿’åˆèƒ½ç¢ºä¿å…¬å¹³çš„ç¶œåˆå¹³å°ã€‚é€é Google Sheets å¤šåˆ†ç‰‡æ¶æ§‹å’Œ**å”¯è®€æ–°å¢è¨­è¨ˆ**ï¼Œç³»çµ±åœ¨ Google Apps Script ç’°å¢ƒä¸‹å¯¦ç¾äº†å“è¶Šçš„æ•ˆèƒ½è¡¨ç¾ï¼ŒåŒæ™‚ä¿æŒäº†æ•™è‚²ç’°å¢ƒæ‰€éœ€çš„é›¶ç¶­è­·æˆæœ¬å„ªå‹¢ã€‚

**å”¯è®€æ–°å¢è¨­è¨ˆçš„æ ¸å¿ƒå„ªå‹¢**ï¼šç³»çµ±å¾æ¥­å‹™é‚è¼¯å±¤é¢å°±é¿å…äº†è³‡æ–™ä¿®æ”¹éœ€æ±‚ï¼Œå®Œå…¨ç™¼æ® Google Sheets åœ¨è®€å–å’Œæ–°å¢æ“ä½œä¸Šçš„æ•ˆèƒ½å„ªå‹¢ï¼ŒåŒæ™‚å¤©ç„¶å½¢æˆå®Œæ•´çš„å¯©è¨ˆè»Œè·¡ã€‚é€™ç¨®è¨­è¨ˆä¸åƒ…é¿å…äº† Google Sheets ä¿®æ”¹æ“ä½œçš„æ•ˆèƒ½ç“¶é ¸ï¼Œæ›´ç¢ºä¿äº†è³‡æ–™çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚

å‡½æ•¸å¼æ¶æ§‹è¨­è¨ˆä¸åƒ…é©åˆ GAS çš„åŸ·è¡Œç’°å¢ƒç‰¹æ€§ï¼Œæ›´é¿å…äº†éåº¦å·¥ç¨‹åŒ–çš„å•é¡Œï¼Œè®“ç³»çµ±æ˜“æ–¼ç†è§£ã€ç¶­è­·å’Œæ“´å±•ã€‚UUID è­˜åˆ¥ç³»çµ±ç¢ºä¿äº†è³‡æ–™çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ï¼Œè€Œç¾¤çµ„å¼æ¬Šé™ç®¡ç†è®“ç³»çµ±ç®¡ç†æ›´åŠ ç›´è§€å’Œå½ˆæ€§ã€‚é€é Google Sheets çš„å¼·å¤§ç¯©é¸åŠŸèƒ½å’Œå®Œæ•´çš„æ“ä½œè¿½è¹¤å¯©è¨ˆï¼Œç³»çµ±é‚„æä¾›äº†å‡ºè‰²çš„å•é¡Œè¨ºæ–·å’Œè¡Œç‚ºåˆ†æèƒ½åŠ›ï¼Œæœ‰åŠ©æ–¼æŒçºŒå„ªåŒ–å’Œæ”¹é€²ã€‚

é€™å€‹å°ˆæ¡ˆç®¡ç†ç³»çµ±å°‡ç‚ºæ•™è‚²ç’°å¢ƒæä¾›ä¸€å€‹å¼·å¤§è€Œæ˜“ç”¨çš„å·¥å…·ï¼Œä¿ƒé€²å­¸ç”Ÿå­¸ç¿’æˆæ•ˆçš„åŒæ™‚ï¼Œä¹Ÿç‚ºæ•™è‚²å·¥ä½œè€…æä¾›äº†é«˜æ•ˆçš„ç®¡ç†å¹³å°ã€‚**å”¯è®€æ–°å¢è¨­è¨ˆèˆ‡ Google Sheets å¤šåˆ†ç‰‡æ¶æ§‹**çš„å®Œç¾çµåˆï¼Œä¸åƒ…è§£æ±ºäº†è³‡æ–™ç®¡ç†çš„æŠ€è¡“æŒ‘æˆ°ï¼Œæ›´å¯¦ç¾äº†å®Œå…¨é›¶æˆæœ¬çš„é‹ç‡Ÿæ¨¡å¼ï¼Œç‚ºç³»çµ±çš„é•·æœŸç™¼å±•å’Œæ“´å±•å¥ å®šäº†å …å¯¦åŸºç¤ã€‚

---

## æœ€æ–°ç³»çµ±æ›´æ–° (2025å¹´ç‰ˆæœ¬)

### æ ¸å¿ƒæ©Ÿåˆ¶æ›´æ–°

#### 1. å…±è­˜æ©Ÿåˆ¶é‡æ–°è¨­è¨ˆ (ç§»é™¤è‡ªå‹•æ‰¹å‡†)
**èƒŒæ™¯**: åŸç³»çµ±å­˜åœ¨è‡ªå‹•æ‰¹å‡†æ©Ÿåˆ¶ï¼Œèˆ‡è¨­è¨ˆåˆè¡·ä¸ç¬¦
**æ–°è¨­è¨ˆ**:
- **å®Œå…¨ç§»é™¤è‡ªå‹•æ‰¹å‡†**: ç³»çµ±ä¸å†è‡ªå‹•æ‰¹å‡†ä»»ä½•æäº¤
- **æˆªæ­¢æ™‚å…±è­˜æª¢æŸ¥**: ç³»çµ±åªåœ¨éšæ®µæˆªæ­¢æ™‚æª¢æŸ¥å…±è­˜ç‹€æ…‹  
- **å…¨å“¡åŒæ„åˆ¶**: çµ„å…§å¿…é ˆå…¨å“¡åŒæ„æ‰èƒ½ç²å¾—é»æ•¸
- **æ²’æ”¶æ©Ÿåˆ¶**: ç„¡å…±è­˜å‰‡æ²’æ”¶å…¨éƒ¨éšæ®µé»æ•¸

#### 2. ç‰ˆæœ¬è¿½è¹¤ç³»çµ±
**å¯¦ä½œ**: æ¯æ¬¡æäº¤è‡ªå‹•ç”¢ç”Ÿç‰ˆæœ¬è™Ÿ (v1, v2, v3...)
**å¥½è™•**: å®Œæ•´çš„æäº¤æ­·å²è¿½è¹¤ï¼Œæ”¯æ´å›æº¯åˆ†æ
**æ•´åˆ**: èˆ‡æ’¤å›æ©Ÿåˆ¶ç„¡ç¸«æ•´åˆ

#### 3. æ’¤å›æ©Ÿåˆ¶ (å–ä»£åˆªé™¤)
**è¨­è¨ˆåŸå‰‡**: æ¨™è¨˜ç‹€æ…‹è€Œéåˆªé™¤è¨˜éŒ„
**å¯¦ä½œæ–¹å¼**: 
- è¨­å®š status: 'withdrawn'
- è¨˜éŒ„ withdrawnTime å’Œ withdrawnBy
- ä¿ç•™å®Œæ•´å¯©è¨ˆè»Œè·¡

#### 4. ç°¡åŒ–æŠ•ç¥¨æ©Ÿåˆ¶
**åŸç³»çµ±**: è¤‡é›œçš„æ’åææ¡ˆç³»çµ±
**æ–°ç³»çµ±**: ç°¡åŒ–ç‚ºåƒèˆ‡åº¦ç¢ºèªæŠ•ç¥¨
- åªæœ‰åŒæ„/ä¸åŒæ„äºŒå…ƒé¸æ“‡
- é‡å°æ•´å€‹åƒèˆ‡åº¦ææ¡ˆæŠ•ç¥¨
- ç§»é™¤è¤‡é›œçš„æ’åæŠ•ç¥¨æµç¨‹

### å‰ç«¯ UI/UX é‡å¤§æ›´æ–°

#### 1. é›™éšæ®µé©—è­‰ç³»çµ±
**åŠŸèƒ½**:
- Email + å¯†ç¢¼é©—è­‰
- å­—æ¯å‹é©—è­‰ç¢¼ (é˜²æ­¢Google Sheetsèª¤è®€æ•¸å­—)
- 10åˆ†é˜å€’æ•¸è¨ˆæ™‚å™¨
- el-progress é€²åº¦æ¢é¡¯ç¤ºå‰©é¤˜æ™‚é–“

**æŠ€è¡“å¯¦ä½œ**:
```javascript
// å€’æ•¸è¨ˆæ™‚å™¨ç¯„ä¾‹
verificationTimer = setInterval(() => {
  this.verificationRemainingTime = Math.ceil(remainingMs / 1000)
}, 1000)
```

#### 2. äº‹ä»¶é©…å‹•ç™»å…¥ç‹€æ…‹ç®¡ç†
**æ¶æ§‹**: ä½¿ç”¨ CustomEvent é€²è¡Œç‹€æ…‹åŒæ­¥
**å„ªå‹¢**: é¿å…é é¢é‡æ–°è¼‰å…¥ï¼Œæä¾›ç„¡ç¸«ç”¨æˆ¶é«”é©—
**å¯¦ä½œ**:
```javascript
// ç™¼é€ç™»å…¥æˆåŠŸäº‹ä»¶
window.dispatchEvent(new CustomEvent('auth-state-changed', {
  detail: { type: 'login-success', user, sessionId }
}))

// App.vue è‡ªå‹•éŸ¿æ‡‰ä¸¦é‡æ–°è¼‰å…¥æ•¸æ“š
async refreshCurrentPageData() { ... }
```

#### 3. å…±è­˜è­¦å‘Šç³»çµ±
**çµ„ä»¶**: el-alert è­¦å‘Šæç¤ºæ¡†
**åŠŸèƒ½**:
- å³æ™‚é¡¯ç¤ºå…±è­˜ç‹€æ…‹
- å€’æ•¸è¨ˆæ™‚å™¨é¡¯ç¤ºæˆªæ­¢æ™‚é–“
- è¦–è¦ºåŒ–æŠ•ç¥¨é€²åº¦ (ä¾‹: 2/5äººå·²æŠ•ç¥¨)
- å¼•å°ç”¨æˆ¶é‡æ–°ææ¡ˆæˆ–æŠ•ç¥¨

**è¨Šæ¯ç¯„ä¾‹**: "è²´çµ„å°šæœªå–å¾—é»æ•¸åˆ†é…å…±è­˜ï¼Œæˆªæ­¢å‰ç„¡å…±è­˜ï¼Œå°‡æ²’æ”¶å…¨éƒ¨é»æ•¸"

#### 4. è¨ˆæ™‚å™¨ç®¡ç†ç³»çµ±
**å•é¡Œ**: é˜²æ­¢è¨˜æ†¶é«”æ´©æ¼
**è§£æ±ºæ–¹æ¡ˆ**: 
- çµ±ä¸€è¨ˆæ™‚å™¨ç”Ÿå‘½é€±æœŸç®¡ç†
- beforeUnmount è‡ªå‹•æ¸…ç†
- å…§å»º clearTimer æ–¹æ³•

### æŠ€è¡“æ¶æ§‹æ”¹é€²

#### 1. Vue 3 ç¾ä»£åŒ–æ¶æ§‹
**Composition API**: å…¨é¢æ¡ç”¨æœ€æ–° Vue 3 æ¨¡å¼
**Element Plus**: æ¨™æº–åŒ– el-drawer å½ˆçª—è¨­è¨ˆ
**D3.js**: ç”¨æ–¼æŠ•ç¥¨çµæœè¦–è¦ºåŒ–åœ–è¡¨

#### 2. Google Sheets æœ€ä½³åŒ–
**å¤šåˆ†ç‰‡è¨­è¨ˆ**: é¿å…å–®ä¸€æª”æ¡ˆé™åˆ¶
**ç‰ˆæœ¬è¿½è¹¤**: æ”¯æ´å®Œæ•´æ­·å²è¨˜éŒ„
**å”¯è®€æ–°å¢**: æœ€å¤§åŒ– I/O æ•ˆèƒ½

### æ¥­å‹™æµç¨‹æ›´æ–°

#### èˆŠæµç¨‹ vs æ–°æµç¨‹å°æ¯”

| é …ç›® | èˆŠæµç¨‹ | æ–°æµç¨‹ |
|------|--------|--------|
| æäº¤æ‰¹å‡† | è‡ªå‹•æ‰¹å‡† | æˆªæ­¢æ™‚æª¢æŸ¥å…±è­˜ |
| ç‰ˆæœ¬ç®¡ç† | è¦†è“‹æ›´æ–° | ç‰ˆæœ¬è™Ÿè¿½è¹¤ (v1,v2,v3...) |
| æŠ•ç¥¨æ–¹å¼ | è¤‡é›œæ’å | ç°¡åŒ–åŒæ„/ä¸åŒæ„ |
| åˆªé™¤æ©Ÿåˆ¶ | çœŸå¯¦åˆªé™¤ | æ¨™è¨˜æ’¤å› |
| ç™»å…¥é«”é©— | å–®æ­¥é©—è­‰ | é›™éšæ®µé©—è­‰ + å€’æ•¸è¨ˆæ™‚ |
| ç‹€æ…‹åŒæ­¥ | é é¢é‡è¼‰ | äº‹ä»¶é©…å‹•ç„¡ç¸«æ›´æ–° |

### å¯¦ä½œç‹€æ…‹

#### å·²å®ŒæˆåŠŸèƒ½ âœ…
- [x] ç§»é™¤è‡ªå‹•æ‰¹å‡†æ©Ÿåˆ¶
- [x] å¯¦ä½œç‰ˆæœ¬è¿½è¹¤ç³»çµ±  
- [x] å‰ç«¯å ±å‘Šå€å¡Šé¡¯ç¤ºæäº¤æ™‚é–“
- [x] ä¿®æ­£æŠ•ç¥¨æ©Ÿåˆ¶ç‚ºåƒèˆ‡åº¦ç¢ºèª
- [x] é›™éšæ®µé©—è­‰ç³»çµ±
- [x] äº‹ä»¶é©…å‹•ç™»å…¥ç‹€æ…‹ç®¡ç†
- [x] å…±è­˜è­¦å‘Šç³»çµ±
- [x] è¨ˆæ™‚å™¨è¨˜æ†¶é«”ç®¡ç†

#### å¾…å¯¦ä½œåŠŸèƒ½ ğŸ“‹
- [ ] consensusDeadline æœ€çµ‚åŒ–é‚è¼¯çš„å®Œæ•´å¯¦ä½œ
- [ ] å¤§è¦æ¨¡æ¸¬è©¦å’Œæ•ˆèƒ½å„ªåŒ–
- [ ] å¤šèªè¨€æ”¯æ´
- [ ] ç§»å‹•ç«¯éŸ¿æ‡‰å¼å„ªåŒ–

### ç³»çµ±ç©©å®šæ€§æå‡

**è¨˜æ†¶é«”ç®¡ç†**: ä¿®å¾©æ‰€æœ‰è¨ˆæ™‚å™¨æ´©æ¼å•é¡Œ
**äº‹ä»¶è™•ç†**: ç§»é™¤é‡è¤‡äº‹ä»¶ç¶å®šå•é¡Œ  
**è³‡æ–™ä¸€è‡´æ€§**: ç‰ˆæœ¬è¿½è¹¤ç¢ºä¿è³‡æ–™å®Œæ•´æ€§
**ç”¨æˆ¶é«”é©—**: ç„¡éœ€é é¢é‡è¼‰çš„ç‹€æ…‹ç®¡ç†

### æœªä¾†ç™¼å±•æ–¹å‘

1. **AI è¼”åŠ©è©•åˆ†**: æ•´åˆ AI å”åŠ©è©•è«–å“è³ªè©•ä¼°
2. **é€²éšåˆ†æ**: æä¾›æ›´æ·±å…¥çš„å°ˆæ¡ˆåˆ†æå ±å‘Š
3. **è¡Œå‹•ç«¯APP**: é–‹ç™¼å°ˆç”¨ç§»å‹•æ‡‰ç”¨ç¨‹å¼
4. **å³æ™‚å”ä½œ**: å¯¦ä½œå³æ™‚ç·¨è¼¯å’Œè¨è«–åŠŸèƒ½

---

**æ›´æ–°æ—¥æœŸ**: 2025å¹´ç‰ˆæœ¬  
**ä¸»è¦è²¢ç»è€…**: Claude Code AI Assistant  
**æŠ€è¡“æ£§**: Vue 3 + Element Plus + Google Apps Script + Google Sheets