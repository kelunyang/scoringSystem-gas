<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¡ç”¢å¤©æ¢¯åœ–</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f5f5f5;
            margin: 0;
            box-sizing: border-box;
            width: 100%;
        }
        
        * {
            box-sizing: border-box;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: clamp(20px, 5vw, 32px);
            text-align: center;
        }
        
        #generateBtn {
            padding: 12px 30px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        
        #generateBtn:hover {
            background-color: #45a049;
        }
        
        #generateBtn:active {
            transform: scale(0.98);
        }
        
        #chart {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            width: 100%;
            max-width: 1200px;
            overflow: visible;
        }
        
        #chart svg {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .axis-label {
            font-size: 14px;
            fill: #666;
        }
        
        .tick text {
            font-size: 12px;
        }
        
        .ladder-line {
            stroke: #2196F3;
            stroke-width: 3;
            fill: none;
        }
        
        .connector-line {
            stroke: #90CAF9;
            stroke-width: 2;
        }
        
        .person-circle {
            fill: #FF9800;
            stroke: white;
            stroke-width: 2;
        }
        
        .person-label {
            font-size: 13px;
            fill: #333;
        }
        
        .wealth-label {
            font-size: 11px;
            fill: #666;
        }
        
        .extreme-marker {
            fill: #F44336;
            stroke: white;
            stroke-width: 2;
        }
        
        .extreme-label {
            font-size: 12px;
            fill: #F44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ’° è²¡ç”¢å¤©æ¢¯åœ–</h1>
    <button id="generateBtn">ğŸ² ç”Ÿæˆéš¨æ©Ÿæ•¸æ“š</button>
    <div id="chart"></div>

    <script>
        // éŸ¿æ‡‰å¼åœ–è¡¨å°ºå¯¸
        let margin = {top: 40, right: 200, bottom: 60, left: 80};
        let width, height;
        
        // æ ¹æ“šè¢å¹•å¤§å°èª¿æ•´ margin
        function updateDimensions() {
            const containerWidth = Math.min(window.innerWidth - 40, 1200);
            
            if (containerWidth < 600) {
                margin = {top: 30, right: 120, bottom: 50, left: 60};
            } else if (containerWidth < 900) {
                margin = {top: 40, right: 150, bottom: 60, left: 70};
            } else {
                margin = {top: 40, right: 200, bottom: 60, left: 80};
            }
            
            width = containerWidth - margin.left - margin.right;
            height = Math.max(400, Math.min(600, window.innerHeight - 200)) - margin.top - margin.bottom;
        }
        
        updateDimensions();

        // å‰µå»º SVG å®¹å™¨
        const svgContainer = d3.select("#chart")
            .append("svg")
            .attr("width", "100%")
            .attr("height", height + margin.top + margin.bottom)
            .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
            .attr("preserveAspectRatio", "xMidYMid meet");
            
        const svg = svgContainer
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // éš¨æ©Ÿåå­—æ± 
        const names = [
            "å°æ˜", "å°è¯", "å°ç¾", "å¤§é›„", "éœé¦™",
            "èƒ–è™", "å°å¤«", "é˜¿å¼·", "é˜¿ç", "å¿—æ˜",
            "æ˜¥å¬Œ", "é˜¿å‰", "å°èŠ³", "å»ºåœ‹", "æ·‘èŠ¬",
            "ä¿Šå‚‘", "é›…å©·", "å®¶è±ª", "æ€¡å›", "å®—ç¿°"
        ];

        // ç”Ÿæˆéš¨æ©Ÿæ•¸æ“š
        function generateRandomData() {
            const numPeople = Math.floor(Math.random() * 6) + 5; // 5-10äºº
            const usedNames = new Set();
            const data = [];

            for (let i = 0; i < numPeople; i++) {
                let name;
                do {
                    name = names[Math.floor(Math.random() * names.length)];
                } while (usedNames.has(name));
                usedNames.add(name);

                // ç”Ÿæˆè²¡ç”¢ï¼ˆä½¿ç”¨å°æ•¸åˆ†å¸ƒä½¿æ•¸æ“šæ›´çœŸå¯¦ï¼‰
                const wealth = Math.floor(Math.exp(Math.random() * 8 + 4)); // ç´„50è¬åˆ°3000è¬
                
                // ç‚ºæ¯å€‹äººç”Ÿæˆå”¯ä¸€çš„é ­åƒç¨®å­
                const avatarSeed = `${name}-${Date.now()}-${i}`;
                
                data.push({ name, wealth, avatarSeed });
            }

            // æŒ‰è²¡ç”¢æ’åº
            data.sort((a, b) => b.wealth - a.wealth);
            return data;
        }

        // æ ¼å¼åŒ–æ•¸å­—
        function formatWealth(value) {
            if (value >= 10000000) {
                return `${(value / 10000000).toFixed(1)}åƒè¬`;
            } else if (value >= 10000) {
                return `${(value / 10000).toFixed(0)}è¬`;
            } else {
                return `${value.toLocaleString()}å…ƒ`;
            }
        }

        // ç¹ªè£½åœ–è¡¨
        function drawChart(data) {
            // ä¿å­˜ç•¶å‰æ•¸æ“šä¾› resize ä½¿ç”¨
            currentData = data;
            
            // æ¸…é™¤èˆŠåœ–è¡¨
            svg.selectAll("*").remove();
            
            // æ·»åŠ  defs å€åŸŸç”¨æ–¼å­˜æ”¾é ­åƒåœ–ç‰‡
            const defs = svg.append("defs");

            const minWealth = d3.min(data, d => d.wealth);
            const maxWealth = d3.max(data, d => d.wealth);

            // å»ºç«‹æ¯”ä¾‹å°ºï¼ˆXè»¸å¾0é–‹å§‹ï¼‰
            const xScale = d3.scaleLinear()
                .domain([0, maxWealth * 1.1])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([minWealth, maxWealth])
                .range([height, 0]);

            // ç¹ªè£½ X è»¸
            const xAxis = d3.axisBottom(xScale)
                .ticks(8)
                .tickFormat(d => formatWealth(d));

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-30)");

            // X è»¸æ¨™ç±¤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("x", width / 2)
                .attr("y", height + 55)
                .text("è²¡ç”¢é‡‘é¡");

            // ç¹ªè£½å·¦å´å¤©æ¢¯ä¸»è»¸ï¼ˆå‚ç›´ç·šï¼Œå¾æœ€å°åˆ°æœ€å¤§ï¼‰
            svg.append("line")
                .attr("class", "ladder-line")
                .attr("x1", 0)
                .attr("y1", yScale(minWealth))
                .attr("x2", 0)
                .attr("y2", yScale(maxWealth))
                .style("stroke-dasharray", "5,5");

            // æ¨™è¨˜æœ€å¯Œå’Œæœ€çª®
            // æœ€å¯Œæ¨™è¨˜
            svg.append("circle")
                .attr("class", "extreme-marker")
                .attr("cx", 0)
                .attr("cy", yScale(maxWealth))
                .attr("r", 8);

            svg.append("text")
                .attr("class", "extreme-label")
                .attr("x", -15)
                .attr("y", yScale(maxWealth) + 5)
                .attr("text-anchor", "end")
                .text("æœ€å¯Œ");

            // æœ€çª®æ¨™è¨˜
            svg.append("circle")
                .attr("class", "extreme-marker")
                .attr("cx", 0)
                .attr("cy", yScale(minWealth))
                .attr("r", 8);

            svg.append("text")
                .attr("class", "extreme-label")
                .attr("x", -15)
                .attr("y", yScale(minWealth) + 5)
                .attr("text-anchor", "end")
                .text("æœ€çª®");

            // ç¹ªè£½æ¯å€‹äººçš„é€£æ¥ç·šå’Œæ¨™è¨˜
            data.forEach((person, i) => {
                const y = yScale(person.wealth);
                const x = xScale(person.wealth);
                const avatarSize = 32;
                
                // ç‚ºæ¯å€‹é ­åƒå‰µå»º pattern
                const patternId = `avatar-${i}`;
                const pattern = defs.append("pattern")
                    .attr("id", patternId)
                    .attr("width", 1)
                    .attr("height", 1)
                    .attr("patternContentUnits", "objectBoundingBox");
                
                // DiceBear API URL (ä½¿ç”¨ adventurer é¢¨æ ¼)
                const avatarUrl = `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(person.avatarSeed)}`;
                
                pattern.append("image")
                    .attr("href", avatarUrl)
                    .attr("width", 1)
                    .attr("height", 1)
                    .attr("preserveAspectRatio", "xMidYMid slice");

                // æ©«å‘é€£æ¥ç·šï¼ˆå¾è²¡ç”¢æœ€å°çš„äººé–‹å§‹ï¼Œå³å¾æœ€å°å€¼çš„ä½ç½®é–‹å§‹ï¼‰
                svg.append("line")
                    .attr("class", "connector-line")
                    .attr("x1", 0)
                    .attr("y1", y)
                    .attr("x2", x)
                    .attr("y2", y)
                    .style("opacity", 0)
                    .transition()
                    .duration(500)
                    .delay(i * 50)
                    .style("opacity", 1);

                // äººçš„é ­åƒæ¨™è¨˜ï¼ˆä½¿ç”¨åœ“å½¢è£åˆ‡ï¼‰
                const avatarGroup = svg.append("g")
                    .attr("transform", `translate(${x},${y})`);
                
                // èƒŒæ™¯åœ“ï¼ˆç™½è‰²é‚Šæ¡†æ•ˆæœï¼‰
                avatarGroup.append("circle")
                    .attr("r", avatarSize / 2 + 2)
                    .attr("fill", "white")
                    .attr("opacity", 0)
                    .transition()
                    .duration(300)
                    .delay(i * 50 + 200)
                    .attr("opacity", 1);
                
                // é ­åƒåœ“
                avatarGroup.append("circle")
                    .attr("r", 0)
                    .attr("fill", `url(#${patternId})`)
                    .attr("stroke", "white")
                    .attr("stroke-width", 2)
                    .style("cursor", "pointer")
                    .transition()
                    .duration(300)
                    .delay(i * 50 + 200)
                    .attr("r", avatarSize / 2);

                // å§“åæ¨™ç±¤
                svg.append("text")
                    .attr("class", "person-label")
                    .attr("x", x + avatarSize / 2 + 8)
                    .attr("y", y + 4)
                    .style("opacity", 0)
                    .text(person.name)
                    .transition()
                    .duration(300)
                    .delay(i * 50 + 300)
                    .style("opacity", 1);

                // è²¡ç”¢é‡‘é¡æ¨™ç±¤
                svg.append("text")
                    .attr("class", "wealth-label")
                    .attr("x", x + avatarSize / 2 + 8)
                    .attr("y", y + 18)
                    .style("opacity", 0)
                    .text(formatWealth(person.wealth))
                    .transition()
                    .duration(300)
                    .delay(i * 50 + 300)
                    .style("opacity", 1);
            });
        }

        // æŒ‰éˆ•äº‹ä»¶
        document.getElementById("generateBtn").addEventListener("click", () => {
            const data = generateRandomData();
            drawChart(data);
        });

        // è¦–çª—å¤§å°æ”¹è®Šæ™‚é‡ç¹ª
        let resizeTimer;
        let currentData = generateRandomData();
        
        window.addEventListener("resize", () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                updateDimensions();
                svgContainer
                    .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`);
                svg.attr("transform", `translate(${margin.left},${margin.top})`);
                drawChart(currentData);
            }, 250);
        });

        // åˆå§‹ç”Ÿæˆä¸€æ¬¡æ•¸æ“š
        drawChart(currentData);
    </script>
</body>
</html>