{
  "metadata": {
    "title": "Complete Source Code for 49 Unused API Endpoints",
    "description": "Full code extraction from Cloudflare Workers router files",
    "generatedAt": "2025-11-28",
    "totalEndpoints": 49
  },
  "endpoints": [
    {
      "id": 1,
      "path": "/api/admin/global-groups/:groupId/members",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 905,
      "endLine": 927,
      "status": "UNUSED",
      "reason": "Frontend uses POST /api/admin/global-groups/members instead",
      "code": "/**\n * Get global group members\n */\napp.get('/global-groups/:groupId/members', async (c) => {\n  try {\n    const groupId = c.req.param('groupId');\n\n    if (!groupId) {\n      return c.json({\n        success: false,\n        error: 'groupId is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await getGlobalGroupMembers(c.env, groupId);\n    return response;\n  } catch (error) {\n    console.error('Get global group members error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get global group members',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getGlobalGroupMembers"],
      "imports": []
    },
    {
      "id": 2,
      "path": "/api/admin/global-groups/activate",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 836,
      "endLine": 865,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/activate-global-group instead",
      "code": "/**\n * Activate global group\n * Body: { groupId }\n */\napp.post('/global-groups/activate', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { groupId } = body;\n\n    if (!groupId) {\n      return c.json({\n        success: false,\n        error: 'groupId is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await activateGlobalGroup(\n      c.env,\n      user.userEmail,\n      groupId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Activate global group error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to activate global group',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["activateGlobalGroup"],
      "imports": []
    },
    {
      "id": 3,
      "path": "/api/admin/global-groups/create",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 612,
      "endLine": 641,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/create-global-group instead",
      "code": "/**\n * Create global group\n * Body: { groupData: { groupName, description?, globalPermissions? } }\n */\napp.post('/global-groups/create', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { groupData } = body;\n\n    if (!groupData || !groupData.groupName) {\n      return c.json({\n        success: false,\n        error: 'groupData with groupName is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await createGlobalGroup(\n      c.env,\n      user.userEmail,\n      groupData\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Create global group error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to create global group',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["createGlobalGroup"],
      "imports": []
    },
    {
      "id": 4,
      "path": "/api/admin/global-groups/deactivate",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 766,
      "endLine": 795,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/deactivate-global-group instead",
      "code": "/**\n * Deactivate global group\n * Body: { groupId }\n */\napp.post('/global-groups/deactivate', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { groupId } = body;\n\n    if (!groupId) {\n      return c.json({\n        success: false,\n        error: 'groupId is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await deactivateGlobalGroup(\n      c.env,\n      user.userEmail,\n      groupId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Deactivate global group error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to deactivate global group',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["deactivateGlobalGroup"],
      "imports": []
    },
    {
      "id": 5,
      "path": "/api/admin/global-groups/update",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 685,
      "endLine": 715,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/update-global-group instead",
      "code": "/**\n * Update global group\n * Body: { groupId, groupData: { groupName?, description?, globalPermissions? } }\n */\napp.post('/global-groups/update', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { groupId, groupData } = body;\n\n    if (!groupId || !groupData) {\n      return c.json({\n        success: false,\n        error: 'groupId and groupData are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await updateGlobalGroup(\n      c.env,\n      user.userEmail,\n      groupId,\n      groupData\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Update global group error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to update global group',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["updateGlobalGroup"],
      "imports": []
    },
    {
      "id": 6,
      "path": "/api/admin/logs/stats",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 1276,
      "endLine": 1288,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/system/log-statistics instead",
      "code": "/**\n * POST version for compatibility - Get log statistics\n * Alternative endpoint path used by frontend\n */\napp.post('/logs/stats', async (c) => {\n  try {\n    const response = await getLogStatistics(c.env);\n    return response;\n  } catch (error) {\n    console.error('Get log statistics error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get log statistics',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getLogStatistics"],
      "imports": []
    },
    {
      "id": 7,
      "path": "/api/admin/notifications/statistics",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 1506,
      "endLine": 1524,
      "status": "UNUSED",
      "reason": "Duplicate of /notifications/admin/statistics",
      "code": "/**\n * POST /admin/notifications/statistics\n * Get notification statistics\n */\napp.post('/notifications/statistics', async (c) => {\n  try {\n    const user = c.get('user');\n\n    const response = await getNotificationStatistics(\n      c.env,\n      user.userEmail\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get notification statistics error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get notification statistics',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getNotificationStatistics"],
      "imports": []
    },
    {
      "id": 8,
      "path": "/api/admin/system/event-logs",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 1218,
      "endLine": 1232,
      "status": "UNUSED",
      "reason": "Frontend uses POST /api/admin/system/logs instead",
      "code": "/**\n * Get system event logs\n * Query params: limit (default: 100)\n */\napp.get('/system/event-logs', async (c) => {\n  try {\n    const limit = parseInt(c.req.query('limit') || '100');\n\n    const response = await getSystemEventLogs(c.env, limit);\n    return response;\n  } catch (error) {\n    console.error('Get system event logs error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get system event logs',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getSystemEventLogs"],
      "imports": []
    },
    {
      "id": 9,
      "path": "/api/admin/users",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 179,
      "endLine": 191,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/users/list instead",
      "code": "/**\n * Get all users\n */\napp.get('/users', async (c) => {\n  try {\n    const response = await getAllUsers(c.env);\n    return response;\n  } catch (error) {\n    console.error('Get all users error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get users',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getAllUsers"],
      "imports": []
    },
    {
      "id": 10,
      "path": "/api/admin/users/:userEmail/global-groups",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 410,
      "endLine": 432,
      "status": "UNUSED",
      "reason": "Frontend uses POST /api/admin/user-global-groups instead",
      "code": "/**\n * Get user's global groups\n */\napp.get('/users/:userEmail/global-groups', async (c) => {\n  try {\n    const userEmail = c.req.param('userEmail');\n\n    if (!userEmail) {\n      return c.json({\n        success: false,\n        error: 'userEmail is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await getUserGlobalGroups(c.env, userEmail);\n    return response;\n  } catch (error) {\n    console.error('Get user global groups error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get user global groups',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getUserGlobalGroups"],
      "imports": []
    },
    {
      "id": 11,
      "path": "/api/admin/users/:userEmail/project-groups",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 437,
      "endLine": 459,
      "status": "UNUSED",
      "reason": "Frontend uses POST /api/admin/user-project-groups instead",
      "code": "/**\n * Get user's project groups\n */\napp.get('/users/:userEmail/project-groups', async (c) => {\n  try {\n    const userEmail = c.req.param('userEmail');\n\n    if (!userEmail) {\n      return c.json({\n        success: false,\n        error: 'userEmail is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await getUserProjectGroups(c.env, userEmail);\n    return response;\n  } catch (error) {\n    console.error('Get user project groups error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get user project groups',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getUserProjectGroups"],
      "imports": []
    },
    {
      "id": 12,
      "path": "/api/admin/users/list-all",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 224,
      "endLine": 236,
      "status": "UNUSED",
      "reason": "Duplicate of /api/admin/users/list",
      "code": "// Alternative endpoint path for list-all\napp.post('/users/list-all', async (c) => {\n  try {\n    const response = await getAllUsers(c.env);\n    return response;\n  } catch (error) {\n    console.error('Get all users error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get users',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getAllUsers"],
      "imports": []
    },
    {
      "id": 13,
      "path": "/api/admin/users/update-profile",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/admin.ts",
      "startLine": 292,
      "endLine": 321,
      "status": "UNUSED",
      "reason": "Frontend uses /api/admin/user-profile instead",
      "code": "/**\n * Update user profile\n * Body: { userData: { userEmail, displayName?, status?, avatarSeed?, avatarStyle?, avatarOptions? } }\n */\napp.post('/users/update-profile', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { userData } = body;\n\n    if (!userData || !userData.userEmail) {\n      return c.json({\n        success: false,\n        error: 'userData with userEmail is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await updateUserProfile(\n      c.env,\n      user.userEmail,\n      userData\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Update user profile error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to update user profile',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["updateUserProfile"],
      "imports": []
    },
    {
      "id": 14,
      "path": "/auth/init-system",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/auth.ts",
      "startLine": 273,
      "endLine": 281,
      "status": "UNUSED",
      "reason": "Frontend uses POST /auth/init-system",
      "code": "authRouter.get('/init-system', async (c) => {\n  try {\n    const result = await initializeSystem(c.env);\n    return result;\n  } catch (error) {\n    console.error('Init system route error:', error);\n    return c.json({ success: false, error: { code: 'INTERNAL_ERROR', message: 'System initialization failed' } }, 500);\n  }\n});",
      "handlers": ["initializeSystem"],
      "imports": []
    },
    {
      "id": 15,
      "path": "/comments/reactions/add",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/comments.ts",
      "startLine": 155,
      "endLine": 196,
      "status": "UNUSED",
      "reason": "Frontend does not use comment reactions feature",
      "code": "/**\n * Add reaction to comment\n * Body: { sessionId, projectId, commentId, reactionType }\n */\napp.post('/reactions/add', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, commentId, reactionType } = body;\n\n    if (!projectId || !commentId || !reactionType) {\n      return c.json({\n        success: false,\n        error: 'Project ID, comment ID, and reaction type are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: All levels with view access can add reactions\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to add reactions',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await addReaction(\n      c.env,\n      user.userEmail,\n      projectId,\n      commentId,\n      reactionType\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Add reaction route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to add reaction',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["addReaction"],
      "imports": []
    },
    {
      "id": 16,
      "path": "/comments/reactions/batch",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/comments.ts",
      "startLine": 294,
      "endLine": 334,
      "status": "UNUSED",
      "reason": "Frontend does not use comment reactions feature",
      "code": "/**\n * Get reactions for multiple comments (batch)\n * Body: { sessionId, projectId, commentIds: string[] }\n */\napp.post('/reactions/batch', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, commentIds } = body;\n\n    if (!projectId || !commentIds) {\n      return c.json({\n        success: false,\n        error: 'Project ID and comment IDs are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view reactions',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getBatchCommentReactions(\n      c.env,\n      user.userEmail,\n      projectId,\n      commentIds\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get batch reactions route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get batch reactions',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getBatchCommentReactions"],
      "imports": []
    },
    {
      "id": 17,
      "path": "/comments/reactions/get",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/comments.ts",
      "startLine": 248,
      "endLine": 288,
      "status": "UNUSED",
      "reason": "Frontend does not use comment reactions feature",
      "code": "/**\n * Get reactions for a comment\n * Body: { sessionId, projectId, commentId }\n */\napp.post('/reactions/get', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, commentId } = body;\n\n    if (!projectId || !commentId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and comment ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view reactions',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getCommentReactions(\n      c.env,\n      user.userEmail,\n      projectId,\n      commentId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get reactions route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get reactions',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getCommentReactions"],
      "imports": []
    },
    {
      "id": 18,
      "path": "/comments/reactions/remove",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/comments.ts",
      "startLine": 202,
      "endLine": 242,
      "status": "UNUSED",
      "reason": "Frontend does not use comment reactions feature",
      "code": "/**\n * Remove reaction from comment\n * Body: { sessionId, projectId, commentId }\n */\napp.post('/reactions/remove', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, commentId } = body;\n\n    if (!projectId || !commentId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and comment ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: All levels with view access can remove reactions\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to remove reactions',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await removeReaction(\n      c.env,\n      user.userEmail,\n      projectId,\n      commentId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Remove reaction route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to remove reaction',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["removeReaction"],
      "imports": []
    },
    {
      "id": 19,
      "path": "/groups/get",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/groups.ts",
      "startLine": 47,
      "endLine": 87,
      "status": "UNUSED",
      "reason": "Frontend uses /groups/details instead",
      "code": "/**\n * Get group details\n * Body: { sessionId, projectId, groupId }\n */\napp.post('/get', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, groupId } = body;\n\n    if (!projectId || !groupId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and group ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: need at least 'view' permission to view groups\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view group',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getGroup(\n      c.env,\n      user.userEmail,\n      projectId,\n      groupId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get group route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get group',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getGroup"],
      "imports": []
    },
    {
      "id": 20,
      "path": "/api/ip/",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/ip.ts",
      "startLine": 32,
      "endLine": 65,
      "status": "UNUSED",
      "reason": "Frontend uses /api/ip (without trailing slash)",
      "code": "app.get('/', (c) => {\n  const request = c.req.raw\n  const cf = request.cf as IncomingRequestCfProperties | undefined\n\n  return c.json({\n    success: true,\n    data: {\n      // Basic IP information\n      ip: cf?.ip || request.headers.get('CF-Connecting-IP') || 'unknown',\n\n      // Geolocation information (all free from Cloudflare!)\n      location: {\n        city: cf?.city || null,\n        country: cf?.country || null,\n        continent: cf?.continent || null,\n        timezone: cf?.timezone || null,\n        latitude: cf?.latitude || null,\n        longitude: cf?.longitude || null,\n        region: cf?.region || null,\n        regionCode: cf?.regionCode || null,\n        postalCode: cf?.postalCode || null,\n        metroCode: cf?.metroCode || null\n      },\n\n      // Network information\n      network: {\n        asn: cf?.asn || null,\n        isp: cf?.asOrganization || null,\n        datacenter: cf?.colo || null,\n        httpProtocol: cf?.httpProtocol || null\n      }\n    }\n  })\n})",
      "handlers": [],
      "imports": [],
      "notes": "This is the root handler for /ip router, mapped as /api/ip/ in main index"
    },
    {
      "id": 21,
      "path": "/api/ip/info",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/ip.ts",
      "startLine": 74,
      "endLine": 120,
      "status": "UNUSED",
      "reason": "Frontend doesn't need detailed IP info with headers",
      "code": "/**\n * GET /info\n * Get detailed client information including headers\n * Useful for debugging and advanced use cases\n *\n * No authentication required (public endpoint)\n */\napp.get('/info', (c) => {\n  const request = c.req.raw\n  const cf = request.cf as IncomingRequestCfProperties | undefined\n\n  // Extract common headers\n  const headers = {\n    userAgent: request.headers.get('User-Agent') || null,\n    acceptLanguage: request.headers.get('Accept-Language') || null,\n    acceptEncoding: request.headers.get('Accept-Encoding') || null,\n    referer: request.headers.get('Referer') || null\n  }\n\n  return c.json({\n    success: true,\n    data: {\n      // IP and geolocation\n      ip: cf?.ip || request.headers.get('CF-Connecting-IP') || 'unknown',\n      location: {\n        city: cf?.city,\n        country: cf?.country,\n        continent: cf?.continent,\n        timezone: cf?.timezone,\n        latitude: cf?.latitude,\n        longitude: cf?.longitude,\n        region: cf?.region,\n        regionCode: cf?.regionCode,\n        postalCode: cf?.postalCode\n      },\n\n      // Network info\n      network: {\n        asn: cf?.asn,\n        isp: cf?.asOrganization,\n        datacenter: cf?.colo,\n        httpProtocol: cf?.httpProtocol,\n        tlsVersion: cf?.tlsVersion,\n        tlsCipher: cf?.tlsCipher\n      },\n\n      // Headers\n      headers,\n\n      // Additional info\n      timestamp: Date.now()\n    }\n  })\n})",
      "handlers": [],
      "imports": []
    },
    {
      "id": 22,
      "path": "/maintenance/check-suspicious-logins",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/maintenance.ts",
      "startLine": 157,
      "endLine": 202,
      "status": "UNUSED",
      "reason": "Admin utility - not used by frontend",
      "code": "/**\n * POST /maintenance/check-suspicious-logins\n * Analyze recent login attempts for suspicious patterns\n * Returns list of potentially malicious attempts\n */\nmaintenanceRouter.post('/check-suspicious-logins', async (c) => {\n  try {\n    const db = c.env.DB;\n    const THRESHOLD = 3;\n    const WINDOW_MS = 5 * 60 * 1000; // 5 minutes\n    const now = Date.now();\n    const windowStart = now - WINDOW_MS;\n\n    // Query failed login attempts in the window (from eventlogs)\n    const result = await db.prepare(`\n      SELECT entityId as userEmail, COUNT(*) as failedCount, MIN(timestamp) as firstAttempt, MAX(timestamp) as lastAttempt\n      FROM eventlogs\n      WHERE eventType = 'failed_login' AND timestamp >= ?\n      GROUP BY userEmail\n      HAVING failedCount >= ?\n      ORDER BY failedCount DESC\n    `).bind(windowStart, THRESHOLD).all();\n\n    const suspiciousAttempts = result.results.map((row: any) => ({\n      userEmail: row.userEmail,\n      failedCount: row.failedCount,\n      firstAttempt: row.firstAttempt,\n      lastAttempt: row.lastAttempt,\n      reason: `${row.failedCount} failed login attempts in 5 minutes`\n    }));\n\n    return c.json({\n      success: true,\n      data: {\n        suspicious: suspiciousAttempts.length,\n        attempts: suspiciousAttempts\n      }\n    });\n\n  } catch (error) {\n    console.error('Check suspicious logins error:', error);\n    return c.json({\n      success: false,\n      error: {\n        code: 'CHECK_ERROR',\n        message: 'Failed to check suspicious logins',\n        details: error instanceof Error ? error.message : String(error)\n      }\n    }, 500);\n  }\n});",
      "handlers": [],
      "imports": []
    },
    {
      "id": 23,
      "path": "/maintenance/cleanup-expired-invitations",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/maintenance.ts",
      "startLine": 118,
      "endLine": 150,
      "status": "UNUSED",
      "reason": "Admin utility - not used by frontend",
      "code": "/**\n * POST /maintenance/cleanup-expired-invitations\n * Mark expired invitation codes as expired\n */\nmaintenanceRouter.post('/cleanup-expired-invitations', async (c) => {\n  try {\n    const db = c.env.DB;\n    const now = Date.now();\n\n    // Mark expired invitations\n    const result = await db.prepare(`\n      UPDATE invitation_codes\n      SET status = 'expired'\n      WHERE status = 'active'\n        AND expiryTime IS NOT NULL\n        AND expiryTime < ?\n    `).bind(now).run();\n\n    return c.json({\n      success: true,\n      data: {\n        expiredCount: result.meta.changes || 0\n      }\n    });\n\n  } catch (error) {\n    console.error('Cleanup invitations error:', error);\n    return c.json({\n      success: false,\n      error: {\n        code: 'CLEANUP_ERROR',\n        message: 'Failed to cleanup expired invitations',\n        details: error instanceof Error ? error.message : String(error)\n      }\n    }, 500);\n  }\n});",
      "handlers": [],
      "imports": []
    },
    {
      "id": 24,
      "path": "/maintenance/status",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/maintenance.ts",
      "startLine": 208,
      "endLine": 247,
      "status": "UNUSED",
      "reason": "Admin utility - not used by frontend",
      "code": "/**\n * POST /maintenance/status\n * Get maintenance status and last execution times\n */\nmaintenanceRouter.post('/status', async (c) => {\n  try {\n    const db = c.env.DB;\n\n    // Get counts of various entities\n    const [\n      projectsCount,\n      usersCount,\n      invitationsCount,\n      expiredInvitationsCount\n    ] = await Promise.all([\n      db.prepare('SELECT COUNT(*) as count FROM projects WHERE status = ?').bind('active').first(),\n      db.prepare('SELECT COUNT(*) as count FROM users WHERE status = ?').bind('active').first(),\n      db.prepare('SELECT COUNT(*) as count FROM invitation_codes WHERE status = ?').bind('active').first(),\n      db.prepare('SELECT COUNT(*) as count FROM invitation_codes WHERE status = ? AND expiryTime < ?').bind('active', Date.now()).first()\n    ]);\n\n    return c.json({\n      success: true,\n      data: {\n        activeProjects: (projectsCount as any)?.count || 0,\n        activeUsers: (usersCount as any)?.count || 0,\n        activeInvitations: (invitationsCount as any)?.count || 0,\n        expiredInvitations: (expiredInvitationsCount as any)?.count || 0,\n        note: 'Stage status is synced automatically on each request - no scheduled patrol needed'\n      }\n    });\n\n  } catch (error) {\n    console.error('Maintenance status error:', error);\n    return c.json({\n      success: false,\n      error: {\n        code: 'STATUS_ERROR',\n        message: 'Failed to get maintenance status',\n        details: error instanceof Error ? error.message : String(error)\n      }\n    }, 500);\n  }\n});",
      "handlers": [],
      "imports": []
    },
    {
      "id": 25,
      "path": "/maintenance/sync-all-stages",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/maintenance.ts",
      "startLine": 26,
      "endLine": 71,
      "status": "UNUSED",
      "reason": "Admin utility - not used by frontend",
      "code": "/**\n * POST /maintenance/sync-all-stages\n * Manually sync all stages across all projects\n * Useful for admin verification or after system maintenance\n */\nmaintenanceRouter.post('/sync-all-stages', async (c) => {\n  try {\n    const db = c.env.DB;\n\n    // Get all active projects\n    const projectsResult = await db.prepare(`\n      SELECT projectId, projectName\n      FROM projects\n      WHERE status = 'active'\n    `).all();\n\n    const results = [];\n    let totalUpdates = 0;\n\n    for (const project of projectsResult.results as any[]) {\n      const syncResult = await syncProjectStageStatuses(db, project.projectId);\n      results.push({\n        projectId: project.projectId,\n        projectName: project.projectName,\n        updatesCount: syncResult.updatesCount,\n        updates: syncResult.updates\n      });\n      totalUpdates += syncResult.updatesCount;\n    }\n\n    return c.json({\n      success: true,\n      data: {\n        projectsChecked: projectsResult.results.length,\n        totalUpdates,\n        results\n      }\n    });\n\n  } catch (error) {\n    console.error('Sync all stages error:', error);\n    return c.json({\n      success: false,\n      error: {\n        code: 'SYNC_ERROR',\n        message: 'Failed to sync stages',\n        details: error instanceof Error ? error.message : String(error)\n      }\n    }, 500);\n  }\n});",
      "handlers": ["syncProjectStageStatuses"],
      "imports": ["import { syncProjectStageStatuses } from '../middleware/stage-status';"]
    },
    {
      "id": 26,
      "path": "/maintenance/sync-project-stages",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/maintenance.ts",
      "startLine": 78,
      "endLine": 112,
      "status": "UNUSED",
      "reason": "Admin utility - not used by frontend",
      "code": "/**\n * POST /maintenance/sync-project-stages\n * Manually sync all stages for a specific project\n * Body: { projectId }\n */\nmaintenanceRouter.post('/sync-project-stages', async (c) => {\n  try {\n    const body = await c.req.json();\n    const { projectId } = body;\n\n    if (!projectId) {\n      return c.json({\n        success: false,\n        error: {\n          code: 'INVALID_INPUT',\n          message: 'projectId is required'\n        }\n      }, 400);\n    }\n\n    const db = c.env.DB;\n    const syncResult = await syncProjectStageStatuses(db, projectId);\n\n    return c.json({\n      success: true,\n      data: syncResult\n    });\n\n  } catch (error) {\n    console.error('Sync project stages error:', error);\n    return c.json({\n      success: false,\n      error: {\n        code: 'SYNC_ERROR',\n        message: 'Failed to sync project stages',\n        details: error instanceof Error ? error.message : String(error)\n      }\n    }, 500);\n  }\n});",
      "handlers": ["syncProjectStageStatuses"],
      "imports": ["import { syncProjectStageStatuses } from '../middleware/stage-status';"]
    },
    {
      "id": 27,
      "path": "/notifications/admin/delete",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/notifications.ts",
      "startLine": 298,
      "endLine": 328,
      "status": "UNUSED",
      "reason": "Duplicate - admin uses /api/admin/notifications/delete",
      "code": "/**\n * Delete notification (admin hard delete)\n * Body: { sessionId, notificationId }\n */\napp.post('/admin/delete', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { notificationId } = body;\n\n    if (!notificationId) {\n      return c.json({\n        success: false,\n        error: 'Notification ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await deleteNotificationAdmin(\n      c.env,\n      user.userEmail,\n      notificationId\n    );\n\n    return response;\n\n  } catch (error) {\n    console.error('Delete notification admin error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to delete notification',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["deleteNotificationAdmin"],
      "imports": []
    },
    {
      "id": 28,
      "path": "/notifications/admin/list",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/notifications.ts",
      "startLine": 206,
      "endLine": 228,
      "status": "UNUSED",
      "reason": "Duplicate - admin uses /api/admin/notifications/list",
      "code": "/**\n * List all notifications (admin only)\n * Body: { sessionId, filters?: { targetUserEmail?, type?, isRead?, limit?, offset? } }\n */\napp.post('/admin/list', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { filters = {} } = body;\n\n    const response = await listAllNotifications(\n      c.env,\n      user.userEmail,\n      filters\n    );\n\n    return response;\n\n  } catch (error) {\n    console.error('List all notifications error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to list all notifications',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["listAllNotifications"],
      "imports": []
    },
    {
      "id": 29,
      "path": "/notifications/admin/send",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/notifications.ts",
      "startLine": 234,
      "endLine": 264,
      "status": "UNUSED",
      "reason": "Duplicate - admin uses /api/admin/notifications/send-single",
      "code": "/**\n * Send single notification email (admin)\n * Body: { sessionId, notificationId }\n */\napp.post('/admin/send', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { notificationId } = body;\n\n    if (!notificationId) {\n      return c.json({\n        success: false,\n        error: 'Notification ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await sendSingleNotification(\n      c.env,\n      user.userEmail,\n      notificationId\n    );\n\n    return response;\n\n  } catch (error) {\n    console.error('Send single notification error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to send notification email',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["sendSingleNotification"],
      "imports": []
    },
    {
      "id": 30,
      "path": "/notifications/admin/send-batch",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/notifications.ts",
      "startLine": 270,
      "endLine": 292,
      "status": "UNUSED",
      "reason": "Duplicate - admin uses /api/admin/notifications/send-batch",
      "code": "/**\n * Send batch notification emails (admin)\n * Body: { sessionId, filters?: { targetUserEmail?, type?, isRead?, limit? } }\n */\napp.post('/admin/send-batch', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { filters = {} } = body;\n\n    const response = await sendBatchNotifications(\n      c.env,\n      user.userEmail,\n      filters\n    );\n\n    return response;\n\n  } catch (error) {\n    console.error('Send batch notifications error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to send batch notifications',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["sendBatchNotifications"],
      "imports": []
    },
    {
      "id": 31,
      "path": "/notifications/admin/statistics",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/notifications.ts",
      "startLine": 334,
      "endLine": 353,
      "status": "UNUSED",
      "reason": "Duplicate - admin uses /api/admin/notifications/statistics",
      "code": "/**\n * Get notification statistics (admin)\n * Body: { sessionId }\n */\napp.post('/admin/statistics', async (c) => {\n  try {\n    const user = c.get('user');\n\n    const response = await getNotificationStatistics(\n      c.env,\n      user.userEmail\n    );\n\n    return response;\n\n  } catch (error) {\n    console.error('Get notification statistics error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get notification statistics',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getNotificationStatistics"],
      "imports": []
    },
    {
      "id": 32,
      "path": "/scoring/analysis",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 209,
      "endLine": 249,
      "status": "DEPRECATED",
      "reason": "Individual voting system deprecated - use /rankings API instead",
      "code": "/**\n * Get voting analysis\n * Body: { sessionId, projectId, stageId }\n */\napp.post('/analysis', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId } = body;\n\n    if (!projectId || !stageId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and stage ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: Only teachers/admins (Level 0-1) can view voting analysis\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'manage');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view voting analysis',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getVotingAnalysis(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get voting analysis route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get voting analysis',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getVotingAnalysis"],
      "imports": [],
      "notes": "DEPRECATED - commented out in source, individual voting system obsolete"
    },
    {
      "id": 33,
      "path": "/scoring/data",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 163,
      "endLine": 203,
      "status": "DEPRECATED",
      "reason": "Individual voting system deprecated - use /rankings API instead",
      "code": "/**\n * Get voting data\n * Body: { sessionId, projectId, stageId }\n */\napp.post('/data', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId } = body;\n\n    if (!projectId || !stageId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and stage ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view voting data',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getVotingData(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get voting data route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get voting data',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getVotingData"],
      "imports": [],
      "notes": "DEPRECATED - commented out in source, individual voting system obsolete"
    },
    {
      "id": 34,
      "path": "/scoring/preview",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 256,
      "endLine": 296,
      "status": "UNUSED",
      "reason": "Frontend doesn't use preview - directly settles",
      "code": "/**\n * Preview stage scores\n * Body: { sessionId, projectId, stageId }\n */\napp.post('/preview', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId } = body;\n\n    if (!projectId || !stageId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and stage ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: Only teachers/admins (Level 0-1) can preview scores\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'manage');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to preview scores',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await previewStageScores(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Preview scores route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to preview scores',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["previewStageScores"],
      "imports": []
    },
    {
      "id": 35,
      "path": "/scoring/results",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 393,
      "endLine": 433,
      "status": "UNUSED",
      "reason": "Frontend uses /settlement/stage-rankings instead",
      "code": "/**\n * Get settled results\n * Body: { sessionId, projectId, stageId }\n */\napp.post('/results', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId } = body;\n\n    if (!projectId || !stageId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and stage ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view results',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getSettledStageResults(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get results route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get results',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getSettledStageResults"],
      "imports": []
    },
    {
      "id": 36,
      "path": "/scoring/status",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 117,
      "endLine": 157,
      "status": "DEPRECATED",
      "reason": "Individual voting system deprecated - use /rankings API instead",
      "code": "/**\n * Get voting status\n * Body: { sessionId, projectId, stageId }\n */\napp.post('/status', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId } = body;\n\n    if (!projectId || !stageId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and stage ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view voting status',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getStageVotingStatus(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get voting status route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get voting status',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getStageVotingStatus"],
      "imports": [],
      "notes": "DEPRECATED - commented out in source, individual voting system obsolete"
    },
    {
      "id": 37,
      "path": "/scoring/vote",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/scoring.ts",
      "startLine": 69,
      "endLine": 111,
      "status": "DEPRECATED",
      "reason": "Individual voting system deprecated - use /rankings API instead",
      "code": "/**\n * Submit ranking vote\n * Body: { sessionId, projectId, stageId, rankings: { groupId: rank } }\n */\napp.post('/vote', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId, rankings } = body;\n\n    if (!projectId || !stageId || !rankings) {\n      return c.json({\n        success: false,\n        error: 'Project ID, stage ID, and rankings are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check permission: Students (Level 3) with vote permission can vote\n    // Handler will determine if it's teacher vote or peer vote based on role\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to submit votes',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await submitRankingVote(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId,\n      rankings\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Submit vote route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to submit vote',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["submitRankingVote"],
      "imports": [],
      "notes": "DEPRECATED - commented out in source, individual voting system obsolete"
    },
    {
      "id": 38,
      "path": "/settlement/transactions",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/settlement.ts",
      "startLine": 185,
      "endLine": 215,
      "status": "UNUSED",
      "reason": "Frontend uses /wallets/transactions instead",
      "code": "/**\n * Get settlement transactions\n * Body: { sessionId, projectId, settlementId }\n */\napp.post('/transactions', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, settlementId } = body;\n\n    if (!projectId || !settlementId) {\n      return c.json({\n        success: false,\n        error: 'Project ID and settlement ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await getSettlementTransactions(\n      c.env,\n      user.userEmail,\n      projectId,\n      settlementId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get settlement transactions route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get settlement transactions',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getSettlementTransactions"],
      "imports": []
    },
    {
      "id": 39,
      "path": "/submissions/update",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/submissions.ts",
      "startLine": 192,
      "endLine": 235,
      "status": "DEPRECATED",
      "reason": "Design philosophy: submissions immutable, withdraw and resubmit instead",
      "code": "/**\n * Update submission (DEPRECATED - NOT USED BY FRONTEND)\n * Body: { sessionId, projectId, submissionId, updates: { content?, authors?, participationProposal? } }\n *\n * @deprecated This endpoint is not used by the frontend. Current design philosophy:\n * submissions are immutable after creation. Users should withdraw and resubmit instead.\n */\n/* DISABLED - Uncomment if needed in the future\napp.post('/update', requireActiveStage, async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, submissionId, updates } = body;\n\n    if (!projectId || !submissionId || !updates) {\n      return c.json({\n        success: false,\n        error: 'Project ID, submission ID, and updates are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Check basic project access - handler will verify submitter\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'view');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to update submission',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await updateSubmission(\n      c.env,\n      user.userEmail,\n      projectId,\n      submissionId,\n      updates\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Update submission route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to update submission',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});\n*/",
      "handlers": ["updateSubmission"],
      "imports": [],
      "notes": "Commented out in source code - explicitly deprecated"
    },
    {
      "id": 40,
      "path": "/submissions/versions/restore",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/submissions.ts",
      "startLine": 334,
      "endLine": 365,
      "status": "UNUSED",
      "reason": "Frontend uses /submissions/restore instead",
      "code": "/**\n * Restore submission version\n * Body: { sessionId, projectId, stageId, submissionId }\n */\napp.post('/versions/restore', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, stageId, submissionId } = body;\n\n    if (!projectId || !stageId || !submissionId) {\n      return c.json({\n        success: false,\n        error: 'Project ID, stage ID, and submission ID are required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    const response = await restoreSubmissionVersion(\n      c.env,\n      user.userEmail,\n      projectId,\n      stageId,\n      submissionId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Restore submission version route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to restore submission version',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["restoreSubmissionVersion"],
      "imports": []
    },
    {
      "id": 41,
      "path": "/system/secrets-checklist",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/system.ts",
      "startLine": 189,
      "endLine": 197,
      "status": "UNUSED",
      "reason": "Admin utility - frontend doesn't access secrets checklist",
      "code": "systemRouter.get('/secrets-checklist', requireSystemAdmin, async (c) => {\n  try {\n    const result = await getSecretsChecklist(c.env);\n    return jsonResponse(result);\n  } catch (error) {\n    console.error('Secrets checklist route error:', error);\n    return c.json({ success: false, error: { code: 'INTERNAL_ERROR', message: 'Failed to get checklist' } }, 500);\n  }\n});",
      "handlers": ["getSecretsChecklist"],
      "imports": ["import { getSecretsChecklist } from '../handlers/system/settings';"]
    },
    {
      "id": 42,
      "path": "/users/deactivate",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/users.ts",
      "startLine": 215,
      "endLine": 237,
      "status": "UNUSED",
      "reason": "Frontend doesn't implement self-deactivation feature",
      "code": "/**\n * Deactivate user account\n * Body: { sessionId, reason? }\n */\napp.post('/deactivate', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const reason = body.reason || 'user_request';\n\n    const response = await deactivateUser(\n      c.env,\n      user.userId,\n      user.userEmail,\n      reason\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Deactivate user route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to deactivate user account',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["deactivateUser"],
      "imports": []
    },
    {
      "id": 43,
      "path": "/users/stats",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/users.ts",
      "startLine": 187,
      "endLine": 209,
      "status": "UNUSED",
      "reason": "Frontend doesn't use user statistics page",
      "code": "/**\n * Get user statistics\n * Body: { sessionId, targetUserId? }\n */\napp.post('/stats', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const targetUserId = body.targetUserId || null;\n\n    const response = await getUserStats(\n      c.env,\n      user.userId,\n      user.userEmail,\n      targetUserId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get user stats route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get user statistics',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getUserStats"],
      "imports": []
    },
    {
      "id": 44,
      "path": "/wallets/get",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/wallets.ts",
      "startLine": 50,
      "endLine": 92,
      "status": "UNUSED",
      "reason": "Frontend uses /wallets/transactions for wallet data",
      "code": "/**\n * Get user wallet\n * Body: { sessionId, projectId, targetUserEmail? }\n */\napp.post('/get', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, targetUserEmail } = body;\n\n    if (!projectId) {\n      return c.json({\n        success: false,\n        error: 'Project ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // If viewing another user's wallet, need teacher level or above (Level 0-2: Admin/Teacher/Observer)\n    if (targetUserEmail && targetUserEmail !== user.userEmail) {\n      const hasPermission = await checkIsTeacherOrAbove(c.env.DB, user.userEmail, projectId);\n      if (!hasPermission) {\n        return c.json({\n          success: false,\n          error: 'Insufficient permissions to view other wallets. Requires teacher level or above.',\n          errorCode: 'ACCESS_DENIED'\n        }, 403);\n      }\n    }\n\n    const response = await getUserWallet(\n      c.env,\n      user.userEmail,\n      projectId,\n      targetUserEmail\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get wallet route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get wallet',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getUserWallet"],
      "imports": []
    },
    {
      "id": 45,
      "path": "/wallets/group-stats",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/wallets.ts",
      "startLine": 516,
      "endLine": 556,
      "status": "UNUSED",
      "reason": "Reserved for future teacher/admin dashboard feature",
      "code": "/**\n * Get group wealth statistics\n * Body: { sessionId, projectId }\n *\n * @deprecated - Frontend not using this API (no component uses group wealth stats)\n * Reserved for future teacher/admin dashboard feature\n */\n/* COMMENTED OUT - NOT USED BY FRONTEND\napp.post('/group-stats', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId } = body;\n\n    if (!projectId) {\n      return c.json({\n        success: false,\n        error: 'Project ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Need teacher level or above to view project-wide group statistics\n    const hasPermission = await checkIsTeacherOrAbove(c.env.DB, user.userEmail, projectId);\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view group statistics. Requires teacher level or above.',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getGroupWealthStats(\n      c.env,\n      user.userEmail,\n      projectId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get group stats route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get group statistics',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});\n*/",
      "handlers": ["getGroupWealthStats"],
      "imports": [],
      "notes": "Commented out in source code - reserved for future use"
    },
    {
      "id": 46,
      "path": "/wallets/ladder",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/wallets.ts",
      "startLine": 417,
      "endLine": 457,
      "status": "UNUSED",
      "reason": "Duplicate of /wallets/project-ladder",
      "code": "/**\n * Get project wallet ladder (by groups)\n * Body: { sessionId, projectId }\n *\n * @deprecated - Frontend not using this API (duplicate of /project-ladder)\n * Use /wallets/project-ladder instead\n */\n/* COMMENTED OUT - NOT USED BY FRONTEND (DUPLICATE ENDPOINT)\napp.post('/ladder', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId } = body;\n\n    if (!projectId) {\n      return c.json({\n        success: false,\n        error: 'Project ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Need teacher level or above to view project-wide wallet ladder\n    const hasPermission = await checkIsTeacherOrAbove(c.env.DB, user.userEmail, projectId);\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view wallet ladder. Requires teacher level or above.',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getProjectWalletLadder(\n      c.env,\n      user.userEmail,\n      projectId\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get wallet ladder route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get wallet ladder',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});\n*/",
      "handlers": ["getProjectWalletLadder"],
      "imports": [],
      "notes": "Commented out in source code - duplicate endpoint"
    },
    {
      "id": 47,
      "path": "/wallets/transactions/all",
      "method": "POST",
      "sourceFile": "Cloudflare-Workers/src/router/wallets.ts",
      "startLine": 208,
      "endLine": 248,
      "status": "UNUSED",
      "reason": "Frontend uses /wallets/transactions with targetUserEmail='*' instead",
      "code": "/**\n * Get all project transactions\n * Body: { sessionId, projectId, limit? }\n */\napp.post('/transactions/all', async (c) => {\n  try {\n    const user = c.get('user');\n    const body = await c.req.json();\n    const { projectId, limit = 200 } = body;\n\n    if (!projectId) {\n      return c.json({\n        success: false,\n        error: 'Project ID is required',\n        errorCode: 'INVALID_INPUT'\n      }, 400);\n    }\n\n    // Need manage permission to view all transactions\n    const hasPermission = await checkProjectPermission(c.env, user.userEmail, projectId, 'manage');\n    if (!hasPermission) {\n      return c.json({\n        success: false,\n        error: 'Insufficient permissions to view all transactions',\n        errorCode: 'ACCESS_DENIED'\n      }, 403);\n    }\n\n    const response = await getAllProjectTransactions(\n      c.env,\n      user.userEmail,\n      projectId,\n      limit\n    );\n\n    return response;\n  } catch (error) {\n    console.error('Get all transactions route error:', error);\n    return c.json({\n      success: false,\n      error: 'Failed to get all transactions',\n      errorCode: 'SYSTEM_ERROR'\n    }, 500);\n  }\n});",
      "handlers": ["getAllProjectTransactions"],
      "imports": []
    },
    {
      "id": 48,
      "path": "/ws/",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/websocket.ts",
      "startLine": 21,
      "endLine": 57,
      "status": "UNUSED",
      "reason": "WebSocket feature not implemented in frontend yet",
      "code": "/**\n * WebSocket connection endpoint\n * Upgrades HTTP request to WebSocket and connects to user's NotificationHub\n *\n * Query parameters:\n * - token: JWT authentication token\n *\n * @example\n * ws://your-worker.workers.dev/ws?token=<jwt-token>\n */\nrouter.get('/', async (c) => {\n  // Get token from query parameter or header\n  const token = c.req.query('token') || c.req.header('Authorization')?.replace('Bearer ', '');\n\n  if (!token) {\n    return c.json({\n      success: false,\n      error: {\n        code: 'MISSING_TOKEN',\n        message: 'Authentication token is required'\n      }\n    }, 401);\n  }\n\n  // Verify token before creating Durable Object\n  const { verifyToken } = await import('../handlers/auth/jwt');\n  let payload;\n  try {\n    payload = await verifyToken(token, c.env.JWT_SECRET);\n  } catch (error) {\n    return c.json({\n      success: false,\n      error: {\n        code: 'INVALID_TOKEN',\n        message: 'Invalid or expired token'\n      }\n    }, 401);\n  }\n\n  // Get Durable Object ID for this user\n  // Each user gets their own NotificationHub instance\n  const id = c.env.NOTIFICATION_HUB.idFromName(payload.userId);\n  const stub = c.env.NOTIFICATION_HUB.get(id);\n\n  // Forward the request to the Durable Object\n  return stub.fetch(c.req.raw);\n});",
      "handlers": [],
      "imports": ["import { verifyToken } from '../handlers/auth/jwt';"],
      "notes": "WebSocket real-time notifications not yet used by frontend"
    },
    {
      "id": 49,
      "path": "/ws/status",
      "method": "GET",
      "sourceFile": "Cloudflare-Workers/src/router/websocket.ts",
      "startLine": 63,
      "endLine": 78,
      "status": "UNUSED",
      "reason": "WebSocket feature not implemented in frontend yet",
      "code": "/**\n * WebSocket status endpoint\n * Returns information about WebSocket service\n */\nrouter.get('/status', async (c) => {\n  return c.json({\n    success: true,\n    data: {\n      service: 'WebSocket Notification Hub',\n      status: 'running',\n      features: [\n        'Real-time notifications',\n        'User data updates',\n        'Permission changes',\n        'System announcements'\n      ],\n      endpoint: '/ws?token=<your-jwt-token>'\n    }\n  });\n});",
      "handlers": [],
      "imports": []
    }
  ],
  "summary": {
    "totalEndpoints": 49,
    "byStatus": {
      "unused": 41,
      "deprecated": 8
    },
    "byRouter": {
      "admin": 13,
      "auth": 1,
      "comments": 4,
      "groups": 1,
      "ip": 2,
      "maintenance": 5,
      "notifications": 5,
      "scoring": 6,
      "settlement": 1,
      "submissions": 2,
      "system": 1,
      "users": 2,
      "wallets": 4,
      "websocket": 2
    }
  }
}
